<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Coin Piggy Bank â€¢ Primary Steps</title>
<style>
:root{
    --bg0:#0b0d12; --bg1:#0f1320;
    --panel:#121621; --panel2:#0d1c36;
    --text:#eef2ff; --muted:rgba(238,242,255,.72);
    --line:rgba(255,255,255,.12);
    --accent:#7dd3fc; --accent2:#a78bfa; --good:#34d399; --bad:#fb7185;
    --ring:rgba(125,211,252,.30);
    --shadow:0 18px 40px rgba(0,0,0,.35);
    --r:18px;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    background:
      radial-gradient(1200px 700px at 20% 10%, rgba(125,211,252,.18), transparent 55%),
      radial-gradient(900px 600px at 80% 0%, rgba(167,139,250,.16), transparent 55%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    min-height:100vh;
  }

  header{
    position:sticky; top:0; z-index:10;
    backdrop-filter: blur(10px);
    background: rgba(18,22,33,.72);
    border-bottom:1px solid var(--line);
  }
  .wrap{max-width:1100px;margin:0 auto;padding:14px 16px;}
  .top{display:flex; align-items:center; justify-content:space-between; gap:12px;}
  .brand{display:flex; align-items:center; gap:10px; min-width:0; text-decoration:none; color:var(--text);}
  .brand img{height:52px;width:auto;display:block; filter: drop-shadow(0 16px 30px rgba(125,211,252,.10));}
  .brand .title{font-weight:850; letter-spacing:.2px; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .brand .sub{display:block; font-size:12px; color:var(--muted); margin-top:2px}
  nav{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
  nav a{
    color:var(--text); text-decoration:none; font-weight:700; font-size:13px;
    padding:8px 10px; border-radius:12px;
    border:1px solid transparent;
    opacity:.92;
  }
  nav a:hover{border-color:var(--line); background:rgba(255,255,255,.04); opacity:1;}
  nav a.active{border-color:rgba(125,211,252,.35); background:rgba(125,211,252,.10); opacity:1;}

  .hero{padding:22px 16px 10px;}
  .hwrap{max-width:1100px;margin:0 auto;}
  h1{margin:0 0 6px; font-size:32px; letter-spacing:-.4px;}
  p.lead{margin:0; color:var(--muted); max-width:85ch; font-size:14px; line-height:1.45;}

  .grid{
    max-width:1100px; margin:14px auto 28px; padding:0 16px;
    display:grid; grid-template-columns: 1.15fr .85fr; gap:14px;
  }
  @media (max-width: 980px){ .grid{grid-template-columns:1fr; } nav{justify-content:flex-start;} }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    border:1px solid var(--line);
    border-radius:var(--r);
    box-shadow: var(--shadow);
    overflow:hidden;
  }
  .card .head{
    padding:14px 14px 10px;
    border-bottom:1px solid var(--line);
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .pill{
    font-size:12px; font-weight:850;
    padding:6px 10px; border-radius:999px;
    background: rgba(125,211,252,.14);
    border:1px solid rgba(125,211,252,.25);
    color: var(--text);
    white-space:nowrap;
  }
  .body{padding:14px;}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  .btn{
    appearance:none; border:1px solid var(--line);
    background: rgba(255,255,255,.05);
    color:var(--text); font-weight:850;
    padding:10px 12px; border-radius:14px;
    cursor:pointer;
    text-decoration:none;
    display:inline-flex; align-items:center; gap:8px;
  }
  .btn:hover{background: rgba(255,255,255,.08);}
  .btn.primary{
    border-color: rgba(125,211,252,.35);
    background: linear-gradient(180deg, rgba(125,211,252,.18), rgba(125,211,252,.07));
  }
  .btn.good{
    border-color: rgba(52,211,153,.35);
    background: linear-gradient(180deg, rgba(52,211,153,.18), rgba(52,211,153,.06));
  }
  .btn.danger{
    border-color: rgba(251,113,133,.35);
    background: linear-gradient(180deg, rgba(251,113,133,.18), rgba(251,113,133,.06));
  }

  .field{display:flex; flex-direction:column; gap:6px; min-width:240px;}
  label{font-size:12px; color:var(--muted); font-weight:800; letter-spacing:.02em;}
  select{
    width:100%;
    appearance:none;
    border:1px solid var(--line);
    background: rgba(255,255,255,.05);
    color:var(--text);
    padding:10px 12px;
    border-radius:14px;
    font-weight:800;
    cursor:pointer;
    outline:none;
  }
  select:focus{box-shadow: 0 0 0 6px var(--ring);}

  .stat{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:10px 12px; border-radius:14px;
    border:1px dashed rgba(238,242,255,.22);
    color: var(--muted);
  }
  .small{font-size:12px;color:var(--muted);}
  .msg{
    padding:10px 12px; border-radius:14px;
    border:1px solid var(--line);
    background: rgba(255,255,255,.04);
    color: var(--muted);
    margin-top:10px;
  }
  .msg.good{border-color:rgba(52,211,153,.35); background: rgba(52,211,153,.10); color: rgba(238,242,255,.92);}
  .msg.bad{border-color:rgba(251,113,133,.35); background: rgba(251,113,133,.10); color: rgba(238,242,255,.92);}

  /* Game stage */
  .stage{
    border:1px solid var(--line);
    border-radius:16px;
    padding:12px;
    background:
      radial-gradient(900px 500px at 10% 0%, rgba(125,211,252,.10), transparent 60%),
      linear-gradient(180deg, rgba(13,28,54,.65), rgba(13,28,54,.35));
  }

  /* Game cards selector */
  .selectorGrid{
    display:grid; grid-template-columns:1fr; gap:10px;
  }
  .gameCard{
    border:1px solid var(--line);
    background: rgba(255,255,255,.04);
    border-radius:16px;
    padding:12px;
    display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
  }
  .gameCard strong{display:block; font-size:14px; font-weight:950;}
  .gameCard .desc{font-size:12px; color:var(--muted); line-height:1.35; margin-top:4px;}
  .gameCard .tag{
    font-size:12px; font-weight:950;
    padding:6px 10px; border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    color: var(--muted);
    background: rgba(0,0,0,.10);
    white-space:nowrap;
  }
  .gameCard.active{
    border-color: rgba(125,211,252,.40);
    background: rgba(125,211,252,.08);
  }

  /* Connect 4 */
  .c4Wrap{display:grid; gap:12px; justify-items:center;}
  .c4Board{
    width:min(420px, 100%);
    aspect-ratio: 7 / 6;
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    grid-template-rows: repeat(6, 1fr);
    gap:10px;
    padding:12px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.16);
  }
  .c4Cell{
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    display:flex; align-items:center; justify-content:center;
    cursor:pointer;
    position:relative;
  }
  .c4Disc{
    width:100%; height:100%;
    border-radius:999px;
    transform: scale(.82);
    background: rgba(255,255,255,.06);
    box-shadow: inset 0 10px 20px rgba(0,0,0,.28);
  }
  .c4Disc.r{ background: rgba(251,113,133,.70); }
  .c4Disc.y{ background: rgba(253,224,71,.65); }
  .c4Top{
    width:min(420px, 100%);
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:10px;
  }
  .c4Top button{
    height:42px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.04);
    color:var(--text);
    font-weight:950;
    cursor:pointer;
  }
  .c4Top button:hover{background: rgba(255,255,255,.07);}
  .seg{
    display:flex; gap:8px; flex-wrap:wrap;
    padding:6px; border:1px solid var(--line);
    border-radius:16px; background:rgba(255,255,255,.03);
  }
  .seg button{border-radius:12px; padding:9px 12px;}
  .seg button.on{border-color:rgba(125,211,252,.45); background:rgba(125,211,252,.12);}

  /* Shape Sort */
  .shapeWrap{display:grid; gap:12px;}
  .bins{
    display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px;
  }
  @media (max-width: 560px){ .bins{grid-template-columns:1fr;} .brand .title{display:none;} }

  .bin{
    border:1px dashed rgba(238,242,255,.22);
    border-radius:16px;
    padding:12px;
    min-height:120px;
    display:flex; flex-direction:column; gap:10px;
    background: rgba(0,0,0,.10);
  }
  .binTitle{display:flex; align-items:center; justify-content:space-between; gap:10px;}
  .binTitle strong{font-size:13px; font-weight:950;}
  .binTitle .mini{font-size:12px; color:var(--muted); font-weight:900;}
  .dropArea{
    flex:1;
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    display:flex; align-items:center; justify-content:center;
    background: rgba(255,255,255,.04);
  }
  .tray{
    border:1px solid rgba(255,255,255,.12);
    border-radius:16px;
    padding:12px;
    background: rgba(0,0,0,.10);
  }
  .shapes{
    display:flex; gap:10px; flex-wrap:wrap;
  }
  .shape{
    width:56px; height:56px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    display:flex; align-items:center; justify-content:center;
    cursor:grab;
    user-select:none;
    touch-action:none;
  }
  .shape:active{cursor:grabbing;}
  .shape svg{width:34px; height:34px; display:block;}
  .bin.over{outline: 2px solid rgba(125,211,252,.45); outline-offset: 2px;}

  /* Coin game answer buttons (shared) */
  .choices{display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:10px;}
  @media (max-width: 560px){ .choices{grid-template-columns:1fr;} }
  .choice{
    border:1px solid var(--line);
    background: rgba(255,255,255,.05);
    border-radius:16px;
    padding:12px;
    cursor:pointer;
    user-select:none;
    text-align:left;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    font-weight:950;
    color:var(--text);
  }
  .choice:hover{background: rgba(255,255,255,.08);}
  .choice .tag{
    font-size:12px; font-weight:950;
    padding:6px 10px; border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    color: var(--muted);
    background: rgba(0,0,0,.10);
    white-space:nowrap;
  }
/* Extra polish for coin UI */
.coinRow{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.coinBtn{width:74px;height:74px;border-radius:18px;border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.05);display:flex;align-items:center;justify-content:center;
  cursor:pointer; user-select:none;}
.coinBtn:hover{background:rgba(255,255,255,.08)}
.coinBtn:active{transform:scale(.98)}
.small{color:var(--muted);font-size:12px;font-weight:800}

  .coinPng{display:block;width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 8px 18px rgba(0,0,0,.35));}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="top">
      <a class="brand" href="index.html" aria-label="Primary Steps home">
        <img src="assets/primary-steps-logo.png" alt="Primary Steps logo" onerror="this.style.display='none'">
        <div>
          <div class="title">Primary Steps</div>
          <span class="sub">Simple, calm learning activities</span>
        </div>
      </a>
      <nav aria-label="Primary">
        <a href="index.html">Home</a>
        <a href="letters.html">Letters</a>
        <a href="numbers.html">Numbers</a>
        <a href="phonics.html">Phonics</a>
        <a href="maths.html">Maths</a>
        <a href="memory.html">Memory</a>
        <a href="games.html" class="active">Games</a>
        <a href="puzzles.html">Puzzles</a>
        <a href="handwriting.html">Handwriting</a>
        <a href="clock.html">Clock</a>
        <a href="progress.html">Progress</a>
        <a href="settings.html">Settings</a>
      </nav>
    </div>
  </div>
</header>

<section class="hero">
  <div class="hwrap">
    <h1>Coin Piggy Bank</h1>
    <p class="lead">Count, sort, and order UK coin values. Designed to be calm, clear, and classroom-friendly.</p>
  </div>
</section>

<section class="grid two">
  <div class="card">
    <div class="head">
      <div class="pill" id="modePill">Count</div>
      <div class="row">
        <button class="btn" id="soundBtn" type="button" aria-pressed="false">Sound: Off</button>
        <button class="btn primary" id="newBtn" type="button">New</button>
        <button class="btn" id="resetBtn" type="button">Reset</button>
      </div>
    </div>
    <div class="body">
      <div class="stage" id="stage"></div>
      <div class="msg" id="message">Press <strong>New</strong> to start.</div>
      <div class="row" style="margin-top:10px;">
        <a class="btn" href="games.html">Back to Games</a>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="head">
      <div class="pill">Options</div>
    </div>
    <div class="body">
      <div style="font-weight:950;">Mode</div>
      <div class="row" style="margin-top:10px;">
        <div class="seg" role="tablist" aria-label="Coin game modes">
          <button class="btn on" id="mCount" type="button">Count</button>
          <button class="btn" id="mMake" type="button">Make Amount</button>
          <button class="btn" id="mSort" type="button">Sort</button>
          <button class="btn" id="mOrder" type="button">Order</button>
        </div>
      </div>

      <div style="margin-top:14px;font-weight:950;">Difficulty</div>
      <div class="row" style="margin-top:10px;">
        <button class="btn on" id="dEasy" type="button">Easy</button>
        <button class="btn" id="dMed" type="button">Medium</button>
        <button class="btn" id="dHard" type="button">Hard</button>
      </div>

      <div class="msg" style="margin-top:14px;">
        <div class="small"><strong>Coins by difficulty:</strong></div>
        <div class="small">Easy: 1pâ€“10p â€¢ Medium: 1pâ€“50p â€¢ Hard: 1pâ€“Â£2</div>
        <div class="small" style="margin-top:8px;">Note: Coins are illustrated (labels + realistic styling) without copying official coin artwork.</div>
      </div>
    </div>
  </div>
</section>

<script>
(() => {
  const $ = (id)=>document.getElementById(id);
  const ui = {
    stage:$('stage'),
    msg:$('message'),
    modePill:$('modePill'),
    soundBtn:$('soundBtn'),
    newBtn:$('newBtn'),
    resetBtn:$('resetBtn'),
    mCount:$('mCount'),
    mMake:$('mMake'),
    mSort:$('mSort'),
    mOrder:$('mOrder'),
    dEasy:$('dEasy'),
    dMed:$('dMed'),
    dHard:$('dHard'),
  };

  // --------- sound ---------
  let soundOn=false, audioCtx=null;
  function beep(freq=700, ms=70, gain=0.03){
    if(!soundOn) return;
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.frequency.value=freq; g.gain.value=gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(), ms);
  }
  function setMsg(type, html){
    ui.msg.className = 'msg' + (type ? ' ' + type : '');
    ui.msg.innerHTML = html;
  }

  // --------- helpers ---------
  const randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const shuffle=(arr)=>{ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; };
  const fmt=(p)=>{
    if(p>=100){
      const pounds=Math.floor(p/100), pp=p%100;
      return "Â£"+pounds+(pp?("." + String(pp).padStart(2,'0')):"");
    }
    return p+"p";
  };

  function coinPool(diff){
    const base=[
      {v:1,label:'1p',metal:'copper'},
      {v:2,label:'2p',metal:'copper'},
      {v:5,label:'5p',metal:'silver'},
      {v:10,label:'10p',metal:'silver'},
    ];
    const mid=base.concat([
      {v:20,label:'20p',metal:'silver'},
      {v:50,label:'50p',metal:'silver'},
    ]);
    const hard=mid.concat([
      {v:100,label:'Â£1',metal:'gold'},
      {v:200,label:'Â£2',metal:'bimetal'},
    ]);
    return diff==='easy'?base: diff==='medium'?mid:hard;
  }

  // "Realistic" coin SVGs (original artwork)
  function coinSVG(c, size=64){
    const metal = c.metal;
    const base = metal==='copper' ? ['#b45f3a','#d98b63'] :
                 metal==='gold' ? ['#b88b2e','#f1d27a'] :
                 metal==='bimetal' ? ['#c7c9cf','#f1d27a'] :
                 ['#c9ced8','#f4f7ff']; // silver

    // ring + center styling
    const ring = metal==='bimetal';
    const ridges = 36;

    // Build ridges as subtle ticks on outer ring
    let ticks = '';
    for(let i=0;i<ridges;i++) {
      const a = (i/ridges)*Math.PI*2;
      const r1 = 28, r2 = 30;
      const x1 = 32 + Math.cos(a)*r1;
      const y1 = 32 + Math.sin(a)*r1;
      const x2 = 32 + Math.cos(a)*r2;
      const y2 = 32 + Math.sin(a)*r2;
      ticks += `<line x1="${x1.toFixed(2)}" y1="${y1.toFixed(2)}" x2="${x2.toFixed(2)}" y2="${y2.toFixed(2)}" stroke="rgba(255,255,255,.12)" stroke-width="1"/>`;
    }

    const label = c.label.replace('Â£','Â£');
    const small = metal==='bimetal' ? 'BI' : metal==='gold' ? 'Â£' : 'UK';

    return `
      <svg width="${size}" height="${size}" viewBox="0 0 64 64" aria-hidden="true">
        <defs>
          <radialGradient id="g1-${label}" cx="30%" cy="25%" r="80%">
            <stop offset="0%" stop-color="${base[1]}" stop-opacity="0.95"/>
            <stop offset="60%" stop-color="${base[0]}" stop-opacity="0.92"/>
            <stop offset="100%" stop-color="#000" stop-opacity="0.20"/>
          </radialGradient>
          <radialGradient id="shine-${label}" cx="25%" cy="20%" r="60%">
            <stop offset="0%" stop-color="rgba(255,255,255,.55)"/>
            <stop offset="70%" stop-color="rgba(255,255,255,0)"/>
          </radialGradient>
        </defs>

        <circle cx="32" cy="32" r="30" fill="url(#g1-${label})" stroke="rgba(255,255,255,.25)" stroke-width="1.5"/>
        ${ticks}
        <circle cx="32" cy="32" r="26" fill="rgba(0,0,0,.10)" stroke="rgba(255,255,255,.16)" stroke-width="1.2"/>
        ${ring ? `<circle cx="32" cy="32" r="18" fill="rgba(0,0,0,.12)" stroke="rgba(255,255,255,.18)" stroke-width="1.2"/>` : `<circle cx="32" cy="32" r="20" fill="rgba(0,0,0,.10)" stroke="rgba(255,255,255,.14)" stroke-width="1.1"/>`}

        <circle cx="24" cy="22" r="24" fill="url(#shine-${label})" opacity=".55"/>

        <text x="32" y="38" text-anchor="middle" font-size="14" font-weight="950" fill="rgba(20,22,30,.85)">${label}</text>
        <text x="32" y="20" text-anchor="middle" font-size="9" font-weight="900" fill="rgba(20,22,30,.70)">${small}</text>
      </svg>
    `;
  }


  // Use PNG coin images from assets/money when available (fallback to SVG)
  function coinImageCandidates(label){
    const clean = label.replace(/\s+/g,'').toLowerCase();
    if (clean === 'Â£1') return ['coin-1-pound.png','coin-1pound.png','coin-Â£1.png','1-pound.png','1pound.png','Â£1.png'];
    if (clean === 'Â£2') return ['coin-2-pound.png','coin-2pound.png','coin-Â£2.png','2-pound.png','2pound.png','Â£2.png'];
    if (clean === '50p') return ['coin-50p.png','50p.png'];
    if (clean === '20p') return ['coin-20p.png','20p.png'];
    if (clean === '10p') return ['coin-10p.png','10p.png'];
    if (clean === '5p')  return ['coin-5p.png','5p.png'];
    if (clean === '2p')  return ['coin-2p.png','2p.png'];
    if (clean === '1p')  return ['coin-1p.png','1p.png'];
    return [];
  }

  function guessCoinSrc(c){
    const base = 'assets/money/';
    const list = coinImageCandidates(c.label);
    return list.length ? (base + list[0]) : '';
  }

  function createCoinNode(c, size){
    // Try first candidate; if you used different filenames, add them in coinImageCandidates()
    const src = guessCoinSrc(c);
    if (!src){
      const wrap = document.createElement('span');
      wrap{ const __c = c, size; this.replaceChildren(createCoinNode(__c, 62)); }
      return wrap.firstElementChild;
    }

    const img = new Image();
    img.className = 'coinPng';
    img.width = size;
    img.height = size;
    img.alt = c.label;
    img.decoding = 'async';
    img.loading = 'eager';
    img.src = src;

    img.onerror = () => {
      // fallback to SVG if filename doesn't exist
      const wrap = document.createElement('span');
      wrap{ const __c = c, size; this.replaceChildren(createCoinNode(__c, 62)); }
      img.replaceWith(wrap.firstElementChild);
    };

    return img;
  }
  function pigSVG(){
    return `
    <svg viewBox="0 0 520 320" width="100%" height="auto" aria-label="Piggy bank">
      <defs>
        <linearGradient id="pigPink" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="rgba(251,113,133,.78)"/>
          <stop offset="100%" stop-color="rgba(251,113,133,.42)"/>
        </linearGradient>
        <filter id="softShadow" x="-40%" y="-40%" width="180%" height="180%">
          <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="rgba(0,0,0,.35)"/>
        </filter>
      </defs>
      <ellipse cx="270" cy="280" rx="170" ry="20" fill="rgba(0,0,0,.25)"/>
      <g filter="url(#softShadow)">
        <path d="M140 210
                 C105 185 102 140 128 112
                 C165 70 240 52 318 64
                 C376 73 420 108 434 148
                 C452 200 418 246 360 258
                 C295 271 205 260 140 210Z"
              fill="url(#pigPink)" stroke="rgba(238,242,255,.18)" stroke-width="2"/>
        <ellipse cx="265" cy="170" rx="150" ry="92" fill="rgba(125,211,252,.10)" opacity="0.9"/>
        <path d="M178 96 C168 70 184 56 212 64 C206 88 196 103 178 96Z"
              fill="rgba(251,113,133,.55)" stroke="rgba(238,242,255,.16)" stroke-width="2"/>
        <ellipse cx="414" cy="178" rx="44" ry="34" fill="rgba(251,113,133,.55)"
                 stroke="rgba(238,242,255,.16)" stroke-width="2"/>
        <ellipse cx="404" cy="182" rx="7" ry="10" fill="rgba(0,0,0,.22)"/>
        <ellipse cx="423" cy="182" rx="7" ry="10" fill="rgba(0,0,0,.22)"/>
        <circle cx="372" cy="148" r="9" fill="rgba(238,242,255,.85)"/>
        <circle cx="374" cy="150" r="4.5" fill="rgba(0,0,0,.45)"/>
        <rect x="250" y="72" width="78" height="14" rx="7" fill="rgba(0,0,0,.35)" opacity="0.55"/>
        <path d="M190 238 C182 270 198 285 224 282 C232 262 225 242 214 234Z"
              fill="rgba(251,113,133,.55)" stroke="rgba(238,242,255,.14)" stroke-width="2"/>
        <path d="M300 252 C292 282 310 296 336 294 C346 274 338 252 326 246Z"
              fill="rgba(251,113,133,.55)" stroke="rgba(238,242,255,.14)" stroke-width="2"/>
        <path d="M118 166 C86 150 82 120 110 112 C124 108 134 120 126 132
                 C120 140 110 136 108 144 C106 152 118 154 124 154"
              fill="none" stroke="rgba(238,242,255,.35)" stroke-width="6" stroke-linecap="round"/>
        <g id="coinLayer"></g>
      </g>
    </svg>
    `;
  }

  // --------- state ---------
  let mode='count';
  let diff='easy';

  // count
  let coins=[], total=0, options=[], done=false;

  // make amount
  let target=0, picked=[], pickTotal=0;

  // sort
  let sortCoins=[], sortPicked=null;

  // order
  let orderSet=[], orderIds=[], selectedIdx=null;

  function setMode(next){
    mode=next;
    ui.mCount.classList.toggle('on', mode==='count');
    ui.mMake.classList.toggle('on', mode==='make');
    ui.mSort.classList.toggle('on', mode==='sort');
    ui.mOrder.classList.toggle('on', mode==='order');
    ui.modePill.textContent = mode==='count' ? 'Count' : mode==='make' ? 'Make Amount' : mode==='sort' ? 'Sort' : 'Order';
    newRound();
  }
  function setDiff(next){
    diff=next;
    ui.dEasy.classList.toggle('on', diff==='easy');
    ui.dMed.classList.toggle('on', diff==='medium');
    ui.dHard.classList.toggle('on', diff==='hard');
    newRound();
  }

  function bellyCoinsHTML(arr){
    return arr.map((c,i)=>{
      const cols=5;
      const x = 120 + (i%cols)*62 + (Math.random()*10-5);
      const y = 155 + Math.floor(i/cols)*50 + (Math.random()*10-5);
      const rot = (Math.random()*10-5).toFixed(1);
      return `<g transform="translate(${x} ${y}) rotate(${rot})">${coinSVG(c, 54).replace('width="54"','width="54"').replace('height="54"','height="54"')}</g>`;
    }).join('');
  }

  function newRound(){
    done=false; sortPicked=null; selectedIdx=null;
    const pool = coinPool(diff);

    if(mode==='count'){
      const n = randInt(diff==='easy'?4:5, diff==='easy'?7:diff==='medium'?9:11);
      coins = Array.from({length:n}, (_,i)=> ({...pool[randInt(0,pool.length-1)], id:'c'+Math.random().toString(16).slice(2)+i}));
      total = coins.reduce((s,c)=>s+c.v,0);
      const opts = new Set([total]);
      const wiggles = diff==='easy' ? [1,2,5,10] : diff==='medium' ? [1,2,5,10,20,50] : [1,2,5,10,20,50,100,200];
      while(opts.size<4){
        const w = wiggles[randInt(0, wiggles.length-1)] * (Math.random()<.5?-1:1);
        opts.add(Math.max(0, total + w));
      }
      options = shuffle([...opts]);
      render();
      setMsg('', 'Count the coins in the pig and tap the total.');
      beep(820,60,0.03);
      return;
    }

    if(mode==='make'){
      // Make amount: pick coins until you hit target (classic)
      const max = diff==='easy'?40 : diff==='medium'?120 : 350;
      target = [5,10,12,15,18,20,25,30,35,40,45,50,60,75,80,90,100,110,125,150,175,200,225,250,275,300,325,350]
        .filter(v=>v<=max)[randInt(0, Math.min(20, [5,10,12,15,18,20,25,30,35,40,45,50,60,75,80,90,100,110,125,150,175,200,225,250,275,300,325,350].filter(v=>v<=max).length-1))];
      picked = [];
      pickTotal = 0;
      render();
      setMsg('', `Make <strong>${fmt(target)}</strong> by selecting coins.`);
      beep(820,60,0.03);
      return;
    }

    if(mode==='sort'){
      const n = randInt(diff==='easy'?6:7, diff==='easy'?9:diff==='medium'?11:13);
      sortCoins = Array.from({length:n}, (_,i)=> ({...pool[randInt(0,pool.length-1)], id:'s'+Math.random().toString(16).slice(2)+i}));
      render();
      setMsg('', 'Sort the coins into the matching pots. (Touch: tap coin then tap pot.)');
      beep(820,60,0.03);
      return;
    }

    if(mode==='order'){
      const uniq=[]; const seen=new Set();
      for(const c of pool){ if(!seen.has(c.v)){ uniq.push(c); seen.add(c.v); } }
      const count = diff==='easy'?5 : diff==='medium'?6 : 8;
      orderSet = shuffle(uniq.slice()).slice(0,count).map((c,i)=>({...c, id:'o'+Math.random().toString(16).slice(2)+i}));
      orderIds = shuffle(orderSet.map(c=>c.id));
      render();
      setMsg('', 'Put the coins in order from smallest to biggest. (Touch: tap two coins to swap.)');
      beep(820,60,0.03);
      return;
    }
  }

  function render(){
    if(mode==='count'){
      ui.stage.innerHTML = `
        <div style="display:grid; gap:12px; justify-items:center;">
          <div style="width:min(520px,100%);">${pigSVG()}</div>
          <div class="choices" id="choices" style="width:min(520px,100%);"></div>
          <div class="row" style="justify-content:flex-start; width:min(520px,100%);">
            <button class="btn" id="showBtn" type="button">Show Answer</button>
          </div>
        </div>
      `;
      ui.stage.querySelector('#coinLayer').innerHTML = bellyCoinsHTML(coins);
      const box = ui.stage.querySelector('#choices');
      box.innerHTML = '';
      options.forEach((opt, i)=>{
        const b=document.createElement('button');
        b.type='button';
        b.className='choice';
        b.innerHTML = `<span>${fmt(opt)}</span><span class="tag">Answer</span>`;
        b.addEventListener('click', ()=>{
          if(done) return;
          done=true;
          // highlight
          [...box.children].forEach((el,ix)=>{
            el.style.borderColor = (ix===i) ? 'rgba(125,211,252,.50)' : 'rgba(255,255,255,.12)';
            el.style.background = (ix===i) ? 'rgba(125,211,252,.10)' : 'rgba(255,255,255,.05)';
          });
          if(opt===total){
            setMsg('good', `âœ… Correct! Itâ€™s <strong>${fmt(total)}</strong>. Press <strong>New</strong> for another.`);
            beep(880,90,0.04);
          } else {
            setMsg('bad', `Not quite. You chose <strong>${fmt(opt)}</strong>.`);
            beep(220,120,0.05);
          }
        });
        box.appendChild(b);
      });
      ui.stage.querySelector('#showBtn').addEventListener('click', ()=>{ setMsg('', `Answer: <strong>${fmt(total)}</strong>.`); beep(740,60,0.03); });
      return;
    }

    if(mode==='make'){
      const pool = coinPool(diff);
      ui.stage.innerHTML = `
        <div style="display:grid; gap:12px; justify-items:center;">
          <div style="width:min(520px,100%);">${pigSVG()}</div>

          <div class="row" style="justify-content:center;">
            <span class="pill">Target: ${fmt(target)}</span>
            <span class="pill">Total: <span id="makeTotal">${fmt(pickTotal)}</span></span>
          </div>

          <div class="coinRow" id="coinPick" style="width:min(520px,100%);"></div>

          <div class="tray" style="width:min(520px,100%);">
            <div class="row" style="justify-content:space-between;">
              <strong style="font-size:14px;font-weight:950;">Your coins</strong>
              <span class="small">Tap a coin to remove it</span>
            </div>
            <div class="coinRow" id="pickedRow" style="margin-top:10px;"></div>
          </div>

          <div class="row" style="justify-content:flex-start; width:min(520px,100%);">
            <button class="btn good" id="checkBtn" type="button">Check</button>
            <button class="btn" id="clearBtn" type="button">Clear</button>
            <button class="btn" id="showBtn" type="button">Show One Way</button>
          </div>
        </div>
      `;
      // belly shows picked coins
      ui.stage.querySelector('#coinLayer').innerHTML = bellyCoinsHTML(picked.slice(0, 10));

      const pickEl = ui.stage.querySelector('#coinPick');
      pickEl.innerHTML = '';
      pool.forEach(c=>{
        const b = document.createElement('button');
        b.type='button';
        b.className='coinBtn';
        b{ const __c = c, 62; this.replaceChildren(createCoinNode(__c, 62)); }
        b.addEventListener('click', ()=>{
          picked.push({...c, id:'p'+Math.random().toString(16).slice(2)});
          pickTotal += c.v;
          beep(640,50,0.02);
          render(); // rerender for simplicity
        });
        pickEl.appendChild(b);
      });

      const pickedRow = ui.stage.querySelector('#pickedRow');
      pickedRow.innerHTML = '';
      picked.forEach((c, idx)=>{
        const b=document.createElement('button');
        b.type='button';
        b.className='coinBtn';
        b{ const __c = c, 62; this.replaceChildren(createCoinNode(__c, 62)); }
        b.addEventListener('click', ()=>{
          picked.splice(idx,1);
          pickTotal -= c.v;
          beep(520,50,0.02);
          render();
        });
        pickedRow.appendChild(b);
      });

      ui.stage.querySelector('#checkBtn').addEventListener('click', ()=>{
        if(pickTotal === target){
          setMsg('good', `âœ… Correct! You made <strong>${fmt(target)}</strong>. Press <strong>New</strong> for another.`);
          beep(880,90,0.04);
        } else if(pickTotal < target){
          setMsg('bad', `You are short by <strong>${fmt(target - pickTotal)}</strong>.`);
          beep(220,120,0.05);
        } else {
          setMsg('bad', `You are over by <strong>${fmt(pickTotal - target)}</strong>.`);
          beep(220,120,0.05);
        }
      });
      ui.stage.querySelector('#clearBtn').addEventListener('click', ()=>{ picked=[]; pickTotal=0; setMsg('', 'Cleared. Try again.'); beep(520,60,0.02); render(); });
      ui.stage.querySelector('#showBtn').addEventListener('click', ()=>{
        // greedy example
        let remaining = target;
        const sorted = pool.slice().sort((a,b)=>b.v-a.v);
        const sol=[];
        for(const c of sorted){
          while(remaining >= c.v){
            sol.push(c);
            remaining -= c.v;
          }
        }
        picked = sol.map(c=>({...c, id:'p'+Math.random().toString(16).slice(2)}));
        pickTotal = picked.reduce((s,c)=>s+c.v,0);
        setMsg('', `One way: ${picked.map(c=>c.label).join(' + ')}`);
        beep(740,60,0.03);
        render();
      });
      return;
    }

    if(mode==='sort'){
      const pots = coinPool(diff);
      ui.stage.innerHTML = `
        <div style="display:grid; gap:12px;">
          <div style="width:min(520px,100%); margin:0 auto;">${pigSVG()}</div>

          <div class="bins" style="grid-template-columns: repeat(4, minmax(0,1fr));">
            ${pots.map(p=>`
              <div class="bin" data-pot="${p.label}">
                <div class="binTitle"><strong>${p.label}</strong><span class="mini">Drop here</span></div>
                <div class="dropArea"><div style="width:44px;height:34px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.05)"></div></div>
              </div>
            `).join('')}
          </div>

          <div class="tray">
            <div class="row" style="justify-content:space-between;">
              <strong style="font-size:14px;font-weight:950;">Coins</strong>
              <span class="pill">${sortCoins.length} left</span>
            </div>
            <div class="coinRow" id="tray" style="margin-top:10px; justify-content:flex-start;"></div>
            <div class="small" style="margin-top:8px;">Drag a coin into a pot. On touch: tap coin, then tap pot.</div>
          </div>
        </div>
      `;
      ui.stage.querySelector('#coinLayer').innerHTML = bellyCoinsHTML(sortCoins.slice(0,10));

      const tray = ui.stage.querySelector('#tray');
      tray.innerHTML = '';
      sortCoins.forEach(c=>{
        const el = document.createElement('div');
        el.className='coinBtn';
        el.style.width='76px'; el.style.height='76px';
        el.draggable = true;
        el.dataset.id = c.id;
        el{ const __c = c, 62; this.replaceChildren(createCoinNode(__c, 62)); }
        el.addEventListener('dragstart', (e)=>{ e.dataTransfer.setData('text/plain', c.id); beep(520,40,0.02); });
        el.addEventListener('click', ()=>{ sortPicked=c.id; setMsg('', `Picked <strong>${c.label}</strong>. Tap the matching pot.`); beep(640,40,0.02); });
        tray.appendChild(el);
      });

      function place(id, pot){
        const idx = sortCoins.findIndex(x=>x.id===id);
        if(idx===-1) return;
        const c = sortCoins[idx];
        if(c.label !== pot){
          setMsg('bad', `Not quite â€” that coin is <strong>${c.label}</strong>.`);
          beep(220,120,0.05);
          return;
        }
        sortCoins.splice(idx,1);
        setMsg('good', `âœ… Nice!`);
        beep(880,80,0.04);
        render();
        if(sortCoins.length===0) setMsg('good', `ðŸŽ‰ All sorted! Press <strong>New</strong> for another.`);
      }

      ui.stage.querySelectorAll('.bin').forEach(bin=>{
        const pot = bin.dataset.pot;
        bin.addEventListener('dragover', (e)=>{ e.preventDefault(); bin.classList.add('over'); });
        bin.addEventListener('dragleave', ()=> bin.classList.remove('over'));
        bin.addEventListener('drop', (e)=>{ e.preventDefault(); bin.classList.remove('over'); place(e.dataTransfer.getData('text/plain'), pot); });
        bin.addEventListener('click', ()=>{ if(sortPicked){ place(sortPicked, pot); sortPicked=null; } });
      });
      return;
    }

    if(mode==='order'){
      ui.stage.innerHTML = `
        <div style="display:grid; gap:12px;">
          <div style="width:min(520px,100%); margin:0 auto;">${pigSVG()}</div>

          <div class="tray" style="width:min(520px,100%); margin:0 auto;">
            <div class="row" style="justify-content:space-between;">
              <strong style="font-size:14px;font-weight:950;">Smallest â†’ Biggest</strong>
              <span class="small" id="selTxt">Drag to reorder or tap two coins to swap</span>
            </div>
            <div class="coinRow" id="orderRow" style="margin-top:10px;"></div>
            <div class="row" style="justify-content:flex-start; margin-top:10px;">
              <button class="btn good" id="checkBtn" type="button">Check</button>
              <button class="btn" id="showBtn" type="button">Show Answer</button>
            </div>
          </div>
        </div>
      `;
      ui.stage.querySelector('#coinLayer').innerHTML = bellyCoinsHTML(orderSet);

      const row = ui.stage.querySelector('#orderRow');
      row.innerHTML = '';
      orderIds.forEach((id, idx)=>{
        const c = orderSet.find(x=>x.id===id);
        const el = document.createElement('div');
        el.className='coinBtn';
        el.style.width='78px'; el.style.height='78px';
        el.draggable=true;
        el.dataset.idx = String(idx);
        el{ const __c = c, 62; this.replaceChildren(createCoinNode(__c, 62)); }
        el.addEventListener('dragstart', (e)=>{ e.dataTransfer.setData('text/plain', String(idx)); beep(520,40,0.02); });
        el.addEventListener('dragover', (e)=>{ e.preventDefault(); });
        el.addEventListener('drop', (e)=>{
          e.preventDefault();
          const from = Number(e.dataTransfer.getData('text/plain'));
          const to = idx;
          if(Number.isFinite(from) && from!==to){
            const moved = orderIds.splice(from,1)[0];
            orderIds.splice(to,0,moved);
            beep(640,40,0.02);
            render();
          }
        });
        el.addEventListener('click', ()=>{
          if(selectedIdx===null){
            selectedIdx=idx; el.style.outline='2px solid rgba(125,211,252,.55)'; el.style.outlineOffset='2px';
            ui.stage.querySelector('#selTxt').textContent='Selected 1 coin â€” tap another to swap';
            beep(640,40,0.02);
          } else if(selectedIdx===idx){
            selectedIdx=null;
            beep(520,40,0.02);
            render();
          } else {
            const a=selectedIdx, b=idx;
            [orderIds[a], orderIds[b]] = [orderIds[b], orderIds[a]];
            selectedIdx=null;
            beep(700,50,0.02);
            render();
          }
        });
        row.appendChild(el);
      });

      ui.stage.querySelector('#checkBtn').addEventListener('click', ()=>{
        const values = orderIds.map(id => orderSet.find(c=>c.id===id).v);
        const sorted = values.slice().sort((a,b)=>a-b);
        const ok = values.every((v,i)=>v===sorted[i]);
        if(ok){
          setMsg('good', `âœ… Correct order! Press <strong>New</strong> for another.`);
          beep(880,90,0.04);
        } else {
          setMsg('bad', `Not yet â€” try again. (Tip: 1p is smallest.)`);
          beep(220,120,0.05);
        }
      });
      ui.stage.querySelector('#showBtn').addEventListener('click', ()=>{
        orderIds = orderSet.slice().sort((a,b)=>a.v-b.v).map(c=>c.id);
        selectedIdx=null;
        setMsg('', 'Answer shown.');
        beep(740,60,0.03);
        render();
      });
      return;
    }
  }

  // buttons
  ui.soundBtn.addEventListener('click', ()=>{
    soundOn=!soundOn;
    ui.soundBtn.setAttribute('aria-pressed', String(soundOn));
    ui.soundBtn.textContent = 'Sound: ' + (soundOn ? 'On' : 'Off');
    beep(880,60,0.03);
  });
  ui.newBtn.addEventListener('click', newRound);
  ui.resetBtn.addEventListener('click', ()=>{ newRound(); setMsg('', 'Reset done.'); beep(520,60,0.02); });

  ui.mCount.addEventListener('click', ()=> setMode('count'));
  ui.mMake.addEventListener('click', ()=> setMode('make'));
  ui.mSort.addEventListener('click', ()=> setMode('sort'));
  ui.mOrder.addEventListener('click', ()=> setMode('order'));

  ui.dEasy.addEventListener('click', ()=> setDiff('easy'));
  ui.dMed.addEventListener('click', ()=> setDiff('medium'));
  ui.dHard.addEventListener('click', ()=> setDiff('hard'));

  // init
  newRound();
})();
</script>
</body>
</html>
