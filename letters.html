<!doctype html>
<html lang="en">
<head><title>Letters ‚Ä¢ Primary Steps</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#1f78ff">
<link rel="icon" type="image/png" href="assets/primary-steps-icon-512.png">
<style>
:root{
  --bg:#f5fbff;
  --panel:#ffffff;
  --ink:#0b1b33;
  --muted:#4b6488;
  --blue:#1f78ff;
  --blue2:#0f5fe6;
  --stroke: rgba(31,120,255,.18);
  --shadow: 0 18px 50px rgba(16, 60, 120, .14);
  --shadow2: 0 10px 26px rgba(16, 60, 120, .10);
  --r: 18px;
  --max: 1100px;
  --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:var(--font);
  color:var(--ink);
  background:
    radial-gradient(900px 360px at 30% -10%, rgba(31,120,255,.14), transparent 55%),
    radial-gradient(900px 360px at 85% 10%, rgba(31,120,255,.10), transparent 55%),
    linear-gradient(180deg, var(--bg), #eaf4ff);
}
a{color:inherit}
.container{width:min(var(--max), 92vw); margin:0 auto; padding:18px 0 60px;}
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  padding:14px 16px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.72);
  backdrop-filter: blur(10px);
  border-radius: 22px;
  box-shadow: var(--shadow2);
  position: sticky;
  top: 10px;
  z-index: 20;
}
.brand{display:flex; align-items:center; gap:12px; min-width:0;}
.brand img{
  height: 100px;
  width:auto;
  display:block;
  filter: drop-shadow(0 10px 18px rgba(16,60,120,.16));
}

.brand{
  position: relative;
}
.brand::before{
  content:"";
  position:absolute;
  left: -14px;
  top: -14px;
  width: 132px;
  height: 132px;
  border-radius: 999px;
  background: radial-gradient(circle at 35% 30%, rgba(31,120,255,.22), rgba(31,120,255,0) 62%);
  filter: blur(6px);
  pointer-events:none;
  z-index: 0;
}
.brand a, .brandLink, .brandText, .brand img{ position: relative; z-index: 1; }

.tagline{
  font-weight: 980;
  letter-spacing: .2px;
  color: rgba(11,27,51,.88);
  font-size: 1.18rem;
}
@media (max-width: 560px){
  .tagline{ font-size: 1.02rem; }
}

@media (max-width: 560px){
  .brand::before{
    width: 110px;
    height: 110px;
    left: -10px;
    top: -10px;
    background: radial-gradient(circle at 35% 30%, rgba(31,120,255,.18), rgba(31,120,255,0) 62%);
  }
}
.brand .title{margin:0; font-weight:950; letter-spacing:.2px; font-size:1.05rem;}
.brand .tag{margin:2px 0 0; color:var(--muted); font-weight:700; font-size:.92rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
.pill{
  display:inline-flex; align-items:center; gap:8px;
  height:40px; padding:0 14px;
  border-radius:999px;
  border:1px solid rgba(31,120,255,.18);
  background: rgba(255,255,255,.70);
  font-weight:900;
  text-decoration:none;
  box-shadow: 0 10px 22px rgba(16,60,120,.07);
  transition:.16s ease;
}
.pill:hover{transform: translateY(-1px); border-color: rgba(31,120,255,.30);}
.pill.primary{
  background: linear-gradient(180deg, var(--blue), var(--blue2));
  color:#fff;
  border-color: rgba(31,120,255,.35);
  box-shadow: 0 16px 30px rgba(16,60,120,.16);
}
.hero{
  margin-top:16px;
  padding:24px;
  border-radius: 24px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.78);
  box-shadow: var(--shadow);
}
.hero h1{margin:0 0 6px; font-weight:980; letter-spacing:.2px; font-size:1.45rem;}
.hero p{margin:0; color:var(--muted); font-weight:750; line-height:1.45;}
.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap:14px;
}
.card{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:16px 16px;
  border-radius: var(--r);
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.85);
  box-shadow: var(--shadow2);
  text-decoration:none;
  transition: .16s ease;
  cursor:pointer;
  position:relative;
}
.card:hover{transform: translateY(-2px); border-color: rgba(31,120,255,.30);}
.card:active{transform: translateY(0);}
.left{display:flex; align-items:center; gap:12px; min-width:0;}
.ico{
  width:44px; height:44px; border-radius:14px;
  display:grid; place-items:center;
  background: rgba(31,120,255,.10);
  border:1px solid rgba(31,120,255,.18);
  font-size: 1.15rem;
}
.meta{min-width:0}
.meta .name{margin:0; font-weight:950; letter-spacing:.2px; font-size:1.05rem;}
.meta .desc{margin:2px 0 0; color:var(--muted); font-weight:700; font-size:.92rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.badge{
  height:36px; padding:0 16px;
  border-radius:999px;
  background: rgba(18,51,95,.92);
  color:#fff;
  font-weight:900;
  display:inline-flex; align-items:center; justify-content:center;
}
.footer{margin-top:18px; text-align:center; color: rgba(11,27,51,.55); font-weight:750;}
.page{
  margin-top:16px;
  padding:22px;
  border-radius: 24px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.78);
  box-shadow: var(--shadow);
}
.breadcrumb{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px;}
.breadcrumb a{color: var(--blue2); font-weight:900; text-decoration:none;}
.breadcrumb a:hover{text-decoration: underline; text-underline-offset: 4px;}
@media (max-width: 980px){ .grid{grid-template-columns: repeat(2, minmax(0,1fr));} }
@media (max-width: 560px){
  .container{width:min(var(--max), 94vw);}
  .brand img{height:72px;}
  .grid{grid-template-columns: 1fr;}
  .meta .desc{white-space:normal;}
  .actions{width:100%; justify-content:flex-start;}
}


/* --- Premium depth layer (Letters) --- */
.page{
  position: relative;
}
.page::before{
  content:"";
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at 20% 10%, rgba(31,120,255,.10), rgba(31,120,255,0) 55%),
    radial-gradient(circle at 80% 18%, rgba(88,173,255,.12), rgba(88,173,255,0) 58%),
    radial-gradient(circle at 25% 85%, rgba(31,120,255,.08), rgba(31,120,255,0) 60%),
    linear-gradient(180deg, rgba(247,250,255,.92), rgba(245,248,255,.74));
  pointer-events:none;
  z-index: -1;
}
.card{
  transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
}
.card:hover{
  transform: translateY(-1px);
  box-shadow: 0 18px 36px rgba(16,60,120,.12);
  border-color: rgba(31,120,255,.28);
}
.card:active{
  transform: translateY(0);
  box-shadow: 0 10px 22px rgba(16,60,120,.10);
}
.badge{
  box-shadow: 0 10px 20px rgba(16,60,120,.10);
}
#playArea{
  backdrop-filter: blur(8px);
}
.premiumDivider{
  height:1px;
  background: linear-gradient(90deg, rgba(31,120,255,0), rgba(31,120,255,.20), rgba(31,120,255,0));
  margin: 12px 0;
  border-radius:999px;
}
.kidHint{
  display:flex; gap:10px; align-items:flex-start;
  border:1px solid rgba(31,120,255,.18);
  background: rgba(255,255,255,.78);
  border-radius: 18px;
  padding: 12px;
}
.kidHint .ico{
  width:40px;height:40px;border-radius:14px;
  display:grid;place-items:center;
  background: linear-gradient(180deg, rgba(31,120,255,.14), rgba(255,255,255,.75));
  border:1px solid rgba(31,120,255,.18);
  font-size:1.2rem;
}
.kidHint b{ font-weight: 980; }

/* Finish modal + confetti */
.psModal{
  position: fixed;
  inset: 0;
  display:none;
  align-items:center;
  justify-content:center;
  padding: 18px;
  background: rgba(11,27,51,.46);
  z-index: 9999;
}
.psModal.show{ display:flex; }
.psModalCard{
  width: min(560px, 96vw);
  border-radius: 26px;
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(255,255,255,.50);
  box-shadow: 0 30px 80px rgba(0,0,0,.22);
  padding: 16px;
  position: relative;
  overflow:hidden;
}
.psModalTop{
  display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
}
.psModalTitle{
  margin:0; font-weight: 990; font-size: 1.25rem; letter-spacing:.2px;
}
.psModalMsg{
  margin:6px 0 0; color: rgba(75,100,136,1); font-weight: 800; line-height:1.5;
}
.psModalActions{
  margin-top: 12px;
  display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
}
.psConfetti{
  position:absolute; inset:0; pointer-events:none; opacity:.9;
}
.psConfetti i{
  position:absolute;
  width:10px; height:16px;
  border-radius: 4px;
  background: rgba(31,120,255,.55);
  animation: psFall 1.35s ease-in forwards;
}
@keyframes psFall{
  0%{ transform: translateY(-18px) rotate(0deg); opacity: 0;}
  10%{ opacity: 1;}
  100%{ transform: translateY(420px) rotate(220deg); opacity: 0;}
}

/* --- Premium Hub (Launcher) --- */
.hub{
  margin-top: 14px;
  border: 1px solid var(--stroke);
  border-radius: 26px;
  padding: 14px;
  background: rgba(255,255,255,.72);
  box-shadow: var(--shadow2);
}
.hubTop{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.hubTitle{
  margin:0;
  font-weight: 990;
  letter-spacing:.2px;
  font-size: 1.12rem;
}
.hubSub{
  margin:4px 0 0;
  color: var(--muted);
  font-weight: 780;
}
.hubActions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
.hubGrid{
  margin-top: 12px;
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}
@media (min-width: 860px){
  .hubGrid{ grid-template-columns: repeat(4, minmax(0, 1fr)); }
}
.hubTile{
  text-align:left;
  min-height: 122px;
  padding: 14px;
  border-radius: 22px;
  border: 1px solid rgba(31,120,255,.18);
  background: linear-gradient(180deg, rgba(31,120,255,.08), rgba(255,255,255,.84));
  box-shadow: 0 18px 34px rgba(16,60,120,.10);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  gap:10px;
}
.hubTile .row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.hubIcon{
  width: 44px;
  height: 44px;
  border-radius: 16px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.78);
  border: 1px solid rgba(31,120,255,.18);
  font-size: 1.35rem;
}
.hubName{
  margin:0;
  font-weight: 990;
  font-size: 1.02rem;
}
.hubDesc{
  margin:4px 0 0;
  color: rgba(75,100,136,1);
  font-weight: 800;
  font-size: .92rem;
  line-height: 1.35;
}
.hubChips{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
.chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding: 7px 10px;
  border-radius: 999px;
  font-weight: 900;
  font-size: .78rem;
  border: 1px solid rgba(31,120,255,.18);
  background: rgba(255,255,255,.78);
  color: rgba(18,51,95,.92);
}
.chip.reco{
  background: linear-gradient(180deg, rgba(31,120,255,.18), rgba(255,255,255,.82));
  border-color: rgba(31,120,255,.28);
}
.hubFoot{
  margin-top: 10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
.hubMini{
  color: var(--muted);
  font-weight: 800;
  font-size: .92rem;
}


/* --- Today's Goal strip --- */
.goalStrip{
  margin-top: 12px;
  border: 1px solid rgba(31,120,255,.18);
  background: linear-gradient(180deg, rgba(31,120,255,.10), rgba(255,255,255,.82));
  border-radius: 24px;
  padding: 12px;
  box-shadow: 0 18px 34px rgba(16,60,120,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.goalLeft{
  display:flex;
  align-items:center;
  gap:12px;
}
.goalIcon{
  width: 46px;
  height: 46px;
  border-radius: 18px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.78);
  border: 1px solid rgba(31,120,255,.18);
  font-size: 1.35rem;
}
.goalTitle{
  margin:0;
  font-weight: 990;
  letter-spacing:.2px;
}
.goalSub{
  margin:4px 0 0;
  color: rgba(75,100,136,1);
  font-weight: 800;
  font-size: .92rem;
  line-height: 1.35;
}
.goalRight{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.goalBar{
  width: min(260px, 70vw);
  height: 12px;
  border-radius: 999px;
  background: rgba(31,120,255,.10);
  border: 1px solid rgba(31,120,255,.18);
  overflow:hidden;
}
.goalFill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(31,120,255,.85), rgba(88,173,255,.85));
  transition: width .28s ease;
}
.goalCount{
  font-weight: 950;
  color: rgba(18,51,95,.92);
  white-space:nowrap;
}
@keyframes pop{
  0%{ transform: scale(.98); }
  55%{ transform: scale(1.02); }
  100%{ transform: scale(1); }
}
.pop{ animation: pop .22s ease; }


.brandTagline{
  font-family: "Comic Neue", "Poppins", system-ui, -apple-system, BlinkMacSystemFont;
  font-size: 1.25rem;
  font-weight: 700;
  letter-spacing: .3px;
  color: rgba(11,27,51,.88);
}
@media (max-width: 560px){
  .brandTagline{
    font-size: 1.1rem;
  }
}


/* --- Deeper in-game polish --- */
#playArea{
  border-radius: 28px;
  padding: 16px;
}
.gameShell{
  display:grid;
  grid-template-columns: 1.35fr .65fr;
  gap: 12px;
  align-items:start;
}
@media (max-width: 920px){
  .gameShell{ grid-template-columns: 1fr; }
}
.gameMain{
  border:1px solid rgba(31,120,255,.16);
  background: rgba(255,255,255,.78);
  border-radius: 26px;
  padding: 14px;
  box-shadow: 0 18px 34px rgba(16,60,120,.10);
}
.gameSide{
  border:1px solid rgba(31,120,255,.16);
  background: rgba(255,255,255,.70);
  border-radius: 26px;
  padding: 14px;
  box-shadow: 0 18px 34px rgba(16,60,120,.08);
  position: sticky;
  top: 12px;
}
@media (max-width: 920px){
  .gameSide{ position: static; }
}
.bigPromptCard{
  border: 1px solid rgba(31,120,255,.18);
  background: linear-gradient(180deg, rgba(31,120,255,.12), rgba(255,255,255,.86));
  border-radius: 26px;
  padding: 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.bigPromptTitle{
  margin:0;
  font-weight: 980;
  color: rgba(11,27,51,.78);
}
.bigPromptLetter{
  margin-top: 6px;
  font-weight: 990;
  font-size: 2.5rem;
  letter-spacing: .6px;
}
.promptMetaRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:flex-end;
}
.kpi{
  display:flex;
  flex-direction:column;
  gap:2px;
  padding: 10px 12px;
  border-radius: 18px;
  border:1px solid rgba(31,120,255,.16);
  background: rgba(255,255,255,.78);
  min-width: 112px;
}
.kpi .label{
  font-weight: 900;
  color: var(--muted);
  font-size: .78rem;
}
.kpi .value{
  font-weight: 990;
  color: rgba(18,51,95,.92);
}
.grid3{
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap: 10px;
}
@media (max-width: 560px){
  .grid3{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}
.choiceBtn{
  min-height: 94px;
  font-size: 2.2rem;
  font-weight: 990;
  border-radius: 22px;
}
.choiceBtn small{
  display:block;
  margin-top: 8px;
  font-size: .95rem;
  font-weight: 850;
  color: rgba(75,100,136,1);
  text-transform: capitalize;
}
.feedbackToast{
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%) translateY(8px);
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(31,120,255,.18);
  border-radius: 999px;
  padding: 10px 14px;
  box-shadow: 0 18px 40px rgba(0,0,0,.18);
  font-weight: 950;
  color: rgba(18,51,95,.92);
  display:none;
  z-index: 9998;
}
.feedbackToast.show{
  display:block;
  animation: toastIn .22s ease forwards;
}
@keyframes toastIn{
  from{ opacity:0; transform: translateX(-50%) translateY(14px); }
  to{ opacity:1; transform: translateX(-50%) translateY(0); }
}


/* --- Illustrated picture cards (Sound Match) --- */
.illusWrap{
  width: 100%;
  display:grid;
  place-items:center;
  margin-bottom: 8px;
}
.illusSvg{
  width: 100%;
  max-width: 220px;
  height: 92px;
  border-radius: 18px;
  overflow: hidden;
}
@media (max-width: 560px){
  .illusSvg{ height: 86px; }
}


/* --- Premium micro-interactions --- */
.fadeIn{ animation: fadeInUp .22s ease both; }
@keyframes fadeInUp{ from{ opacity:0; transform: translateY(8px);} to{ opacity:1; transform: translateY(0);} }
.tapGlow{ box-shadow: 0 22px 54px rgba(31,120,255,.18); border-color: rgba(31,120,255,.32) !important; }
.good{ border-color: rgba(34,197,94,.55) !important; box-shadow: 0 24px 54px rgba(34,197,94,.18); animation: goodPop .22s ease both; }
@keyframes goodPop{ 0%{ transform: scale(.98);} 60%{ transform: scale(1.03);} 100%{ transform: scale(1);} }
.bad{ border-color: rgba(239,68,68,.45) !important; animation: shake .22s ease both; }
@keyframes shake{ 0%{ transform: translateX(0);} 25%{ transform: translateX(-3px);} 50%{ transform: translateX(3px);} 75%{ transform: translateX(-2px);} 100%{ transform: translateX(0);} }
.btnPulse{ animation: pulse 1.35s ease-in-out infinite; }
@keyframes pulse{ 0%,100%{ transform: translateY(0); box-shadow: 0 18px 34px rgba(31,120,255,.22);} 50%{ transform: translateY(-1px); box-shadow: 0 24px 54px rgba(31,120,255,.26);} }
@media (prefers-reduced-motion: reduce){
  .fadeIn,.good,.bad,.btnPulse{ animation:none !important; }
  .hubTile,.cardBtn{ transition:none !important; }
}


/* --- Game intro screen --- */
.introCard{
  border: 1px solid rgba(31,120,255,.18);
  background: linear-gradient(180deg, rgba(31,120,255,.10), rgba(255,255,255,.86));
  border-radius: 28px;
  padding: 16px;
  box-shadow: 0 24px 60px rgba(16,60,120,.10);
}
.introTop{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.introTitle{
  margin:0;
  font-weight: 990;
  font-size: 1.35rem;
  letter-spacing:.2px;
}
.introSub{
  margin:6px 0 0;
  color: var(--muted);
  font-weight: 820;
  line-height: 1.45;
}
.introMeta{
  margin-top: 12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
.parentTip{
  margin-top: 12px;
  border: 1px dashed rgba(31,120,255,.24);
  background: rgba(255,255,255,.70);
  border-radius: 22px;
  padding: 12px;
  color: rgba(18,51,95,.92);
  font-weight: 850;
}
.parentTip b{ font-weight: 990; }

</style>
</head>
<body>
  <div class="container">
    <header class="header">
      
<div class="brand">
  <a href="index.html" class="brandLink" style="display:flex;align-items:center;gap:16px;text-decoration:none;">
    <img src="assets/primary-steps-logo.png" alt="Primary Steps logo" onerror="this.style.display='none'">
    <div class="brandText" style="display:flex;flex-direction:column;line-height:1;">
      <div class="brandTagline">Simple, calm learning activities</div>
    </div>
  </a>
</div>

      </div>
    </a>
  </div>
      </div>
      <div class="actions">
        <span class="pill" style="cursor:default">‚≠ê <span id="starsCount">0</span> stars</span>
        <a class="pill" href="settings.html">Settings</a>
        <a class="pill primary" href="index.html">Home</a>
      </div>
    </header>

    
<section class="page" id="lettersPage">
  <div class="breadcrumb"><a href="index.html">‚Üê Back to Home</a></div>

  <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap">
    <div style="min-width:260px;flex:1 1 420px">
      <h2 style="margin:0 0 6px; font-weight:980; letter-spacing:.2px;">üî§ Letters</h2>
      <p style="margin:0; color:var(--muted); font-weight:750; line-height:1.5;">
        Play quick letter games with voice prompts. Start easy, then level up.
      </p>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
      <button class="pill" id="soundToggle" type="button" aria-pressed="false" title="Toggle voice prompts">
        üîá Voice: Off
      </button>
      <button class="pill primary" id="resetBtn" type="button" title="Reset this page (keeps total stars)">
        Reset activity
      </button>
    </div>
  </div>

  <!-- Activity Launcher -->
  <div class="hub" id="activityHub">
    <div class="hubTop">
      <div>
        <p class="hubTitle">Choose a game</p>
        <p class="hubSub">Quick, calm activities with clear goals ‚Äî like a proper learning site.</p>
      </div>
      <div class="hubActions">
        <button class="pill" id="quickStart" type="button" title="Start the recommended game">‚ö° Quick start</button>
        <button class="pill" id="viewBadges" type="button" title="Scroll to badges">üèÖ Badges</button>
      </div>
    </div>

    <div class="hubGrid">
      <button class="hubTile" id="launchFind" type="button" aria-controls="playArea">
        <div class="row">
          <div class="hubIcon" aria-hidden="true">üîé</div>
          <span class="chip reco" id="recoFind" style="display:none">Recommended</span>
        </div>
        <div>
          <p class="hubName">Find the Letter</p>
          <p class="hubDesc">Listen, then tap the correct letter (5 rounds)</p>
        </div>
        <div class="hubChips">
          <span class="chip">Level game</span>
          <span class="chip">Voice</span>
        </div>
      </button>

      <button class="hubTile" id="launchMatch" type="button" aria-controls="playArea">
        <div class="row">
          <div class="hubIcon" aria-hidden="true">üî§</div>
          <span class="chip reco" id="recoMatch" style="display:none">Recommended</span>
        </div>
        <div>
          <p class="hubName">Upper & Lower Match</p>
          <p class="hubDesc">Match BIG letters to small letters (5 rounds)</p>
        </div>
        <div class="hubChips">
          <span class="chip">Matching</span>
          <span class="chip">Level game</span>
        </div>
      </button>

      <button class="hubTile" id="launchSoundMatch" type="button" aria-controls="playArea">
        <div class="row">
          <div class="hubIcon" aria-hidden="true">üß†</div>
          <span class="chip reco" id="recoSound" style="display:none">Recommended</span>
        </div>
        <div>
          <p class="hubName">Beginning Sound Match</p>
          <p class="hubDesc">Pick the picture that starts with the letter (5 rounds)</p>
        </div>
        <div class="hubChips">
          <span class="chip">Sounds</span>
          <span class="chip">Level game</span>
        </div>
      </button>

      <button class="hubTile" id="launchSoundTap" type="button" aria-controls="playArea">
        <div class="row">
          <div class="hubIcon" aria-hidden="true">üîä</div>
          <span class="chip reco" id="recoTap" style="display:none">Recommended</span>
        </div>
        <div>
          <p class="hubName">Letter Sound Tap</p>
          <p class="hubDesc">Tap a letter to hear it spoken (practice mode)</p>
        </div>
        <div class="hubChips">
          <span class="chip">Warm‚Äëup</span>
          <span class="chip">Easy</span>
        </div>
      </button>
    </div>

    <div class="hubFoot">
      <div class="hubMini" id="hubMiniText">Tip: Start with Level 1 for confidence, then move up.</div>
      <div class="hubActions">
        <span class="pill" style="cursor:default">üéØ Goal: 5 rounds</span>
        <span class="pill" style="cursor:default">‚≠ê Stars & badges</span>
      </div>
    </div>
  
  <div class="goalStrip" id="goalStrip">
    <div class="goalLeft">
      <div class="goalIcon" aria-hidden="true">üéØ</div>
      <div>
        <p class="goalTitle">Today‚Äôs Goal</p>
        <p class="goalSub" id="goalSub">Complete 2 games to earn a bonus badge.</p>
      </div>
    </div>
    <div class="goalRight">
      <div class="goalBar" aria-hidden="true"><div class="goalFill" id="goalFill"></div></div>
      <div class="goalCount" id="goalCount">0 / 2</div>
      <button class="pill primary" id="continueBtn" type="button">Continue</button>
      <button class="pill" id="resetTodayBtn" type="button" title="Reset today‚Äôs goal on this device">Reset</button>
    </div>
  </div>
</div>

<!-- Play Area -->
  <div id="playArea" style="margin-top:14px; border:1px solid var(--stroke); border-radius: 24px; padding:14px; background: rgba(255,255,255,.70); box-shadow: var(--shadow2);">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div style="min-width:260px;flex:1 1 420px">
        <p id="activityTitle" style="margin:0; font-weight:980; font-size:1.05rem;">Select an activity</p>
        <p id="activitySub" style="margin:4px 0 0; color:var(--muted); font-weight:750;">Pick a game above to start.</p>

        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center">
          <button class="pill" id="repeatPrompt" type="button" title="Repeat the instruction" disabled style="opacity:.6">
            üîÅ Say again
          </button>
          <span id="feedback" style="font-weight:950; color: rgba(11,27,51,.78);" aria-live="polite"></span>
        </div>

        <div style="margin-top:10px">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
            <span style="font-weight:900;color:var(--muted)">Streak</span>
            <span id="streakLabel" style="font-weight:950;color:rgba(11,27,51,.72)">0 / 3</span>
          </div>
          <div style="margin-top:6px; height:10px; border-radius:999px; background: rgba(31,120,255,.10); border:1px solid rgba(31,120,255,.18); overflow:hidden">
            <div id="streakBar" style="height:100%; width:0%; border-radius:999px; background: linear-gradient(180deg, var(--blue), var(--blue2));"></div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end">
        <div style="display:flex;gap:8px;align-items:center">
          <span style="font-weight:900;color:var(--muted)">Level</span>
          <select id="levelSelect" class="pill" style="height:40px; padding-right:10px; cursor:pointer">
            <option value="1">Level 1 ‚Ä¢ 3 letters (Set 1)</option>
            <option value="2">Level 2 ‚Ä¢ 6 letters (Set 1)</option>
            <option value="3">Level 3 ‚Ä¢ 6 letters (Set 2)</option>
          </select>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <span style="font-weight:900;color:var(--muted)">Difficulty</span>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="pill" id="diffEasy" type="button" aria-pressed="true">Easy (3)</button>
            <button class="pill" id="diffHard" type="button" aria-pressed="false">Hard (6)</button>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <span style="font-weight:900;color:var(--muted)">Set</span>
          <select id="setSelect" class="pill" style="height:40px; padding-right:10px; cursor:pointer">
            <option value="0">Set 1</option>
            <option value="1">Set 2</option>
            <option value="2">Set 3</option>
          </select>
        </div>

        <span class="pill" style="cursor:default">‚≠ê Session: <span id="sessionStars">0</span></span>
      </div>
    </div>

    <div id="activityBody" style="margin-top:12px; display:grid; gap:12px;">
      <div style="padding:12px;border-radius:18px;border:1px dashed rgba(31,120,255,.28);color:var(--muted);font-weight:750;">
        Tip: Turn Voice on, then tap <b>Play</b> above. Use <b>Say again</b> any time.
      </div>
    </div>
  </div>
  <!-- Badges -->
  <div style="margin-top:14px; border:1px solid var(--stroke); border-radius: 24px; padding:14px; background: rgba(255,255,255,.70); box-shadow: var(--shadow2);">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>
        <p style="margin:0; font-weight:980;">üèÖ Badges</p>
        <p style="margin:4px 0 0; color:var(--muted); font-weight:750;">Earn badges by completing levels. Badges save on this device.</p>
      </div>
      <button class="pill" id="resetBadges" type="button" title="Clear badges on this device">Reset badges</button>
    </div>

    <div id="badgesGrid" style="margin-top:12px; display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px;"></div>
  </div>


  <!-- Earn a star (global) -->
  <div style="margin-top:14px; display:grid; gap:12px;">
    <div style="border:1px solid var(--stroke); border-radius: var(--r); padding:14px; background: rgba(255,255,255,.70); box-shadow: var(--shadow2);">
      <p style="margin:0 0 8px; font-weight:900;">Quick tips</p>
      <ul style="margin:0; padding-left:18px; color:var(--muted); font-weight:750; line-height:1.55;">
        <li>Keep sessions under 5 minutes.</li>
        <li>Celebrate quickly, then move on.</li>
        <li>If it feels hard, go back to Easy.</li>
      </ul>
    </div>

    <div class="card" style="cursor:default;">
      <div class="left">
        <div class="ico" aria-hidden="true">‚≠ê</div>
        <div class="meta">
          <p class="name">Earn a star</p>
          <p class="desc">Tap when you finish a small goal</p>
        </div>
      </div>
      <button class="badge" id="starBtn" type="button" style="border:none; cursor:pointer;">Add ‚≠ê</button>
    </div>
  </div>

  <!-- Premium finish modal -->
  <div class="psModal" id="psModal" role="dialog" aria-modal="true" aria-label="Activity result">
    <div class="psModalCard">
      <div class="psConfetti" id="psConfetti" aria-hidden="true"></div>
      <div class="psModalTop">
        <div>
          <p class="psModalTitle" id="psModalTitle">Great job!</p>
          <p class="psModalMsg" id="psModalMsg">You finished the level.</p>
        </div>
        <button class="pill" id="psModalClose" type="button" aria-label="Close">‚úï</button>
      </div>
      <div class="premiumDivider"></div>
      <div class="kidHint" style="margin-top:2px">
        <div class="ico" aria-hidden="true">üí°</div>
        <div style="font-weight:800;color:rgba(75,100,136,1);line-height:1.45">
          <b>Tip:</b> Keep it short. Two great minutes beats ten tired minutes.
        </div>
      </div>
      <div class="psModalActions">
        <button class="pill" id="psModalAgain" type="button">Play again</button>
        <button class="pill primary" id="psModalNext" type="button">Try another game</button>
      </div>
    </div>
  </div>
</section>





    <div class="footer">¬© 2025 Primary Steps</div>
  </div>


<div class="feedbackToast" id="feedbackToast" role="status" aria-live="polite"></div>

<script>
(function(){
  "use strict";

  // ---------- DOM helpers ----------
  function $(id){ return document.getElementById(id); }
  function el(tag, attrs, kids){
    var n = document.createElement(tag);
    if(attrs){
      Object.keys(attrs).forEach(function(k){
        if(k === "class") n.className = attrs[k];
        else if(k === "style") n.setAttribute("style", attrs[k]);
        else if(k.startsWith("aria-")) n.setAttribute(k, attrs[k]);
        else n[k] = attrs[k];
      });
    }

  // ---------- Micro-interactions ----------
  function pulseOnce(node){
    if(!node) return;
    node.classList.remove("tapGlow");
    void node.offsetWidth;
    node.classList.add("tapGlow");
    setTimeout(function(){ node.classList.remove("tapGlow"); }, 220);
  }
  function markGood(node){
    if(!node) return;
    node.classList.remove("bad");
    node.classList.add("good");
    setTimeout(function(){ node.classList.remove("good"); }, 520);
  }
  function markBad(node){
    if(!node) return;
    node.classList.remove("good");
    node.classList.add("bad");
    setTimeout(function(){ node.classList.remove("bad"); }, 420);
  }
  function mountGame(){
    var gb = $("gameBody");
    if(!gb) return;
    gb.classList.remove("fadeIn");
    void gb.offsetWidth;
    gb.classList.add("fadeIn");
  }
    (kids || []).forEach(function(k){
      if(k == null) return;
      if(typeof k === "string") n.appendChild(document.createTextNode(k));
      else n.appendChild(k);
    });
    return n;
  }

  // ---------- State ----------
  var playArea = $("playArea");
  var soundToggle = $("soundToggle");
  var resetBtn = $("resetBtn");
  var repeatPromptBtn = $("repeatPrompt");
  var levelSelect = $("levelSelect");
  var setSelect = $("setSelect");
  var diffEasy = $("diffEasy");
  var diffHard = $("diffHard");
  var sessionStarsEl = $("sessionStars");

  var launchFind = $("launchFind");
  var launchMatch = $("launchMatch");
  var launchSoundMatch = $("launchSoundMatch");
  var launchSoundTap = $("launchSoundTap");

  var lastPrompt = "";
  var voiceOn = (localStorage.getItem("ps_voice_on") || "false") === "true";
  var difficulty = Number(localStorage.getItem("ps_letters_diff") || "3");
  var setIndex = Number(localStorage.getItem("ps_letters_set") || "0");
  var sessionStars = Number(localStorage.getItem("ps_letters_sessionStars") || "0");

  function setStars(n){
    sessionStars = n;
    try{ localStorage.setItem("ps_letters_sessionStars", String(sessionStars)); }catch(e){}
    if(sessionStarsEl) sessionStarsEl.textContent = String(sessionStars);
  }
  setStars(sessionStars);

  function setVoiceUI(){
    if(!soundToggle) return;
    soundToggle.setAttribute("aria-pressed", voiceOn ? "true" : "false");
    soundToggle.textContent = (voiceOn ? "üîä Voice: On" : "üîá Voice: Off");
  }
  setVoiceUI();

  // Prefer en-GB female if available, but fall back safely.
  var cachedVoices = [];
  function loadVoices(){
    try{ cachedVoices = window.speechSynthesis ? speechSynthesis.getVoices() : []; }catch(e){ cachedVoices = []; }
  }
  if("speechSynthesis" in window){
    loadVoices();
    window.speechSynthesis.onvoiceschanged = loadVoices;
  }

  function speak(text){
    lastPrompt = text || "";
    if(!voiceOn) return;
    if(!("speechSynthesis" in window)) return;
    try{
      window.speechSynthesis.cancel();
      var u = new SpeechSynthesisUtterance(text);
      // try to select a UK English female-ish voice if present
      var v = cachedVoices.find(function(v){
        var lang = (v.lang || "").toLowerCase();
        return lang.includes("en-gb") && /female|woman|google uk english female/i.test(v.name || "");
      }) || cachedVoices.find(function(v){
        var lang = (v.lang || "").toLowerCase();
        return lang.includes("en-gb");
      }) || cachedVoices.find(function(v){
        var lang = (v.lang || "").toLowerCase();
        return lang.includes("en");
      });
      if(v) u.voice = v;
      u.rate = 0.95;
      u.pitch = 1.05;
      window.speechSynthesis.speak(u);
    }catch(e){}
  }

  function promptSayAgain(){
    if(lastPrompt) speak(lastPrompt);
  }

  function setPrompt(text){
    lastPrompt = text || "";
  }

  function clearPlay(){
    if(!playArea) return;
    playArea.innerHTML = "";
    playArea.appendChild(
      el("div", {class:"card", style:"border-radius:24px; padding:14px; background: rgba(255,255,255,.75); border:1px solid rgba(31,120,255,.18);"}, [
        el("p", {style:"margin:0;font-weight:990;font-size:1.05rem;"}, ["Select an activity"]),
        el("p", {style:"margin:6px 0 0;color:rgba(75,100,136,1);font-weight:800;"}, ["Pick a game above to start."])
      ])
    );
    setPrompt("");
  }

  // ---------- Level / difficulty / set ----------
  var LEVELS = {
    1: {difficulty: 3, setIndex: 0},
    2: {difficulty: 6, setIndex: 0},
    3: {difficulty: 6, setIndex: 1}
  };

  var LETTER_SETS = [
    "ABCDEF",          // Set 1
    "GHIJKL",          // Set 2
    "MNOPQR",          // Set 3
    "STUVWX",          // Set 4
    "YZ"               // Set 5
  ];

  function currentLetters(){
    var setStr = LETTER_SETS[Math.max(0, Math.min(LETTER_SETS.length-1, setIndex))] || "ABC";
    var arr = setStr.split("");
    return arr.slice(0, Math.min(arr.length, difficulty));
  }

  function refreshControls(){
    if(setSelect) setSelect.value = String(setIndex + 1); // UI is 1-based in your HTML
    if(diffEasy) diffEasy.setAttribute("aria-pressed", difficulty === 3 ? "true":"false");
    if(diffHard) diffHard.setAttribute("aria-pressed", difficulty === 6 ? "true":"false");
    // infer level
    if(levelSelect){
      var inferred = 0;
      Object.keys(LEVELS).forEach(function(k){
        var L = LEVELS[k];
        if(L.difficulty === difficulty && L.setIndex === setIndex) inferred = Number(k);
      });
      if(inferred) levelSelect.value = String(inferred);
    }
  }

  // Some versions of your HTML use setSelect values like "Set 1/2/3" etc. We'll read numeric.
  function parseSetValue(v){
    if(v == null) return 0;
    var s = String(v);
    var m = s.match(/\d+/);
    return m ? (Number(m[0]) - 1) : 0;
  }

  if(levelSelect){
    levelSelect.addEventListener("change", function(){
      var k = Number(levelSelect.value || "1");
      var L = LEVELS[k];
      if(L){
        difficulty = L.difficulty;
        setIndex = L.setIndex;
        try{
          localStorage.setItem("ps_letters_diff", String(difficulty));
          localStorage.setItem("ps_letters_set", String(setIndex));
        }catch(e){}
        refreshControls();
        clearPlay();
        speak("Level changed.");
      }
    });
  }

  if(setSelect){
    setSelect.addEventListener("change", function(){
      setIndex = parseSetValue(setSelect.value);
      try{ localStorage.setItem("ps_letters_set", String(setIndex)); }catch(e){}
      refreshControls();
      clearPlay();
      speak("Set changed.");
    });
  }

  if(diffEasy){
    diffEasy.addEventListener("click", function(){
      difficulty = 3;
      try{ localStorage.setItem("ps_letters_diff", String(difficulty)); }catch(e){}
      refreshControls();
      clearPlay();
      speak("Easy mode.");
    });
  }
  if(diffHard){
    diffHard.addEventListener("click", function(){
      difficulty = 6;
      try{ localStorage.setItem("ps_letters_diff", String(difficulty)); }catch(e){}
      refreshControls();
      clearPlay();
      speak("Hard mode.");
    });
  }

  refreshControls();

  // ---------- Sound bank (for Beginning Sound Match) ----------
  var SOUND_BANK = {
    A: [{w:"apple", e:"üçé"},{w:"ant", e:"üêú"},{w:"astronaut", e:"üßë‚ÄçüöÄ"}],
    B: [{w:"ball", e:"‚öΩ"},{w:"banana", e:"üçå"},{w:"bus", e:"üöå"}],
    C: [{w:"cat", e:"üê±"},{w:"car", e:"üöó"},{w:"cake", e:"üéÇ"}],
    D: [{w:"dog", e:"üê∂"},{w:"duck", e:"ü¶Ü"},{w:"drum", e:"ü•Å"}],
    E: [{w:"egg", e:"ü•ö"},{w:"elephant", e:"üêò"},{w:"earth", e:"üåç"}],
    F: [{w:"fish", e:"üêü"},{w:"frog", e:"üê∏"},{w:"flower", e:"üåº"}],
    G: [{w:"goat", e:"üêê"},{w:"grapes", e:"üçá"},{w:"guitar", e:"üé∏"}],
    H: [{w:"hat", e:"üß¢"},{w:"horse", e:"üê¥"},{w:"house", e:"üè†"}],
    I: [{w:"ice", e:"üßä"},{w:"igloo", e:"üè†"},{w:"insect", e:"ü™≤"}],
    J: [{w:"jam", e:"üçì"},{w:"jellyfish", e:"ü™º"},{w:"jeep", e:"üöô"}],
    K: [{w:"kite", e:"ü™Å"},{w:"key", e:"üîë"},{w:"koala", e:"üê®"}],
    L: [{w:"lion", e:"ü¶Å"},{w:"leaf", e:"üçÉ"},{w:"lamp", e:"üí°"}],
    M: [{w:"moon", e:"üåô"},{w:"monkey", e:"üêí"},{w:"milk", e:"ü•õ"}],
    N: [{w:"nest", e:"ü™π"},{w:"nose", e:"üëÉ"},{w:"noodles", e:"üçú"}],
    O: [{w:"octopus", e:"üêô"},{w:"orange", e:"üçä"},{w:"owl", e:"ü¶â"}],
    P: [{w:"panda", e:"üêº"},{w:"pizza", e:"üçï"},{w:"pencil", e:"‚úèÔ∏è"}],
    Q: [{w:"queen", e:"üëë"},{w:"quilt", e:"üßµ"},{w:"question", e:"‚ùì"}],
    R: [{w:"robot", e:"ü§ñ"},{w:"rainbow", e:"üåà"},{w:"rabbit", e:"üê∞"}],
    S: [{w:"sun", e:"‚òÄÔ∏è"},{w:"snake", e:"üêç"},{w:"star", e:"‚≠ê"}],
    T: [{w:"tiger", e:"üêØ"},{w:"train", e:"üöÜ"},{w:"tree", e:"üå≥"}],
    U: [{w:"umbrella", e:"‚òÇÔ∏è"},{w:"unicorn", e:"ü¶Ñ"},{w:"up", e:"‚¨ÜÔ∏è"}],
    V: [{w:"violin", e:"üéª"},{w:"van", e:"üöê"},{w:"volcano", e:"üåã"}],
    W: [{w:"whale", e:"üê≥"},{w:"watch", e:"‚åö"},{w:"water", e:"üíß"}],
    X: [{w:"xylophone", e:"üé∂"},{w:"x-ray", e:"ü©ª"},{w:"box", e:"üì¶"}],
    Y: [{w:"yoyo", e:"ü™Ä"},{w:"yak", e:"üêÇ"},{w:"yellow", e:"üíõ"}],
    Z: [{w:"zebra", e:"ü¶ì"},{w:"zip", e:"üß∑"},{w:"zoo", e:"ü¶Å"}]
  };

  // Lightweight illustration SVG
  function makeIllustrationSvg(emoji, seed){
    seed = String(seed || "");
    var a = (seed.charCodeAt(0) || 65) % 3;
    var b = (seed.charCodeAt(1) || 90) % 3;
    var glow1 = a === 0 ? "rgba(31,120,255,.22)" : (a === 1 ? "rgba(88,173,255,.22)" : "rgba(255,255,255,.30)");
    var glow2 = b === 0 ? "rgba(31,120,255,0)" : (b === 1 ? "rgba(88,173,255,0)" : "rgba(255,255,255,0)");
    return (
      '<svg class="illusSvg" viewBox="0 0 420 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Picture">' +
        '<defs>' +
          '<linearGradient id="g1" x1="0" y1="0" x2="0" y2="1">' +
            '<stop offset="0" stop-color="rgba(31,120,255,.14)"/>' +
            '<stop offset="1" stop-color="rgba(255,255,255,.86)"/>' +
          '</linearGradient>' +
          '<radialGradient id="rg" cx="30%" cy="22%" r="70%">' +
            '<stop offset="0" stop-color="'+glow1+'"/>' +
            '<stop offset="1" stop-color="'+glow2+'"/>' +
          '</radialGradient>' +
          '<filter id="s" x="-20%" y="-20%" width="140%" height="160%">' +
            '<feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="rgba(16,60,120,.18)"/>' +
          '</filter>' +
        '</defs>' +
        '<rect x="10" y="10" width="400" height="160" rx="32" fill="url(#g1)" stroke="rgba(31,120,255,.18)" />' +
        '<rect x="10" y="10" width="400" height="160" rx="32" fill="url(#rg)" opacity=".95"/>' +
        '<circle cx="'+(320 + a*18)+'" cy="'+(48 + b*10)+'" r="16" fill="rgba(255,255,255,.55)" />' +
        '<circle cx="'+(350 + b*12)+'" cy="'+(86 + a*8)+'" r="10" fill="rgba(31,120,255,.18)" />' +
        '<circle cx="'+(70 + a*10)+'" cy="'+(120 + b*8)+'" r="12" fill="rgba(88,173,255,.18)" />' +
        '<g filter="url(#s)">' +
          '<rect x="150" y="36" width="120" height="108" rx="28" fill="rgba(255,255,255,.78)" stroke="rgba(31,120,255,.18)"/>' +
          '<text x="210" y="114" text-anchor="middle" font-size="64" font-family="Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, sans-serif">'+emoji+'</text>' +
        '</g>' +
      '</svg>'
    );
  }

  // ---------- Game framework ----------
  function headerBlock(title, subtitle){
    return el("div", {style:"display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap"}, [
      el("div", {}, [
        el("div", {style:"font-weight:990;font-size:1.05rem;"}, [title]),
        el("div", {style:"margin-top:4px;color:rgba(75,100,136,1);font-weight:800;"}, [subtitle || ""])
      ]),
      el("div", {style:"display:flex;gap:8px;flex-wrap:wrap;align-items:center"}, [
        el("button", {class:"pill", type:"button", id:"repeatMini", title:"Repeat the instruction"}, ["üîÅ Say again"]),
        el("button", {class:"pill primary", type:"button", id:"startGame"}, ["Start"])
      ])
    ]);
  }

  function gameFrame(){
    return el("div", {style:"border:1px solid rgba(31,120,255,.18);background:rgba(255,255,255,.78);border-radius:26px;box-shadow: 0 18px 34px rgba(16,60,120,.10);padding:14px;display:grid;gap:12px;"}, []);
  }

  function dotsRow(total){
    var row = el("div", {style:"display:flex;gap:8px;align-items:center;"}, []);
    for(var i=0;i<total;i++){
      row.appendChild(el("div", {class:"psDot", style:"width:12px;height:12px;border-radius:999px;background:rgba(31,120,255,.10);border:1px solid rgba(31,120,255,.22);"}, []));
    }
    return row;
  }
  function paintDots(root, round){
    var dots = root.querySelectorAll(".psDot");
    dots.forEach(function(d, idx){
      if(idx < round){
        d.style.background = "linear-gradient(180deg, rgba(31,120,255,.92), rgba(88,173,255,.92))";
        d.style.borderColor = "rgba(31,120,255,.35)";
      }else{
        d.style.background = "rgba(31,120,255,.10)";
        d.style.borderColor = "rgba(31,120,255,.22)";
      }
    });
  }

  function bigPrompt(title, value, leftKpi, rightKpi){
    return el("div", {class:"bigPromptCard"}, [
      el("div", {}, [
        el("p", {class:"bigPromptTitle", style:"margin:0;"}, [title]),
        el("div", {class:"bigPromptLetter", id:"promptValue"}, [value || ""])
      ]),
      el("div", {class:"promptMetaRow"}, [
        el("div", {class:"kpi"}, [
          el("div", {class:"label"}, [leftKpi.label]),
          el("div", {class:"value", id:leftKpi.id}, [leftKpi.value])
        ]),
        el("div", {class:"kpi"}, [
          el("div", {class:"label"}, [rightKpi.label]),
          el("div", {class:"value", id:rightKpi.id}, [rightKpi.value])
        ])
      ])
    ]);
  }

  function feedbackRow(){
    return el("div", {style:"border-radius:18px;padding:12px;border:1px solid rgba(31,120,255,.18);background:rgba(255,255,255,.78);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;"}, [
      el("div", {id:"fbText", style:"font-weight:950;color:rgba(75,100,136,1);"}, ["Press Start to begin."]),
      el("button", {class:"pill primary", type:"button", id:"nextBtn", style:"display:none"}, ["Next"])
    ]);
  }

  function showToast(msg){
    // If your CSS toast exists, use it, otherwise no-op
    var t = $("feedbackToast");
    if(!t) return;
    t.textContent = msg;
    t.classList.add("show");
    window.clearTimeout(showToast._tm);
    showToast._tm = window.setTimeout(function(){ t.classList.remove("show"); }, 1200);
  }

  function awardStars(score, total){
    if(score >= total - 1){ // 4/5 or 5/5
      setStars(sessionStars + 1);
      if(score === total) setStars(sessionStars + 2);
    }
  }

  // ---------- Activities ----------

      // ---------- Game intro ----------
      function gameIntroConfig(key){
        var lvl = levelSelect ? Number(levelSelect.value || "1") : 1;
        var diffLabel = (difficulty === 3) ? "Easy (3)" : "Hard (6)";
        var setLabel = "Set " + (setIndex + 1);

        var cfg = {
          key: key,
          title: "Activity",
          icon: "üéÆ",
          lines: ["Press Start to begin."],
          parent: "Keep it short: 3‚Äì5 minutes is perfect.",
          tags: ["Level " + lvl, diffLabel, setLabel]
        };

        if(key === "find"){
          cfg.title = "Find the Letter";
          cfg.icon = "üîé";
          cfg.lines = ["Listen carefully.", "Tap the correct letter.", "5 quick rounds."];
          cfg.parent = "Parent tip: Let them try first, then press ‚ÄúSay again‚Äù if needed.";
        }else if(key === "match"){
          cfg.title = "Upper & Lower Match";
          cfg.icon = "üî§";
          cfg.lines = ["Look at the BIG letter.", "Tap the matching small letter.", "5 quick rounds."];
          cfg.parent = "Parent tip: If they struggle, say the letter name out loud together.";
        }else if(key === "sound"){
          cfg.title = "Beginning Sound Match";
          cfg.icon = "üß†";
          cfg.lines = ["Listen for the starting sound.", "Pick the picture that starts with the letter.", "5 quick rounds."];
          cfg.parent = "Parent tip: Say the word slowly and stretch the first sound (e.g. ‚Äúaaaa-pple‚Äù).";
        }else if(key === "tap"){
          cfg.title = "Letter Sound Tap";
          cfg.icon = "üîä";
          cfg.lines = ["Tap a letter to hear it.", "Great warm‚Äëup before a level game."];
          cfg.parent = "Parent tip: Try 3 letters, then stop while it‚Äôs still fun.";
          cfg.tags = [diffLabel, setLabel];
        }
        return cfg;
      }

      function showIntro(key){
        currentActivity = key;
        setHeader("Get ready", "Press Start when you're ready.");
        clearGame();

        var cfg = gameIntroConfig(key);

        var card = document.createElement("div");
        card.className = "introCard";
        card.innerHTML =
          '<div class="introTop">' +
            '<div>' +
              '<p class="introTitle">'+ cfg.icon +' ' + cfg.title + '</p>' +
              '<p class="introSub">' + cfg.lines.map(function(x){ return '‚Ä¢ ' + x; }).join('<br>') + '</p>' +
            '</div>' +
            '<div class="hubActions">' +
              '<button class="pill" id="introBack" type="button">‚Üê Choose another</button>' +
              '<button class="pill primary btnPulse" id="introStart" type="button">Start</button>' +
            '</div>' +
          '</div>' +
          '<div class="introMeta">' +
            cfg.tags.map(function(t){ return '<span class="chip">'+t+'</span>'; }).join('') +
          '</div>' +
          '<div class="parentTip"><b>Parent tip:</b> ' + cfg.parent + '</div>';

        gameBody.appendChild(card);

        var back = $("introBack");
        var start = $("introStart");

        if(back){
          back.addEventListener("click", function(){
            setHeader("Select an activity", "Pick a game above to start.");
            clearGame();
            $("activityHub").scrollIntoView({behavior:"smooth", block:"start"});
          });
        }

        if(start){
          start.addEventListener("click", function(){
            start.classList.remove("btnPulse");
            if(key === "find") startFind(true);
            else if(key === "match") startMatch(true);
            else if(key === "sound") startSound(true);
            else if(key === "tap") startTap(true);
            mountGame();
          });
        }
      }


  function startFind(autoStart){
    if(!playArea) return;
    playArea.innerHTML = "";
    var TOTAL = 5, round = 0, score = 0;
    var letters = currentLetters();
    var frame = gameFrame();
    frame.appendChild(headerBlock("Find the Letter", "Listen, then tap the correct letter (5 rounds)."));
    var dots = dotsRow(TOTAL);
    frame.appendChild(dots);
    frame.appendChild(bigPrompt("Find this letter", "‚ñ∂", {label:"Round", id:"kRound", value:"0 / 5"}, {label:"Score", id:"kScore", value:"0"}));

    var grid = el("div", {class:"grid3", id:"findGrid", style:"display:grid;gap:10px;opacity:.55;pointer-events:none;"}, []);
    var hint = el("div", {class:"gridLockHint"}, [ el("div", {}, ["‚ñ∂ Press Start to play"]) ]);
    var gridWrap = el("div", {style:"position:relative"}, [grid, hint]);
    frame.appendChild(gridWrap);

    var fb = feedbackRow();
    frame.appendChild(fb);
    playArea.appendChild(frame);

    var startBtn = $("startGame");
    var repeatBtn = $("repeatMini");
    var nextBtn = $("nextBtn");
    var fbText = $("fbText");
    var promptEl = $("promptValue");
    var kRound = $("kRound");
    var kScore = $("kScore");

    function lock(yes){
      grid.style.opacity = yes ? ".55" : "1";
      grid.style.pointerEvents = yes ? "none" : "auto";
      hint.style.display = yes ? "" : "none";
    }
    function setFB(msg, good){
      fbText.textContent = msg;
      fbText.style.color = good ? "rgba(18,51,95,.92)" : "rgba(75,100,136,1)";
      showToast(msg);
    }
    function update(){
      kRound.textContent = round + " / " + TOTAL;
      kScore.textContent = String(score);
      paintDots(frame, round);
    }

    function buildRound(){
      var target = letters[Math.floor(Math.random()*letters.length)];
      promptEl.textContent = target;
      setPrompt("Find " + target);
      speak("Find " + target + ".");
      var opts = [target];
      while(opts.length < 3){
        var o = letters[Math.floor(Math.random()*letters.length)];
        if(opts.indexOf(o) === -1) opts.push(o);
      }
      opts.sort(function(){ return Math.random() - 0.5; });

      grid.innerHTML = "";
      opts.forEach(function(ch){
        var b = el("button", {type:"button", class:"card choiceBtn"}, [ch]);
        b.addEventListener("click", function(){
      if(ch === target){
        markGood(b);
        score += 1;
        setFB("‚úÖ Correct!", true);
        // Lock choices so we don't get double-taps
        lock(true);
        // Auto-advance after a short beat (kids shouldn't need to press Next)
        nextBtn.style.display = "none";
        speak("Well done.");
        setTimeout(function(){
          try{
            if((round + 1) >= TOTAL) finish();
            else next();
          }catch(e){
            console.error(e);
            // Failsafe: unlock and show Next so it never gets stuck
            lock(false);
            nextBtn.style.display = "";
            setFB("Nice! Tap Next.", true);
          }
        }, 650);
      }else{
            setFB("Try again.", false);
            speak("Try again.");
          }
          update();
        });
        grid.appendChild(b);
      });
    }

    function next(){
      round += 1;
      update();
      nextBtn.style.display = "none";
      lock(false);
      setFB("Tap the correct letter.", true);
      buildRound();
    }

    function finish(){
      lock(true);
      var msg = "Finished! You got " + score + " out of " + TOTAL + ".";
      setFB(msg, true);
      speak("Great work. " + msg);
      awardStars(score, TOTAL);
      startBtn.textContent = "Play again";
      startBtn.style.display = "";
    }

    startBtn.addEventListener("click", function(){
      startBtn.classList.remove("btnPulse");
      startBtn.classList.remove("btnPulse");
      startBtn.classList.remove("btnPulse");
      score = 0; round = 0;
      update();
      startBtn.style.display = "none";
      speak("Let's play.");
      next();
    });
    nextBtn.addEventListener("click", function(){
      if(round >= TOTAL) finish();
      else next();
    });
    repeatBtn.addEventListener("click", promptSayAgain);

    update();
    lock(true);
  }

  function startMatch(autoStart){
    if(!playArea) return;
    playArea.innerHTML = "";
    var TOTAL = 5, round = 0, score = 0;
    var letters = currentLetters();
    var lowers = letters.map(function(x){ return x.toLowerCase(); });
    var frame = gameFrame();
    frame.appendChild(headerBlock("Upper & Lower Match", "Match the BIG letter to the small letter (5 rounds)."));
    var dots = dotsRow(TOTAL);
    frame.appendChild(dots);
    frame.appendChild(bigPrompt("Match this letter", "‚ñ∂", {label:"Round", id:"mRound", value:"0 / 5"}, {label:"Score", id:"mScore", value:"0"}));

    var grid = el("div", {class:"grid3", id:"matchGrid", style:"display:grid;gap:10px;opacity:.55;pointer-events:none;"}, []);
    var hint = el("div", {class:"gridLockHint"}, [ el("div", {}, ["‚ñ∂ Press Start to play"]) ]);
    var gridWrap = el("div", {style:"position:relative"}, [grid, hint]);
    frame.appendChild(gridWrap);

    var fb = feedbackRow();
    frame.appendChild(fb);
    playArea.appendChild(frame);

    var startBtn = $("startGame");
    var repeatBtn = $("repeatMini");
    var nextBtn = $("nextBtn");
    var fbText = $("fbText");
    var promptEl = $("promptValue");
    var kRound = $("mRound");
    var kScore = $("mScore");

    function lock(yes){
      grid.style.opacity = yes ? ".55" : "1";
      grid.style.pointerEvents = yes ? "none" : "auto";
      hint.style.display = yes ? "" : "none";
    }
    function setFB(msg, good){
      fbText.textContent = msg;
      fbText.style.color = good ? "rgba(18,51,95,.92)" : "rgba(75,100,136,1)";
      showToast(msg);
    }
    function update(){
      kRound.textContent = round + " / " + TOTAL;
      kScore.textContent = String(score);
      paintDots(frame, round);
    }

    function buildRound(){
      var target = letters[Math.floor(Math.random()*letters.length)];
      var correct = target.toLowerCase();
      promptEl.textContent = target;
      setPrompt("Match " + target);
      speak("Match " + target + ".");
      var opts = [correct];
      while(opts.length < 3){
        var o = lowers[Math.floor(Math.random()*lowers.length)];
        if(opts.indexOf(o) === -1) opts.push(o);
      }
      opts.sort(function(){ return Math.random() - 0.5; });

      grid.innerHTML = "";
      opts.forEach(function(ch){
        var b = el("button", {type:"button", class:"card choiceBtn"}, [ch]);
        b.addEventListener("click", function(){
          if(ch === correct){
            score += 1;
            setFB("‚úÖ Great match!", true);
            speak("Well done.");
            lock(true);
            nextBtn.style.display = "";
          }else{
            setFB("Try again.", false);
            speak("Try again.");
          }
          update();
        });
        grid.appendChild(b);
      });
    }

    function next(){
      round += 1;
      update();
      nextBtn.style.display = "none";
      lock(false);
      setFB("Tap the matching small letter.", true);
      buildRound();
    }

    function finish(){
      lock(true);
      var msg = "Finished! You got " + score + " out of " + TOTAL + ".";
      setFB(msg, true);
      speak("Great work. " + msg);
      awardStars(score, TOTAL);
      startBtn.textContent = "Play again";
      startBtn.style.display = "";
    }

    startBtn.addEventListener("click", function(){
      score = 0; round = 0;
      update();
      startBtn.style.display = "none";
      speak("Let's play.");
      next();
    });
    nextBtn.addEventListener("click", function(){
      if(round >= TOTAL) finish();
      else next();
    });
    repeatBtn.addEventListener("click", promptSayAgain);

    update();
    lock(true);
  }

  function startSoundMatch(){
    if(!playArea) return;
    playArea.innerHTML = "";
    var TOTAL = 5, round = 0, score = 0;
    var letters = currentLetters();
    var frame = gameFrame();
    frame.appendChild(headerBlock("Beginning Sound Match", "Pick the picture that starts with the letter (5 rounds)."));
    var dots = dotsRow(TOTAL);
    frame.appendChild(dots);
    frame.appendChild(bigPrompt("Starts with‚Ä¶", "‚ñ∂", {label:"Round", id:"sRound", value:"0 / 5"}, {label:"Score", id:"sScore", value:"0"}));

    var grid = el("div", {class:"grid3", id:"soundGrid", style:"display:grid;gap:10px;opacity:.55;pointer-events:none;"}, []);
    var hint = el("div", {class:"gridLockHint"}, [ el("div", {}, ["‚ñ∂ Press Start to play"]) ]);
    var gridWrap = el("div", {style:"position:relative"}, [grid, hint]);
    frame.appendChild(gridWrap);

    var fb = feedbackRow();
    frame.appendChild(fb);
    playArea.appendChild(frame);

    var startBtn = $("startGame");
    var repeatBtn = $("repeatMini");
    var nextBtn = $("nextBtn");
    var fbText = $("fbText");
    var promptEl = $("promptValue");
    var kRound = $("sRound");
    var kScore = $("sScore");

    function lock(yes){
      grid.style.opacity = yes ? ".55" : "1";
      grid.style.pointerEvents = yes ? "none" : "auto";
      hint.style.display = yes ? "" : "none";
    }
    function setFB(msg, good){
      fbText.textContent = msg;
      fbText.style.color = good ? "rgba(18,51,95,.92)" : "rgba(75,100,136,1)";
      showToast(msg);
    }
    function update(){
      kRound.textContent = round + " / " + TOTAL;
      kScore.textContent = String(score);
      paintDots(frame, round);
    }

    function pickItemFor(letter){
      var bank = SOUND_BANK[letter] || [{w:"", e:"‚ùì"}];
      return bank[Math.floor(Math.random()*bank.length)];
    }

    function buildRound(){
      var targetLetter = letters[Math.floor(Math.random()*letters.length)];
      var correct = pickItemFor(targetLetter);
      promptEl.textContent = targetLetter;
      setPrompt("Starts with " + targetLetter);
      speak("Which picture starts with " + targetLetter + "?");

      // pick two distractors from other letters in pool
      var opts = [{letter:targetLetter, w:correct.w, e:correct.e, correct:true}];
      while(opts.length < 3){
        var other = letters[Math.floor(Math.random()*letters.length)];
        if(other === targetLetter) continue;
        var it = pickItemFor(other);
        // avoid duplicate words
        if(opts.some(function(o){ return o.w === it.w; })) continue;
        opts.push({letter:other, w:it.w, e:it.e, correct:false});
      }
      opts.sort(function(){ return Math.random() - 0.5; });

      grid.innerHTML = "";
      opts.forEach(function(opt){
        var b = el("button", {type:"button", class:"card", style:"justify-content:center; text-align:center; min-height:118px; border-radius:22px;"}, []);
        var ill = document.createElement("div");
        ill.className = "illusWrap";
        ill.innerHTML = makeIllustrationSvg(opt.e, opt.w);
        b.appendChild(ill);

        var lbl = document.createElement("small");
        lbl.textContent = opt.w;
        b.appendChild(lbl);

        b.addEventListener("click", function(){
          if(opt.correct){
            score += 1;
            setFB("‚úÖ Correct! " + opt.w + " starts with " + targetLetter + ".", true);
            speak("Well done.");
            lock(true);
            nextBtn.style.display = "";
          }else{
            setFB("Try again.", false);
            speak("Try again.");
          }
          update();
        });

        grid.appendChild(b);
      });
    }

    function next(){
      round += 1;
      update();
      nextBtn.style.display = "none";
      lock(false);
      setFB("Tap the picture that matches the sound.", true);
      buildRound();
    }

    function finish(){
      lock(true);
      var msg = "Finished! You got " + score + " out of " + TOTAL + ".";
      setFB(msg, true);
      speak("Great work. " + msg);
      awardStars(score, TOTAL);
      startBtn.textContent = "Play again";
      startBtn.style.display = "";
    }

    startBtn.addEventListener("click", function(){
      score = 0; round = 0;
      update();
      startBtn.style.display = "none";
      speak("Let's play.");
      next();
    });
    nextBtn.addEventListener("click", function(){
      if(round >= TOTAL) finish();
      else next();
    });
    repeatBtn.addEventListener("click", promptSayAgain);

    update();
    lock(true);
  }

  function startSoundTap(){
    if(!playArea) return;
    playArea.innerHTML = "";
    var letters = currentLetters();
    var frame = gameFrame();
    frame.appendChild(
      el("div", {style:"display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap"}, [
        el("div", {}, [
          el("div", {style:"font-weight:990;font-size:1.05rem;"}, ["Letter Sound Tap"]),
          el("div", {style:"margin-top:4px;color:rgba(75,100,136,1);font-weight:800;"}, ["Tap a letter to hear it spoken (practice mode)."])
        ]),
        el("div", {style:"display:flex;gap:8px;flex-wrap:wrap;align-items:center"}, [
          el("button", {class:"pill", type:"button", id:"repeatMini", title:"Repeat the instruction"}, ["üîÅ Say again"])
        ])
      ])
    );

    var prompt = el("div", {class:"bigPromptCard"}, [
      el("div", {}, [
        el("p", {class:"bigPromptTitle", style:"margin:0;"}, ["Tap any letter"]),
        el("div", {class:"bigPromptLetter", id:"promptValue"}, ["üôÇ"])
      ]),
      el("div", {class:"promptMetaRow"}, [
        el("div", {class:"kpi"}, [
          el("div", {class:"label"}, ["Mode"]),
          el("div", {class:"value"}, ["Practice"])
        ]),
        el("div", {class:"kpi"}, [
          el("div", {class:"label"}, ["Letters"]),
          el("div", {class:"value"}, [String(letters.length)])
        ])
      ])
    ]);
    frame.appendChild(prompt);

    var grid = el("div", {class:"grid3", style:"display:grid;gap:10px;"}, []);
    letters.forEach(function(ch){
      var b = el("button", {type:"button", class:"card choiceBtn"}, [ch]);
      b.addEventListener("click", function(){
        $("promptValue").textContent = ch;
        setPrompt(ch);
        speak(ch);
      });
      grid.appendChild(b);
    });
    frame.appendChild(grid);

    var fb = el("div", {style:"border-radius:18px;padding:12px;border:1px solid rgba(31,120,255,.18);background:rgba(255,255,255,.78);font-weight:900;color:rgba(75,100,136,1);"}, ["Tip: Use this first, then try a level game."]);
    frame.appendChild(fb);

    playArea.appendChild(frame);

    var repeatBtn = $("repeatMini");
    if(repeatBtn){
      repeatBtn.addEventListener("click", function(){
        speak("Tap a letter to hear it spoken.");
      });
    }
    speak("Tap a letter.");
  }

  // ---------- Hub wiring ----------
  function startActivity(key){
    if(key === "find") startFind(true);
    else if(key === "match") startMatch(true);
    else if(key === "sound") startSoundMatch(true);
    else if(key === "tap") startSoundTap(true);
    try{ localStorage.setItem("ps_letters_last_activity", key); }catch(e){}
    var pa = $("playArea");
    if(pa) pa.scrollIntoView({behavior:"smooth", block:"start"});
  }

  // Expose for inline onclick safety
  window.psStartActivity = startActivity;

  if(launchFind) launchFind.addEventListener("click", function(){ startActivity("find"); });
  if(launchMatch) launchMatch.addEventListener("click", function(){ startActivity("match"); });
  if(launchSoundMatch) launchSoundMatch.addEventListener("click", function(){ startActivity("sound"); });
  if(launchSoundTap) launchSoundTap.addEventListener("click", function(){ startActivity("tap"); });

  if(soundToggle){
    soundToggle.addEventListener("click", function(){
      voiceOn = !voiceOn;
      try{ localStorage.setItem("ps_voice_on", voiceOn ? "true" : "false"); }catch(e){}
      setVoiceUI();
      speak(voiceOn ? "Voice on." : "Voice off.");
    });
  }

  if(repeatPromptBtn){
    repeatPromptBtn.addEventListener("click", promptSayAgain);
  }

  if(resetBtn){
    resetBtn.addEventListener("click", function(){
      clearPlay();
      setStars(0);
      speak("Reset.");
    });
  }

  // On first load
  clearPlay();
})();
</script>

</body>
</html>
