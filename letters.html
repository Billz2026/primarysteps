<!doctype html>
<html lang="en">
<head><title>Letters ‚Ä¢ Primary Steps</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#1f78ff">
<link rel="icon" type="image/png" href="assets/primary-steps-icon-512.png">
<style>
:root{
  --bg:#f5fbff;
  --panel:#ffffff;
  --ink:#0b1b33;
  --muted:#4b6488;
  --blue:#1f78ff;
  --blue2:#0f5fe6;
  --stroke: rgba(31,120,255,.18);
  --shadow: 0 18px 50px rgba(16, 60, 120, .14);
  --shadow2: 0 10px 26px rgba(16, 60, 120, .10);
  --r: 18px;
  --max: 1100px;
  --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:var(--font);
  color:var(--ink);
  background:
    radial-gradient(900px 360px at 30% -10%, rgba(31,120,255,.14), transparent 55%),
    radial-gradient(900px 360px at 85% 10%, rgba(31,120,255,.10), transparent 55%),
    linear-gradient(180deg, var(--bg), #eaf4ff);
}
a{color:inherit}
.container{width:min(var(--max), 92vw); margin:0 auto; padding:18px 0 60px;}
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  padding:14px 16px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.72);
  backdrop-filter: blur(10px);
  border-radius: 22px;
  box-shadow: var(--shadow2);
  position: sticky;
  top: 10px;
  z-index: 20;
}
.brand{display:flex; align-items:center; gap:12px; min-width:0;}
.brand img{
  height: 100px;
  width:auto;
  display:block;
  filter: drop-shadow(0 10px 18px rgba(16,60,120,.16));
}

.brand{
  position: relative;
}
.brand::before{
  content:"";
  position:absolute;
  left: -14px;
  top: -14px;
  width: 132px;
  height: 132px;
  border-radius: 999px;
  background: radial-gradient(circle at 35% 30%, rgba(31,120,255,.22), rgba(31,120,255,0) 62%);
  filter: blur(6px);
  pointer-events:none;
  z-index: 0;
}
.brand a, .brandLink, .brandText, .brand img{ position: relative; z-index: 1; }

.tagline{
  font-weight: 980;
  letter-spacing: .2px;
  color: rgba(11,27,51,.88);
  font-size: 1.18rem;
}
@media (max-width: 560px){
  .tagline{ font-size: 1.02rem; }
}

@media (max-width: 560px){
  .brand::before{
    width: 110px;
    height: 110px;
    left: -10px;
    top: -10px;
    background: radial-gradient(circle at 35% 30%, rgba(31,120,255,.18), rgba(31,120,255,0) 62%);
  }
}
.brand .title{margin:0; font-weight:950; letter-spacing:.2px; font-size:1.05rem;}
.brand .tag{margin:2px 0 0; color:var(--muted); font-weight:700; font-size:.92rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
.pill{
  display:inline-flex; align-items:center; gap:8px;
  height:40px; padding:0 14px;
  border-radius:999px;
  border:1px solid rgba(31,120,255,.18);
  background: rgba(255,255,255,.70);
  font-weight:900;
  text-decoration:none;
  box-shadow: 0 10px 22px rgba(16,60,120,.07);
  transition:.16s ease;
}
.pill:hover{transform: translateY(-1px); border-color: rgba(31,120,255,.30);}
.pill.primary{
  background: linear-gradient(180deg, var(--blue), var(--blue2));
  color:#fff;
  border-color: rgba(31,120,255,.35);
  box-shadow: 0 16px 30px rgba(16,60,120,.16);
}
.hero{
  margin-top:16px;
  padding:24px;
  border-radius: 24px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.78);
  box-shadow: var(--shadow);
}
.hero h1{margin:0 0 6px; font-weight:980; letter-spacing:.2px; font-size:1.45rem;}
.hero p{margin:0; color:var(--muted); font-weight:750; line-height:1.45;}
.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap:14px;
}
.card{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:16px 16px;
  border-radius: var(--r);
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.85);
  box-shadow: var(--shadow2);
  text-decoration:none;
  transition: .16s ease;
  cursor:pointer;
  position:relative;
}
.card:hover{transform: translateY(-2px); border-color: rgba(31,120,255,.30);}
.card:active{transform: translateY(0);}
.left{display:flex; align-items:center; gap:12px; min-width:0;}
.ico{
  width:44px; height:44px; border-radius:14px;
  display:grid; place-items:center;
  background: rgba(31,120,255,.10);
  border:1px solid rgba(31,120,255,.18);
  font-size: 1.15rem;
}
.meta{min-width:0}
.meta .name{margin:0; font-weight:950; letter-spacing:.2px; font-size:1.05rem;}
.meta .desc{margin:2px 0 0; color:var(--muted); font-weight:700; font-size:.92rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.badge{
  height:36px; padding:0 16px;
  border-radius:999px;
  background: rgba(18,51,95,.92);
  color:#fff;
  font-weight:900;
  display:inline-flex; align-items:center; justify-content:center;
}
.footer{margin-top:18px; text-align:center; color: rgba(11,27,51,.55); font-weight:750;}
.page{
  margin-top:16px;
  padding:22px;
  border-radius: 24px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.78);
  box-shadow: var(--shadow);
}
.breadcrumb{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px;}
.breadcrumb a{color: var(--blue2); font-weight:900; text-decoration:none;}
.breadcrumb a:hover{text-decoration: underline; text-underline-offset: 4px;}
@media (max-width: 980px){ .grid{grid-template-columns: repeat(2, minmax(0,1fr));} }
@media (max-width: 560px){
  .container{width:min(var(--max), 94vw);}
  .brand img{height:72px;}
  .grid{grid-template-columns: 1fr;}
  .meta .desc{white-space:normal;}
  .actions{width:100%; justify-content:flex-start;}
}


/* --- Premium depth layer (Letters) --- */
.page{
  position: relative;
}
.page::before{
  content:"";
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at 20% 10%, rgba(31,120,255,.10), rgba(31,120,255,0) 55%),
    radial-gradient(circle at 80% 18%, rgba(88,173,255,.12), rgba(88,173,255,0) 58%),
    radial-gradient(circle at 25% 85%, rgba(31,120,255,.08), rgba(31,120,255,0) 60%),
    linear-gradient(180deg, rgba(247,250,255,.92), rgba(245,248,255,.74));
  pointer-events:none;
  z-index: -1;
}
.card{
  transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
}
.card:hover{
  transform: translateY(-1px);
  box-shadow: 0 18px 36px rgba(16,60,120,.12);
  border-color: rgba(31,120,255,.28);
}
.card:active{
  transform: translateY(0);
  box-shadow: 0 10px 22px rgba(16,60,120,.10);
}
.badge{
  box-shadow: 0 10px 20px rgba(16,60,120,.10);
}
#playArea{
  backdrop-filter: blur(8px);
}
.premiumDivider{
  height:1px;
  background: linear-gradient(90deg, rgba(31,120,255,0), rgba(31,120,255,.20), rgba(31,120,255,0));
  margin: 12px 0;
  border-radius:999px;
}
.kidHint{
  display:flex; gap:10px; align-items:flex-start;
  border:1px solid rgba(31,120,255,.18);
  background: rgba(255,255,255,.78);
  border-radius: 18px;
  padding: 12px;
}
.kidHint .ico{
  width:40px;height:40px;border-radius:14px;
  display:grid;place-items:center;
  background: linear-gradient(180deg, rgba(31,120,255,.14), rgba(255,255,255,.75));
  border:1px solid rgba(31,120,255,.18);
  font-size:1.2rem;
}
.kidHint b{ font-weight: 980; }

/* Finish modal + confetti */
.psModal{
  position: fixed;
  inset: 0;
  display:none;
  align-items:center;
  justify-content:center;
  padding: 18px;
  background: rgba(11,27,51,.46);
  z-index: 9999;
}
.psModal.show{ display:flex; }
.psModalCard{
  width: min(560px, 96vw);
  border-radius: 26px;
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(255,255,255,.50);
  box-shadow: 0 30px 80px rgba(0,0,0,.22);
  padding: 16px;
  position: relative;
  overflow:hidden;
}
.psModalTop{
  display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
}
.psModalTitle{
  margin:0; font-weight: 990; font-size: 1.25rem; letter-spacing:.2px;
}
.psModalMsg{
  margin:6px 0 0; color: rgba(75,100,136,1); font-weight: 800; line-height:1.5;
}
.psModalActions{
  margin-top: 12px;
  display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
}
.psConfetti{
  position:absolute; inset:0; pointer-events:none; opacity:.9;
}
.psConfetti i{
  position:absolute;
  width:10px; height:16px;
  border-radius: 4px;
  background: rgba(31,120,255,.55);
  animation: psFall 1.35s ease-in forwards;
}
@keyframes psFall{
  0%{ transform: translateY(-18px) rotate(0deg); opacity: 0;}
  10%{ opacity: 1;}
  100%{ transform: translateY(420px) rotate(220deg); opacity: 0;}
}

/* --- Premium Hub (Launcher) --- */
.hub{
  margin-top: 14px;
  border: 1px solid var(--stroke);
  border-radius: 26px;
  padding: 14px;
  background: rgba(255,255,255,.72);
  box-shadow: var(--shadow2);
}
.hubTop{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.hubTitle{
  margin:0;
  font-weight: 990;
  letter-spacing:.2px;
  font-size: 1.12rem;
}
.hubSub{
  margin:4px 0 0;
  color: var(--muted);
  font-weight: 780;
}
.hubActions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
.hubGrid{
  margin-top: 12px;
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}
@media (min-width: 860px){
  .hubGrid{ grid-template-columns: repeat(4, minmax(0, 1fr)); }
}
.hubTile{
  text-align:left;
  min-height: 122px;
  padding: 14px;
  border-radius: 22px;
  border: 1px solid rgba(31,120,255,.18);
  background: linear-gradient(180deg, rgba(31,120,255,.08), rgba(255,255,255,.84));
  box-shadow: 0 18px 34px rgba(16,60,120,.10);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  gap:10px;
}
.hubTile .row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.hubIcon{
  width: 44px;
  height: 44px;
  border-radius: 16px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.78);
  border: 1px solid rgba(31,120,255,.18);
  font-size: 1.35rem;
}
.hubName{
  margin:0;
  font-weight: 990;
  font-size: 1.02rem;
}
.hubDesc{
  margin:4px 0 0;
  color: rgba(75,100,136,1);
  font-weight: 800;
  font-size: .92rem;
  line-height: 1.35;
}
.hubChips{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}
.chip{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding: 7px 10px;
  border-radius: 999px;
  font-weight: 900;
  font-size: .78rem;
  border: 1px solid rgba(31,120,255,.18);
  background: rgba(255,255,255,.78);
  color: rgba(18,51,95,.92);
}
.chip.reco{
  background: linear-gradient(180deg, rgba(31,120,255,.18), rgba(255,255,255,.82));
  border-color: rgba(31,120,255,.28);
}
.hubFoot{
  margin-top: 10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
.hubMini{
  color: var(--muted);
  font-weight: 800;
  font-size: .92rem;
}


/* --- Today's Goal strip --- */
.goalStrip{
  margin-top: 12px;
  border: 1px solid rgba(31,120,255,.18);
  background: linear-gradient(180deg, rgba(31,120,255,.10), rgba(255,255,255,.82));
  border-radius: 24px;
  padding: 12px;
  box-shadow: 0 18px 34px rgba(16,60,120,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.goalLeft{
  display:flex;
  align-items:center;
  gap:12px;
}
.goalIcon{
  width: 46px;
  height: 46px;
  border-radius: 18px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.78);
  border: 1px solid rgba(31,120,255,.18);
  font-size: 1.35rem;
}
.goalTitle{
  margin:0;
  font-weight: 990;
  letter-spacing:.2px;
}
.goalSub{
  margin:4px 0 0;
  color: rgba(75,100,136,1);
  font-weight: 800;
  font-size: .92rem;
  line-height: 1.35;
}
.goalRight{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.goalBar{
  width: min(260px, 70vw);
  height: 12px;
  border-radius: 999px;
  background: rgba(31,120,255,.10);
  border: 1px solid rgba(31,120,255,.18);
  overflow:hidden;
}
.goalFill{
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(31,120,255,.85), rgba(88,173,255,.85));
  transition: width .28s ease;
}
.goalCount{
  font-weight: 950;
  color: rgba(18,51,95,.92);
  white-space:nowrap;
}
@keyframes pop{
  0%{ transform: scale(.98); }
  55%{ transform: scale(1.02); }
  100%{ transform: scale(1); }
}
.pop{ animation: pop .22s ease; }


.brandTagline{
  font-family: "Comic Neue", "Poppins", system-ui, -apple-system, BlinkMacSystemFont;
  font-size: 1.25rem;
  font-weight: 700;
  letter-spacing: .3px;
  color: rgba(11,27,51,.88);
}
@media (max-width: 560px){
  .brandTagline{
    font-size: 1.1rem;
  }
}

</style>
</head>
<body>
  <div class="container">
    <header class="header">
      
<div class="brand">
  <a href="index.html" class="brandLink" style="display:flex;align-items:center;gap:16px;text-decoration:none;">
    <img src="assets/primary-steps-logo.png" alt="Primary Steps logo" onerror="this.style.display='none'">
    <div class="brandText" style="display:flex;flex-direction:column;line-height:1;">
      <div class="brandTagline">Simple, calm learning activities</div>
    </div>
  </a>
</div>

      </div>
    </a>
  </div>
      </div>
      <div class="actions">
        <span class="pill" style="cursor:default">‚≠ê <span id="starsCount">0</span> stars</span>
        <a class="pill" href="settings.html">Settings</a>
        <a class="pill primary" href="index.html">Home</a>
      </div>
    </header>

    
<section class="page" id="lettersPage">
  <div class="breadcrumb"><a href="index.html">‚Üê Back to Home</a></div>

  <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap">
    <div style="min-width:260px;flex:1 1 420px">
      <h2 style="margin:0 0 6px; font-weight:980; letter-spacing:.2px;">üî§ Letters</h2>
      <p style="margin:0; color:var(--muted); font-weight:750; line-height:1.5;">
        Play quick letter games with voice prompts. Start easy, then level up.
      </p>
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
      <button class="pill" id="soundToggle" type="button" aria-pressed="false" title="Toggle voice prompts">
        üîá Voice: Off
      </button>
      <button class="pill primary" id="resetBtn" type="button" title="Reset this page (keeps total stars)">
        Reset activity
      </button>
    </div>
  </div>

  <!-- Activity Launcher -->
  <div class="hub" id="activityHub">
    <div class="hubTop">
      <div>
        <p class="hubTitle">Choose a game</p>
        <p class="hubSub">Quick, calm activities with clear goals ‚Äî like a proper learning site.</p>
      </div>
      <div class="hubActions">
        <button class="pill" id="quickStart" type="button" title="Start the recommended game">‚ö° Quick start</button>
        <button class="pill" id="viewBadges" type="button" title="Scroll to badges">üèÖ Badges</button>
      </div>
    </div>

    <div class="hubGrid">
      <button class="hubTile" id="launchFind" type="button" aria-controls="playArea">
        <div class="row">
          <div class="hubIcon" aria-hidden="true">üîé</div>
          <span class="chip reco" id="recoFind" style="display:none">Recommended</span>
        </div>
        <div>
          <p class="hubName">Find the Letter</p>
          <p class="hubDesc">Listen, then tap the correct letter (5 rounds)</p>
        </div>
        <div class="hubChips">
          <span class="chip">Level game</span>
          <span class="chip">Voice</span>
        </div>
      </button>

      <button class="hubTile" id="launchMatch" type="button" aria-controls="playArea">
        <div class="row">
          <div class="hubIcon" aria-hidden="true">üî§</div>
          <span class="chip reco" id="recoMatch" style="display:none">Recommended</span>
        </div>
        <div>
          <p class="hubName">Upper & Lower Match</p>
          <p class="hubDesc">Match BIG letters to small letters (5 rounds)</p>
        </div>
        <div class="hubChips">
          <span class="chip">Matching</span>
          <span class="chip">Level game</span>
        </div>
      </button>

      <button class="hubTile" id="launchSoundMatch" type="button" aria-controls="playArea">
        <div class="row">
          <div class="hubIcon" aria-hidden="true">üß†</div>
          <span class="chip reco" id="recoSound" style="display:none">Recommended</span>
        </div>
        <div>
          <p class="hubName">Beginning Sound Match</p>
          <p class="hubDesc">Pick the picture that starts with the letter (5 rounds)</p>
        </div>
        <div class="hubChips">
          <span class="chip">Sounds</span>
          <span class="chip">Level game</span>
        </div>
      </button>

      <button class="hubTile" id="launchSoundTap" type="button" aria-controls="playArea">
        <div class="row">
          <div class="hubIcon" aria-hidden="true">üîä</div>
          <span class="chip reco" id="recoTap" style="display:none">Recommended</span>
        </div>
        <div>
          <p class="hubName">Letter Sound Tap</p>
          <p class="hubDesc">Tap a letter to hear it spoken (practice mode)</p>
        </div>
        <div class="hubChips">
          <span class="chip">Warm‚Äëup</span>
          <span class="chip">Easy</span>
        </div>
      </button>
    </div>

    <div class="hubFoot">
      <div class="hubMini" id="hubMiniText">Tip: Start with Level 1 for confidence, then move up.</div>
      <div class="hubActions">
        <span class="pill" style="cursor:default">üéØ Goal: 5 rounds</span>
        <span class="pill" style="cursor:default">‚≠ê Stars & badges</span>
      </div>
    </div>
  
  <div class="goalStrip" id="goalStrip">
    <div class="goalLeft">
      <div class="goalIcon" aria-hidden="true">üéØ</div>
      <div>
        <p class="goalTitle">Today‚Äôs Goal</p>
        <p class="goalSub" id="goalSub">Complete 2 games to earn a bonus badge.</p>
      </div>
    </div>
    <div class="goalRight">
      <div class="goalBar" aria-hidden="true"><div class="goalFill" id="goalFill"></div></div>
      <div class="goalCount" id="goalCount">0 / 2</div>
      <button class="pill primary" id="continueBtn" type="button">Continue</button>
      <button class="pill" id="resetTodayBtn" type="button" title="Reset today‚Äôs goal on this device">Reset</button>
    </div>
  </div>
</div>

<!-- Play Area -->
  <div id="playArea" style="margin-top:14px; border:1px solid var(--stroke); border-radius: 24px; padding:14px; background: rgba(255,255,255,.70); box-shadow: var(--shadow2);">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div style="min-width:260px;flex:1 1 420px">
        <p id="activityTitle" style="margin:0; font-weight:980; font-size:1.05rem;">Select an activity</p>
        <p id="activitySub" style="margin:4px 0 0; color:var(--muted); font-weight:750;">Pick a game above to start.</p>

        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center">
          <button class="pill" id="repeatPrompt" type="button" title="Repeat the instruction" disabled style="opacity:.6">
            üîÅ Say again
          </button>
          <span id="feedback" style="font-weight:950; color: rgba(11,27,51,.78);" aria-live="polite"></span>
        </div>

        <div style="margin-top:10px">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
            <span style="font-weight:900;color:var(--muted)">Streak</span>
            <span id="streakLabel" style="font-weight:950;color:rgba(11,27,51,.72)">0 / 3</span>
          </div>
          <div style="margin-top:6px; height:10px; border-radius:999px; background: rgba(31,120,255,.10); border:1px solid rgba(31,120,255,.18); overflow:hidden">
            <div id="streakBar" style="height:100%; width:0%; border-radius:999px; background: linear-gradient(180deg, var(--blue), var(--blue2));"></div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end">
        <div style="display:flex;gap:8px;align-items:center">
          <span style="font-weight:900;color:var(--muted)">Level</span>
          <select id="levelSelect" class="pill" style="height:40px; padding-right:10px; cursor:pointer">
            <option value="1">Level 1 ‚Ä¢ 3 letters (Set 1)</option>
            <option value="2">Level 2 ‚Ä¢ 6 letters (Set 1)</option>
            <option value="3">Level 3 ‚Ä¢ 6 letters (Set 2)</option>
          </select>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <span style="font-weight:900;color:var(--muted)">Difficulty</span>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="pill" id="diffEasy" type="button" aria-pressed="true">Easy (3)</button>
            <button class="pill" id="diffHard" type="button" aria-pressed="false">Hard (6)</button>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <span style="font-weight:900;color:var(--muted)">Set</span>
          <select id="setSelect" class="pill" style="height:40px; padding-right:10px; cursor:pointer">
            <option value="0">Set 1</option>
            <option value="1">Set 2</option>
            <option value="2">Set 3</option>
          </select>
        </div>

        <span class="pill" style="cursor:default">‚≠ê Session: <span id="sessionStars">0</span></span>
      </div>
    </div>

    <div id="activityBody" style="margin-top:12px; display:grid; gap:12px;">
      <div style="padding:12px;border-radius:18px;border:1px dashed rgba(31,120,255,.28);color:var(--muted);font-weight:750;">
        Tip: Turn Voice on, then tap <b>Play</b> above. Use <b>Say again</b> any time.
      </div>
    </div>
  </div>
  <!-- Badges -->
  <div style="margin-top:14px; border:1px solid var(--stroke); border-radius: 24px; padding:14px; background: rgba(255,255,255,.70); box-shadow: var(--shadow2);">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>
        <p style="margin:0; font-weight:980;">üèÖ Badges</p>
        <p style="margin:4px 0 0; color:var(--muted); font-weight:750;">Earn badges by completing levels. Badges save on this device.</p>
      </div>
      <button class="pill" id="resetBadges" type="button" title="Clear badges on this device">Reset badges</button>
    </div>

    <div id="badgesGrid" style="margin-top:12px; display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px;"></div>
  </div>


  <!-- Earn a star (global) -->
  <div style="margin-top:14px; display:grid; gap:12px;">
    <div style="border:1px solid var(--stroke); border-radius: var(--r); padding:14px; background: rgba(255,255,255,.70); box-shadow: var(--shadow2);">
      <p style="margin:0 0 8px; font-weight:900;">Quick tips</p>
      <ul style="margin:0; padding-left:18px; color:var(--muted); font-weight:750; line-height:1.55;">
        <li>Keep sessions under 5 minutes.</li>
        <li>Celebrate quickly, then move on.</li>
        <li>If it feels hard, go back to Easy.</li>
      </ul>
    </div>

    <div class="card" style="cursor:default;">
      <div class="left">
        <div class="ico" aria-hidden="true">‚≠ê</div>
        <div class="meta">
          <p class="name">Earn a star</p>
          <p class="desc">Tap when you finish a small goal</p>
        </div>
      </div>
      <button class="badge" id="starBtn" type="button" style="border:none; cursor:pointer;">Add ‚≠ê</button>
    </div>
  </div>

  <!-- Premium finish modal -->
  <div class="psModal" id="psModal" role="dialog" aria-modal="true" aria-label="Activity result">
    <div class="psModalCard">
      <div class="psConfetti" id="psConfetti" aria-hidden="true"></div>
      <div class="psModalTop">
        <div>
          <p class="psModalTitle" id="psModalTitle">Great job!</p>
          <p class="psModalMsg" id="psModalMsg">You finished the level.</p>
        </div>
        <button class="pill" id="psModalClose" type="button" aria-label="Close">‚úï</button>
      </div>
      <div class="premiumDivider"></div>
      <div class="kidHint" style="margin-top:2px">
        <div class="ico" aria-hidden="true">üí°</div>
        <div style="font-weight:800;color:rgba(75,100,136,1);line-height:1.45">
          <b>Tip:</b> Keep it short. Two great minutes beats ten tired minutes.
        </div>
      </div>
      <div class="psModalActions">
        <button class="pill" id="psModalAgain" type="button">Play again</button>
        <button class="pill primary" id="psModalNext" type="button">Try another game</button>
      </div>
    </div>
  </div>
</section>


<script>
/* Primary Steps ‚Äî Letters (Step 3: voice prompts + pro feedback) */
(function(){
  // ---------- Total stars (shared across site) ----------
  function getTotalStars(){ return Number(localStorage.getItem("ps_stars") || "0"); }
  function setTotalStars(n){ localStorage.setItem("ps_stars", String(n)); }
  function refreshTopStars(){
    var top = document.getElementById("starsCount");
    if(top) top.textContent = String(getTotalStars());
  }
  refreshTopStars();

  var starBtn = document.getElementById("starBtn");
  if(starBtn){
    starBtn.addEventListener("click", function(){
      var n = getTotalStars() + 1;
      setTotalStars(n);
      refreshTopStars();
      starBtn.textContent = "Added! ‚≠ê";
      setTimeout(function(){ starBtn.textContent = "Add ‚≠ê"; }, 900);
    });
  }

  // ---------- Voice (SpeechSynthesis) ----------
  var voiceBtn = document.getElementById("soundToggle");
  var voicePref = localStorage.getItem("ps_voice") || "off"; // on/off
  var selectedVoiceName = localStorage.getItem("ps_voice_name") || ""; // best-effort
  var voices = [];

  function loadVoices(){
    try{
      voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
      // If no saved voice, attempt to pick a friendly female-ish voice (best effort).
      if(!selectedVoiceName && voices && voices.length){
        var preferred = voices.find(v => /female|woman|susan|serena|karen|moira|amelia|samantha/i.test(v.name))
                    || voices.find(v => /en-GB|English \(United Kingdom\)|UK/i.test(v.lang || ""))
                    || voices.find(v => /en/i.test(v.lang || ""))
                    || voices[0];
        if(preferred){
          selectedVoiceName = preferred.name;
          localStorage.setItem("ps_voice_name", selectedVoiceName);
        }
      }
    }catch(e){}
  }

  if(window.speechSynthesis){
    loadVoices();
    window.speechSynthesis.onvoiceschanged = function(){ loadVoices(); };
  }

  function getVoice(){
    if(!voices || !voices.length) return null;
    if(selectedVoiceName){
      var v = voices.find(x => x.name === selectedVoiceName);
      if(v) return v;
    }
    // fallback
    return voices.find(v => /en/i.test(v.lang || "")) || voices[0] || null;
  }

  function speak(text){
    if(voicePref !== "on") return;
    if(!window.speechSynthesis || !window.SpeechSynthesisUtterance) return;
    try{
      window.speechSynthesis.cancel();
      var u = new SpeechSynthesisUtterance(text);
      var v = getVoice();
      if(v) u.voice = v;
      // Calm, friendly defaults (best effort)
      u.rate = 0.92;
      u.pitch = 1.05;
      u.volume = 1.0;
      window.speechSynthesis.speak(u);
    }catch(e){}
  }

  function renderVoiceBtn(){
    if(!voiceBtn) return;
    voiceBtn.setAttribute("aria-pressed", String(voicePref === "on"));
    voiceBtn.textContent = (voicePref === "on") ? "üîä Voice: On" : "üîá Voice: Off";
    voiceBtn.title = "Voice prompts use your device voice (best effort).";
  }

  if(voiceBtn){
    renderVoiceBtn();
    voiceBtn.addEventListener("click", function(){
      voicePref = (voicePref === "on") ? "off" : "on";
      localStorage.setItem("ps_voice", voicePref);
      renderVoiceBtn();
      if(voicePref === "on"){
        speak("Voice is on.");
      }
    });
  }

  // ---------- Session stars ----------
  var sessionStarsEl = document.getElementById("sessionStars");
  var sessionStars = 0;
  function addSessionStar(){
    sessionStars += 1;
    if(sessionStarsEl) sessionStarsEl.textContent = String(sessionStars);
    setFeedback("‚≠ê Star earned!", true);
    speak("Great job. You earned a star.");
  }
  
  function awardLevelBadges(score, total){
    // Determine which level we're on (or saved selection)
    var lvl = 0;
    if(levelSelect){
      lvl = Number(levelSelect.value || "0");
    }else{
      lvl = inferLevel();
    }
    if(lvl === 1) awardBadge("lvl1");
    if(lvl === 2) awardBadge("lvl2");
    if(lvl === 3) awardBadge("lvl3");
    if(score === total) awardBadge("perfect");
    // 3 session stars in one visit
    if(sessionStars >= 3) awardBadge("triple");
  }
function resetSession(){
    sessionStars = 0;
    if(sessionStarsEl) sessionStarsEl.textContent = "0";
  }

  // ---------- Difficulty + Sets ----------
  var easyBtn = document.getElementById("diffEasy");
  var hardBtn = document.getElementById("diffHard");
  var setSelect = document.getElementById("setSelect");
  var difficulty = Number(localStorage.getItem("ps_letters_diff") || "3"); // 3 or 6
  var setIndex = Number(localStorage.getItem("ps_letters_set") || "0");

  var LETTER_SETS = [
    ["A","S","T","P","I","N"],
    ["M","D","G","O","C","K"],
    ["E","R","H","L","B","F"]
  ];

  // ---------- Levels (simple kid-friendly presets) ----------
  // Level 1: 3 letters (Set 1)
  // Level 2: 6 letters (Set 1)
  // Level 3: 6 letters (Set 2)
  var LEVELS = {
    1: {difficulty: 3, setIndex: 0, label: "Level 1"},
    2: {difficulty: 6, setIndex: 0, label: "Level 2"},
    3: {difficulty: 6, setIndex: 1, label: "Level 3"}
  };
  var levelSelect = document.getElementById("levelSelect");

  function inferLevel(){
    // try to map current difficulty+set to a level
    var keys = Object.keys(LEVELS);
    for(var i=0;i<keys.length;i++){
      var k = Number(keys[i]);
      var L = LEVELS[k];
      if(L.difficulty === difficulty && L.setIndex === setIndex) return k;
    }
    return 0; // custom
  }

  function applyLevel(k){
    var L = LEVELS[k];
    if(!L) return;
    // Update internal state and UI using existing setters
    difficulty = L.difficulty;
    setIndex = L.setIndex;
    localStorage.setItem("ps_letters_diff", String(difficulty));
    localStorage.setItem("ps_letters_set", String(setIndex));
    if(setSelect) setSelect.value = String(setIndex);
    if(easyBtn) easyBtn.setAttribute("aria-pressed", String(difficulty === 3));
    if(hardBtn) hardBtn.setAttribute("aria-pressed", String(difficulty === 6));
    if(levelSelect) levelSelect.value = String(k);
    restartActivity();
  }

  if(levelSelect){
    // set initial dropdown to inferred level
    var initial = inferLevel();
    if(initial) levelSelect.value = String(initial);
    levelSelect.addEventListener("change", function(){
      var k = Number(levelSelect.value || "1");
      localStorage.setItem("ps_letters_level", String(k));
      applyLevel(k);
    });

    // If user previously picked a level, apply it on load (keeps experience consistent)
    var saved = Number(localStorage.getItem("ps_letters_level") || "0");
    if(saved && LEVELS[saved]){
      applyLevel(saved);
    }
  }

  // ---------- Badges ----------
  var BADGE_KEY = "ps_letters_badges_v1";
  var badgesGrid = document.getElementById("badgesGrid");
  var resetBadgesBtn = document.getElementById("resetBadges");

  var BADGES = [
    {id:"lvl1", title:"Level 1 Complete", desc:"Complete any Level 1 game", icon:"ü•â"},
    {id:"lvl2", title:"Level 2 Complete", desc:"Complete any Level 2 game", icon:"ü•à"},
    {id:"lvl3", title:"Level 3 Complete", desc:"Complete any Level 3 game", icon:"ü•á"},
    {id:"perfect", title:"Perfect Score", desc:"Get 5/5 in a level", icon:"‚ú®"},
    {id:"triple", title:"Three Stars", desc:"Earn 3 session stars in one visit", icon:"‚≠ê"}
    ,
    {id:"daily2", title:"Daily Goal", desc:"Complete 2 games in a day", icon:"üéØ"}
  ];


  function getEarnedBadges(){
    try{
      var raw = localStorage.getItem(BADGE_KEY);
      var arr = raw ? JSON.parse(raw) : [];
      if(Array.isArray(arr)) return arr;
      return [];
    }catch(e){ return []; }
  }
  function setEarnedBadges(arr){
    try{ localStorage.setItem(BADGE_KEY, JSON.stringify(arr)); }catch(e){}
  }
  function hasBadge(id){
    return getEarnedBadges().indexOf(id) !== -1;
  }
  function awardBadge(id){
    var earned = getEarnedBadges();
    if(earned.indexOf(id) !== -1) return;
    earned.push(id);
    setEarnedBadges(earned);
    renderBadges();
    // Gentle reward
    setFeedback("üèÖ Badge earned!", true);
    speak("Badge earned.");
  }

  function renderBadges(){
    if(!badgesGrid) return;
    var earned = getEarnedBadges();
    badgesGrid.innerHTML = "";
    BADGES.forEach(function(b){
      var got = earned.indexOf(b.id) !== -1;
      var card = document.createElement("div");
      card.className = "card";
      card.style.cursor = "default";
      card.style.minHeight = "90px";
      card.style.opacity = got ? "1" : ".55";

      var left = document.createElement("div");
      left.className = "left";
      var ico = document.createElement("div");
      ico.className = "ico";
      ico.textContent = got ? b.icon : "üîí";
      var meta = document.createElement("div");
      meta.className = "meta";
      var name = document.createElement("p");
      name.className = "name";
      name.textContent = b.title;
      var desc = document.createElement("p");
      desc.className = "desc";
      desc.textContent = b.desc;
      meta.appendChild(name); meta.appendChild(desc);
      left.appendChild(ico); left.appendChild(meta);

      var tag = document.createElement("span");
      tag.className = "badge";
      tag.textContent = got ? "Earned" : "Locked";

      card.appendChild(left);
      card.appendChild(tag);
      badgesGrid.appendChild(card);
    });
  }

  if(resetBadgesBtn){
    resetBadgesBtn.addEventListener("click", function(){
      setEarnedBadges([]);
      renderBadges();
      setFeedback("Badges reset.", false);
      speak("Badges reset.");
    });
  }

  renderBadges();

  function currentLetters(){
    var base = LETTER_SETS[setIndex] || LETTER_SETS[0];
    return base.slice(0, difficulty);
  }

  function setDifficulty(n){
    difficulty = n;
    localStorage.setItem("ps_letters_diff", String(n));
    if(easyBtn) easyBtn.setAttribute("aria-pressed", String(n === 3));
    if(hardBtn) hardBtn.setAttribute("aria-pressed", String(n === 6));
    restartActivity();
  }
  function setSet(i){
    setIndex = i;
    localStorage.setItem("ps_letters_set", String(i));
    restartActivity();
  }

  if(easyBtn) easyBtn.addEventListener("click", function(){ setDifficulty(3); });
  if(hardBtn) hardBtn.addEventListener("click", function(){ setDifficulty(6); });
  if(setSelect){
    setSelect.value = String(setIndex);
    setSelect.addEventListener("change", function(){
      setSet(Number(setSelect.value || "0"));
    });
  }
  setDifficulty(difficulty);

  // ---------- UI elements ----------
  var body = document.getElementById("activityBody");
  var title = document.getElementById("activityTitle");
  var sub = document.getElementById("activitySub");
  var resetBtn = document.getElementById("resetBtn");
  var repeatBtn = document.getElementById("repeatPrompt");
  var feedbackEl = document.getElementById("feedback");
  var streakLabel = document.getElementById("streakLabel");
  var streakBar = document.getElementById("streakBar");

  var currentActivity = null;
  var lastPrompt = "";
  var streak = 0;

  function setHeader(t, s){
    if(title) title.textContent = t;
    if(sub) sub.textContent = s;
  }

  function clearBody(){ if(body) body.innerHTML = ""; }

  function el(tag, attrs, children){
    var node = document.createElement(tag);
    if(attrs){
      Object.keys(attrs).forEach(function(k){
        if(k === "class") node.className = attrs[k];
        else if(k === "html") node.innerHTML = attrs[k];
        else node.setAttribute(k, attrs[k]);
      });
    }
    (children || []).forEach(function(c){
      if(typeof c === "string") node.appendChild(document.createTextNode(c));
      else node.appendChild(c);
    });
    return node;
  }

  function shimmer(node){
    node.animate([
      { transform:"translateY(0)", boxShadow:"0 10px 22px rgba(16,60,120,.07)" },
      { transform:"translateY(-1px)", boxShadow:"0 16px 30px rgba(16,60,120,.12)" },
      { transform:"translateY(0)", boxShadow:"0 10px 22px rgba(16,60,120,.07)" }
    ], { duration: 260, iterations: 1, easing:"ease-out" });
  }
  function shake(node){
    node.animate([
      { transform:"translateX(0)" },
      { transform:"translateX(-6px)" },
      { transform:"translateX(6px)" },
      { transform:"translateX(-4px)" },
      { transform:"translateX(4px)" },
      { transform:"translateX(0)" }
    ], { duration: 240, iterations: 1, easing:"ease-out" });
  }

  function setFeedback(text, good){
    if(!feedbackEl) return;
    feedbackEl.textContent = text || "";
    feedbackEl.style.color = good ? "rgba(18,51,95,.92)" : "rgba(75,100,136,1)";
  }

  function setStreak(n){
    streak = n;
    if(streakLabel) streakLabel.textContent = streak + " / 3";
    if(streakBar) streakBar.style.width = (streak/3*100) + "%";
  }

  function setPrompt(text){
    lastPrompt = text || "";
    if(repeatBtn){
      repeatBtn.disabled = !lastPrompt;
      repeatBtn.style.opacity = lastPrompt ? "1" : ".6";
    }
  }

  if(repeatBtn){
    repeatBtn.addEventListener("click", function(){
      if(lastPrompt) speak(lastPrompt);
    });
  }

  // ---------- Activities ----------
  function pickTarget(pool){
    return pool[Math.floor(Math.random() * pool.length)];
  }

  // Find the Letter
  var targetLetter = null;

  function startFind(){
    currentActivity = "find";
    resetSession();
    setStreak(0);
    setFeedback("", true);

    setHeader("Find the Letter", "Play 5 quick rounds. Each correct answer moves you forward.");

    var pool = currentLetters();

    // Premium mini-game state
    var TOTAL_ROUNDS = 5;
    var round = 0;
    var score = 0;
    var targetLetter = null;

    clearBody();

    // --- UI blocks ---
    var frame = el("div", {style:
      "border:1px solid var(--stroke);background:rgba(255,255,255,.86);border-radius:22px;box-shadow: var(--shadow2);padding:14px;display:grid;gap:12px;"
    });

    var topRow = el("div", {style:"display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap"}, [
      el("div", {}, [
        el("div", {style:"font-weight:980;font-size:1.05rem;"}, ["Level: 5 rounds"]),
        el("div", {id:"roundMeta", style:"margin-top:4px;color:var(--muted);font-weight:800;font-size:.92rem;"}, ["Round 0 / 5 ‚Ä¢ Score 0"])
      ]),
      el("div", {style:"display:flex;gap:8px;flex-wrap:wrap;align-items:center"}, [
        el("button", {class:"pill", type:"button", id:"repeatBtnMini", title:"Repeat the instruction"}, ["üîÅ Say again"]),
        el("button", {class:"pill primary", type:"button", id:"startFindGame"}, ["Start"])
      ])
    ]);

    // Progress dots (premium feel)
    var dots = el("div", {style:"display:flex;gap:8px;align-items:center;justify-content:flex-start"}, []);
    for(var i=0;i<TOTAL_ROUNDS;i++){
      dots.appendChild(el("div", {class:"psDot", "data-i": String(i), style:
        "width:12px;height:12px;border-radius:999px;background:rgba(31,120,255,.10);border:1px solid rgba(31,120,255,.22);"
      }));
    }

    // Prompt card
    var promptCard = el("div", {style:
      "border:1px solid rgba(31,120,255,.18);background:linear-gradient(180deg, rgba(31,120,255,.10), rgba(255,255,255,.76));border-radius:22px;padding:14px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;"
    }, [
      el("div", {}, [
        el("div", {style:"font-weight:950;color:rgba(11,27,51,.78);"}, ["Instruction"]),
        el("div", {id:"bigPrompt", style:"margin-top:6px;font-weight:990;font-size:2.1rem;letter-spacing:.5px;"}, ["Tap Start"])
      ]),
      el("div", {style:"display:flex;gap:10px;align-items:center;flex-wrap:wrap"}, [
        el("span", {class:"pill", style:"cursor:default"}, ["‚úÖ Correct: ", el("span",{id:"scoreNum"},["0"])]),
        el("span", {class:"pill", style:"cursor:default"}, ["‚è±Ô∏è Rounds: ", el("span",{id:"roundNum"},["0"]), "/", String(TOTAL_ROUNDS)])
      ])
    ]);

    // Choices grid
    var grid = el("div", {id:"findGrid", style:"display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:10px;opacity:.55;pointer-events:none;"});

    // Feedback panel
    var feedbackPanel = el("div", {id:"findFeedbackPanel", style:
      "border-radius:18px;padding:12px;border:1px solid rgba(31,120,255,.18);background:rgba(255,255,255,.78);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;"
    }, [
      el("div", {id:"findFeedbackText", style:"font-weight:950;color:rgba(75,100,136,1);"}, ["Press Start to begin."]),
      el("button", {class:"pill primary", type:"button", id:"nextRoundBtn", style:"display:none"}, ["Next"])
    ]);

    frame.appendChild(topRow);
    frame.appendChild(dots);
    frame.appendChild(promptCard);
    frame.appendChild(grid);
    frame.appendChild(feedbackPanel);

    body.appendChild(frame);
    body.appendChild(el("div", {style:"color:var(--muted);font-weight:800;font-size:.92rem;"}, [
      "Tip: If it‚Äôs tricky, switch to Easy (3 letters) or choose a different Set."
    ]));

    // --- helpers ---
    var roundMeta = document.getElementById("roundMeta");
    var bigPrompt = document.getElementById("bigPrompt");
    var scoreNum = document.getElementById("scoreNum");
    var roundNum = document.getElementById("roundNum");
    var nextBtn = document.getElementById("nextRoundBtn");
    var startBtn = document.getElementById("startFindGame");
    var repeatMini = document.getElementById("repeatBtnMini");
    var fbText = document.getElementById("findFeedbackText");

    function setDots(){
      var all = frame.querySelectorAll(".psDot");
      all.forEach(function(d, i){
        if(i < round){
          d.style.background = "linear-gradient(180deg, var(--blue), var(--blue2))";
          d.style.borderColor = "rgba(31,120,255,.35)";
        }else{
          d.style.background = "rgba(31,120,255,.10)";
          d.style.borderColor = "rgba(31,120,255,.22)";
        }
      });
    }

    function updateMeta(){
      if(roundMeta) roundMeta.textContent = "Round " + round + " / " + TOTAL_ROUNDS + " ‚Ä¢ Score " + score;
      if(scoreNum) scoreNum.textContent = String(score);
      if(roundNum) roundNum.textContent = String(round);
      setDots();
    }

    function newTarget(){
      targetLetter = pool[Math.floor(Math.random() * pool.length)];
      var promptText = "Find the letter " + targetLetter;
      bigPrompt.textContent = targetLetter;
      setPrompt(promptText);
      speak(promptText);
    }

    function lockGrid(locked){
      var g = document.getElementById("findGrid");
      if(!g) return;
      g.style.opacity = locked ? ".55" : "1";
      g.style.pointerEvents = locked ? "none" : "auto";
    }

    function setFB(msg, good){
      fbText.textContent = msg;
      fbText.style.color = good ? "rgba(18,51,95,.92)" : "rgba(75,100,136,1)";
    }

    function showNext(show){
      nextBtn.style.display = show ? "" : "none";
    }

    function buildGrid(){
      grid.innerHTML = "";
      pool.forEach(function(L){
        var b = el("button", {
          type:"button",
          class:"card",
          style:"justify-content:center; padding:18px; text-align:center; min-height:84px; font-size:2rem; font-weight:990;"
        }, [L]);

        b.addEventListener("click", function(){
          if(L === targetLetter){
            shimmer(b);
            score += 1;
            setFB("‚úÖ Correct! Nice one.", true);
            speak("Well done.");
            lockGrid(true);
            showNext(true);
          }else{
            shake(b);
            setFB("Try again.", false);
            speak("Try again.");
            setStreak(0);
          }
        });

        grid.appendChild(b);
      });
    }

    function startRound(){
      round += 1;
      updateMeta();
      lockGrid(false);
      showNext(false);
      setFB("Tap the letter you hear.", true);
      newTarget();
    }

    function finish(){
      lockGrid(true);
      showNext(false);
      var msg = "Finished! You got " + score + " out of " + TOTAL_ROUNDS + ".";
      setFB(msg, true);
      speak("Great work. " + msg);
      lastFinishedActivity = "sound";
      openModal("Great listening!", msg);
      bumpGoal();
lastFinishedActivity = "match";
      openModal("Great matching!", msg);
      bumpGoal();
lastFinishedActivity = "find";
      openModal("Level complete!", msg);
      bumpGoal();
// award session stars based on score: 5/5 -> 2 stars, 4/5 -> 1 star
      if(score >= 4){
        addSessionStar();
        if(score === 5) addSessionStar();
      }
                        awardLevelBadges(score, TOTAL_ROUNDS);
awardLevelBadges(score, TOTAL_ROUNDS);
awardLevelBadges(score, TOTAL_ROUNDS);
// Show a replay button
      startBtn.textContent = "Play again";
      startBtn.style.display = "";
    }

    // Wire buttons
    if(repeatMini){
      repeatMini.addEventListener("click", function(){
        if(lastPrompt) speak(lastPrompt);
      });
    }

    if(startBtn){
      startBtn.addEventListener("click", function(){
        setFB("Get ready‚Ä¶", true);
        speak("Let's play.");
        score = 0;
        round = 0;
        updateMeta();
        buildGrid();
        startBtn.style.display = "none";
        startRound();
      });
    }

    if(nextBtn){
      nextBtn.addEventListener("click", function(){
        if(round >= TOTAL_ROUNDS){
          finish();
        }else{
          startRound();
        }
      });
    }

    // Initial UI state
    updateMeta();
    buildGrid();
    lockGrid(true);
  }

  // Upper & Lower Match
  var matchTarget = null;

  function startMatch(){
    currentActivity = "match";
    resetSession();
    setStreak(0);
    setFeedback("", true);

    setHeader("Upper & Lower Match", "Play 5 quick rounds. Match the BIG letter to the small letter.");

    var poolUpper = currentLetters();
    var poolLower = poolUpper.map(function(x){ return x.toLowerCase(); });

    var TOTAL_ROUNDS = 5;
    var round = 0;
    var score = 0;
    var targetUpper = null;
    var correctLower = null;

    clearBody();

    var frame = el("div", {style:
      "border:1px solid var(--stroke);background:rgba(255,255,255,.86);border-radius:22px;box-shadow: var(--shadow2);padding:14px;display:grid;gap:12px;"
    });

    var topRow = el("div", {style:"display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap"}, [
      el("div", {}, [
        el("div", {style:"font-weight:980;font-size:1.05rem;"}, ["Level: 5 rounds"]),
        el("div", {id:"matchMeta", style:"margin-top:4px;color:var(--muted);font-weight:800;font-size:.92rem;"}, ["Round 0 / 5 ‚Ä¢ Score 0"])
      ]),
      el("div", {style:"display:flex;gap:8px;flex-wrap:wrap;align-items:center"}, [
        el("button", {class:"pill", type:"button", id:"repeatMatchMini", title:"Repeat the instruction"}, ["üîÅ Say again"]),
        el("button", {class:"pill primary", type:"button", id:"startMatchGame"}, ["Start"])
      ])
    ]);

    var dots = el("div", {style:"display:flex;gap:8px;align-items:center;justify-content:flex-start"}, []);
    for(var i=0;i<TOTAL_ROUNDS;i++){
      dots.appendChild(el("div", {class:"psDotMatch", style:
        "width:12px;height:12px;border-radius:999px;background:rgba(31,120,255,.10);border:1px solid rgba(31,120,255,.22);"
      }));
    }

    var promptCard = el("div", {style:
      "border:1px solid rgba(31,120,255,.18);background:linear-gradient(180deg, rgba(31,120,255,.10), rgba(255,255,255,.76));border-radius:22px;padding:14px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;"
    }, [
      el("div", {}, [
        el("div", {style:"font-weight:950;color:rgba(11,27,51,.78);"}, ["Match this letter"]),
        el("div", {id:"matchPrompt", style:"margin-top:6px;font-weight:990;font-size:2.1rem;letter-spacing:.5px;"}, ["Tap Start"])
      ]),
      el("div", {style:"display:flex;gap:10px;align-items:center;flex-wrap:wrap"}, [
        el("span", {class:"pill", style:"cursor:default"}, ["‚úÖ Correct: ", el("span",{id:"matchScore"},["0"])]),
        el("span", {class:"pill", style:"cursor:default"}, ["‚è±Ô∏è Rounds: ", el("span",{id:"matchRound"},["0"]), "/", String(TOTAL_ROUNDS)])
      ])
    ]);

    var grid = el("div", {id:"matchGrid", style:"display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:10px;opacity:.55;pointer-events:none;"});

    var feedbackPanel = el("div", {style:
      "border-radius:18px;padding:12px;border:1px solid rgba(31,120,255,.18);background:rgba(255,255,255,.78);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;"
    }, [
      el("div", {id:"matchFeedback", style:"font-weight:950;color:rgba(75,100,136,1);"}, ["Press Start to begin."]),
      el("button", {class:"pill primary", type:"button", id:"matchNext", style:"display:none"}, ["Next"])
    ]);

    frame.appendChild(topRow);
    frame.appendChild(dots);
    frame.appendChild(promptCard);
    frame.appendChild(grid);
    frame.appendChild(feedbackPanel);

    body.appendChild(frame);

    var meta = document.getElementById("matchMeta");
    var prompt = document.getElementById("matchPrompt");
    var scoreEl = document.getElementById("matchScore");
    var roundEl = document.getElementById("matchRound");
    var fb = document.getElementById("matchFeedback");
    var nextBtn = document.getElementById("matchNext");
    var startBtn = document.getElementById("startMatchGame");
    var repeatBtn = document.getElementById("repeatMatchMini");

    function setDots(){
      var all = frame.querySelectorAll(".psDotMatch");
      all.forEach(function(d, i){
        if(i < round){
          d.style.background = "linear-gradient(180deg, var(--blue), var(--blue2))";
          d.style.borderColor = "rgba(31,120,255,.35)";
        }else{
          d.style.background = "rgba(31,120,255,.10)";
          d.style.borderColor = "rgba(31,120,255,.22)";
        }
      });
    }

    function updateMeta(){
      if(meta) meta.textContent = "Round " + round + " / " + TOTAL_ROUNDS + " ‚Ä¢ Score " + score;
      if(scoreEl) scoreEl.textContent = String(score);
      if(roundEl) roundEl.textContent = String(round);
      setDots();
    }

    function lockGrid(locked){
      var g = document.getElementById("matchGrid");
      if(!g) return;
      g.style.opacity = locked ? ".55" : "1";
      g.style.pointerEvents = locked ? "none" : "auto";
    }

    function setFB(msg, good){
      fb.textContent = msg;
      fb.style.color = good ? "rgba(18,51,95,.92)" : "rgba(75,100,136,1)";
    }

    function showNext(show){
      nextBtn.style.display = show ? "" : "none";
    }

    function buildRound(){
      targetUpper = poolUpper[Math.floor(Math.random()*poolUpper.length)];
      correctLower = targetUpper.toLowerCase();

      prompt.textContent = targetUpper;

      var promptText = "Match " + targetUpper;
      setPrompt(promptText);
      speak("Match " + targetUpper + ".");

      var options = [correctLower];
      while(options.length < 3){
        var o = poolLower[Math.floor(Math.random()*poolLower.length)];
        if(options.indexOf(o) === -1) options.push(o);
      }
      for(var i=options.length-1;i>0;i--){
        var j = Math.floor(Math.random()*(i+1));
        var tmp = options[i]; options[i]=options[j]; options[j]=tmp;
      }

      grid.innerHTML = "";
      options.forEach(function(ch){
        var b = el("button", {
          type:"button",
          class:"card",
          style:"justify-content:center; padding:18px; text-align:center; min-height:84px; font-size:2rem; font-weight:990;"
        }, [ch]);

        b.addEventListener("click", function(){
          if(ch === correctLower){
            shimmer(b);
            score += 1;
            setFB("‚úÖ Correct! Great match.", true);
            speak("Well done.");
            lockGrid(true);
            showNext(true);
          }else{
            shake(b);
            setFB("Try again.", false);
            speak("Try again.");
          }
        });

        grid.appendChild(b);
      });
    }

    function startGameRound(){
      round += 1;
      updateMeta();
      lockGrid(false);
      showNext(false);
      setFB("Tap the matching small letter.", true);
      buildRound();
    }

    function finish(){
      lockGrid(true);
      showNext(false);
      var msg = "Finished! You got " + score + " out of " + TOTAL_ROUNDS + ".";
      setFB(msg, true);
      speak("Great work. " + msg);
      if(score >= 4){
        addSessionStar();
        if(score === 5) addSessionStar();
      }
      startBtn.textContent = "Play again";
      startBtn.style.display = "";
    }

    if(repeatBtn){
      repeatBtn.addEventListener("click", function(){ if(lastPrompt) speak(lastPrompt); });
    }

    if(startBtn){
      startBtn.addEventListener("click", function(){
        setFB("Get ready‚Ä¶", true);
        speak("Let's play.");
        score = 0;
        round = 0;
        updateMeta();
        startBtn.style.display = "none";
        startGameRound();
      });
    }

    if(nextBtn){
      nextBtn.addEventListener("click", function(){
        if(round >= TOTAL_ROUNDS) finish();
        else startGameRound();
      });
    }

    updateMeta();
    lockGrid(true);
  }

  // Beginning Sound Match (emoji-based for now ‚Äî swap to images later)
  // We keep it calm: 3 choices, simple words.
  var SOUND_BANK = {
    "A": [{w:"apple", e:"üçé"}, {w:"ant", e:"üêú"}, {w:"astronaut", e:"üßë‚ÄçüöÄ"}],
    "S": [{w:"sun", e:"‚òÄÔ∏è"}, {w:"snake", e:"üêç"}, {w:"sock", e:"üß¶"}],
    "T": [{w:"tiger", e:"üêØ"}, {w:"train", e:"üöÜ"}, {w:"tree", e:"üå≥"}],
    "P": [{w:"pizza", e:"üçï"}, {w:"penguin", e:"üêß"}, {w:"pencil", e:"‚úèÔ∏è"}],
    "I": [{w:"ice", e:"üßä"}, {w:"igloo", e:"üè†"}, {w:"insect", e:"ü™≤"}],
    "N": [{w:"nest", e:"ü™∫"}, {w:"nose", e:"üëÉ"}, {w:"nurse", e:"üßë‚Äç‚öïÔ∏è"}],
    "M": [{w:"moon", e:"üåô"}, {w:"monkey", e:"üêí"}, {w:"milk", e:"ü•õ"}],
    "D": [{w:"dog", e:"üê∂"}, {w:"drum", e:"ü•Å"}, {w:"donut", e:"üç©"}],
    "G": [{w:"goat", e:"üêê"}, {w:"grapes", e:"üçá"}, {w:"guitar", e:"üé∏"}],
    "O": [{w:"octopus", e:"üêô"}, {w:"orange", e:"üçä"}, {w:"owl", e:"ü¶â"}],
    "C": [{w:"cat", e:"üê±"}, {w:"car", e:"üöó"}, {w:"cookie", e:"üç™"}],
    "K": [{w:"kite", e:"ü™Å"}, {w:"key", e:"üîë"}, {w:"kangaroo", e:"ü¶ò"}],
    "E": [{w:"egg", e:"ü•ö"}, {w:"elephant", e:"üêò"}, {w:"envelope", e:"‚úâÔ∏è"}],
    "R": [{w:"rain", e:"üåßÔ∏è"}, {w:"robot", e:"ü§ñ"}, {w:"rabbit", e:"üê∞"}],
    "H": [{w:"hat", e:"üé©"}, {w:"house", e:"üè†"}, {w:"horse", e:"üê¥"}],
    "L": [{w:"lion", e:"ü¶Å"}, {w:"leaf", e:"üçÉ"}, {w:"lamp", e:"üí°"}],
    "B": [{w:"ball", e:"‚öΩÔ∏è"}, {w:"banana", e:"üçå"}, {w:"bus", e:"üöå"}],
    "F": [{w:"fish", e:"üêü"}, {w:"frog", e:"üê∏"}, {w:"flower", e:"üå∏"}]
  };

  function startSoundMatch(){
    currentActivity = "sound";
    resetSession();
    setStreak(0);
    setFeedback("", true);

    setHeader("Beginning Sound Match", "Play 5 quick rounds. Pick the picture that starts with the letter.");

    var pool = currentLetters();
    var TOTAL_ROUNDS = 5;
    var round = 0;
    var score = 0;

    var usable = pool.filter(function(L){ return !!SOUND_BANK[L]; });
    if(!usable.length){ usable = ["A","S","T","P","I","N"]; }

    clearBody();

    var frame = el("div", {style:
      "border:1px solid var(--stroke);background:rgba(255,255,255,.86);border-radius:22px;box-shadow: var(--shadow2);padding:14px;display:grid;gap:12px;"
    });

    var topRow = el("div", {style:"display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap"}, [
      el("div", {}, [
        el("div", {style:"font-weight:980;font-size:1.05rem;"}, ["Level: 5 rounds"]),
        el("div", {id:"soundMeta", style:"margin-top:4px;color:var(--muted);font-weight:800;font-size:.92rem;"}, ["Round 0 / 5 ‚Ä¢ Score 0"])
      ]),
      el("div", {style:"display:flex;gap:8px;flex-wrap:wrap;align-items:center"}, [
        el("button", {class:"pill", type:"button", id:"repeatSoundMini", title:"Repeat the instruction"}, ["üîÅ Say again"]),
        el("button", {class:"pill primary", type:"button", id:"startSoundGame"}, ["Start"])
      ])
    ]);

    var dots = el("div", {style:"display:flex;gap:8px;align-items:center;justify-content:flex-start"}, []);
    for(var i=0;i<TOTAL_ROUNDS;i++){
      dots.appendChild(el("div", {class:"psDotSound", style:
        "width:12px;height:12px;border-radius:999px;background:rgba(31,120,255,.10);border:1px solid rgba(31,120,255,.22);"
      }));
    }

    var promptCard = el("div", {style:
      "border:1px solid rgba(31,120,255,.18);background:linear-gradient(180deg, rgba(31,120,255,.10), rgba(255,255,255,.76));border-radius:22px;padding:14px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;"
    }, [
      el("div", {}, [
        el("div", {style:"font-weight:950;color:rgba(11,27,51,.78);"}, ["Letter"]),
        el("div", {id:"soundPrompt", style:"margin-top:6px;font-weight:990;font-size:2.1rem;letter-spacing:.5px;"}, ["Tap Start"])
      ]),
      el("div", {style:"display:flex;gap:10px;align-items:center;flex-wrap:wrap"}, [
        el("span", {class:"pill", style:"cursor:default"}, ["‚úÖ Correct: ", el("span",{id:"soundScore"},["0"])]),
        el("span", {class:"pill", style:"cursor:default"}, ["‚è±Ô∏è Rounds: ", el("span",{id:"soundRound"},["0"]), "/", String(TOTAL_ROUNDS)])
      ])
    ]);

    var grid = el("div", {id:"soundGrid", style:"display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:10px;opacity:.55;pointer-events:none;"});

    var feedbackPanel = el("div", {style:
      "border-radius:18px;padding:12px;border:1px solid rgba(31,120,255,.18);background:rgba(255,255,255,.78);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;"
    }, [
      el("div", {id:"soundFeedback", style:"font-weight:950;color:rgba(75,100,136,1);"}, ["Press Start to begin."]),
      el("button", {class:"pill primary", type:"button", id:"soundNext", style:"display:none"}, ["Next"])
    ]);

    frame.appendChild(topRow);
    frame.appendChild(dots);
    frame.appendChild(promptCard);
    frame.appendChild(grid);
    frame.appendChild(feedbackPanel);

    body.appendChild(frame);

    var meta = document.getElementById("soundMeta");
    var prompt = document.getElementById("soundPrompt");
    var scoreEl = document.getElementById("soundScore");
    var roundEl = document.getElementById("soundRound");
    var fb = document.getElementById("soundFeedback");
    var nextBtn = document.getElementById("soundNext");
    var startBtn = document.getElementById("startSoundGame");
    var repeatBtn = document.getElementById("repeatSoundMini");

    function setDots(){
      var all = frame.querySelectorAll(".psDotSound");
      all.forEach(function(d, i){
        if(i < round){
          d.style.background = "linear-gradient(180deg, var(--blue), var(--blue2))";
          d.style.borderColor = "rgba(31,120,255,.35)";
        }else{
          d.style.background = "rgba(31,120,255,.10)";
          d.style.borderColor = "rgba(31,120,255,.22)";
        }
      });
    }

    function updateMeta(){
      if(meta) meta.textContent = "Round " + round + " / " + TOTAL_ROUNDS + " ‚Ä¢ Score " + score;
      if(scoreEl) scoreEl.textContent = String(score);
      if(roundEl) roundEl.textContent = String(round);
      setDots();
    }

    function lockGrid(locked){
      var g = document.getElementById("soundGrid");
      if(!g) return;
      g.style.opacity = locked ? ".55" : "1";
      g.style.pointerEvents = locked ? "none" : "auto";
    }

    function setFB(msg, good){
      fb.textContent = msg;
      fb.style.color = good ? "rgba(18,51,95,.92)" : "rgba(75,100,136,1)";
    }

    function showNext(show){
      nextBtn.style.display = show ? "" : "none";
    }

    function buildRound(){
      var L = usable[Math.floor(Math.random()*usable.length)];
      var items = SOUND_BANK[L];
      var correct = items[Math.floor(Math.random()*items.length)];

      var distractors = [];
      var otherLetters = Object.keys(SOUND_BANK).filter(function(x){ return x !== L; });
      while(distractors.length < 2){
        var dl = otherLetters[Math.floor(Math.random()*otherLetters.length)];
        var di = SOUND_BANK[dl][Math.floor(Math.random()*SOUND_BANK[dl].length)];
        if(!distractors.some(function(d){ return d.w === di.w; }) && di.w !== correct.w) distractors.push(di);
      }

      var options = [correct].concat(distractors);
      for(var i=options.length-1;i>0;i--){
        var j = Math.floor(Math.random()*(i+1));
        var tmp = options[i]; options[i]=options[j]; options[j]=tmp;
      }

      prompt.textContent = L;
      var promptText = "Find a word that starts with " + L;
      setPrompt(promptText);
      speak("Find a word that starts with " + L + ".");

      grid.innerHTML = "";
      options.forEach(function(opt){
        var b = el("button", {
          type:"button",
          class:"card",
          style:"justify-content:center; padding:16px; text-align:center; min-height:110px; font-weight:990;"
        });

        b.appendChild(el("div", {style:"font-size:2.1rem; line-height:1; margin-bottom:10px;"}, [opt.e]));
        b.appendChild(el("div", {style:"font-size:1.05rem; text-transform:capitalize;"}, [opt.w]));

        b.addEventListener("click", function(){
          if(opt.w === correct.w){
            shimmer(b);
            score += 1;
            setFB("‚úÖ Correct! Nice listening.", true);
            speak("Well done.");
            lockGrid(true);
            showNext(true);
          }else{
            shake(b);
            setFB("Try again.", false);
            speak("Try again.");
          }
        });

        grid.appendChild(b);
      });
    }

    function startGameRound(){
      round += 1;
      updateMeta();
      lockGrid(false);
      showNext(false);
      setFB("Say the word out loud. Listen for the first sound.", true);
      buildRound();
    }

    function finish(){
      lockGrid(true);
      showNext(false);
      var msg = "Finished! You got " + score + " out of " + TOTAL_ROUNDS + ".";
      setFB(msg, true);
      speak("Great work. " + msg);
      if(score >= 4){
        addSessionStar();
        if(score === 5) addSessionStar();
      }
      startBtn.textContent = "Play again";
      startBtn.style.display = "";
    }

    if(repeatBtn){
      repeatBtn.addEventListener("click", function(){ if(lastPrompt) speak(lastPrompt); });
    }

    if(startBtn){
      startBtn.addEventListener("click", function(){
        setFB("Get ready‚Ä¶", true);
        speak("Let's play.");
        score = 0;
        round = 0;
        updateMeta();
        startBtn.style.display = "none";
        startGameRound();
      });
    }

    if(nextBtn){
      nextBtn.addEventListener("click", function(){
        if(round >= TOTAL_ROUNDS) finish();
        else startGameRound();
      });
    }

    updateMeta();
    lockGrid(true);
  }


  // Letter Sound Tap (tap a letter to hear it spoken)
  function startSoundTap(){
    currentActivity = "tap";
    resetSession();
    setStreak(0);
    setFeedback("", true);

    setHeader("Letter Sound Tap", "Tap a letter to hear it. Use Set and Difficulty to change what you see.");

    var pool = currentLetters();
    clearBody();

    var note = el("div", {
      style:"padding:12px;border-radius:18px;border:1px solid var(--stroke);background:rgba(255,255,255,.78);color:var(--muted);font-weight:750;"
    }, [
      "Tip: Tap a letter, then repeat it out loud together. ",
      "Use ‚ÄúVoice: On‚Äù for speech."
    ]);

    var grid = el("div", {
      style:"display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:10px;"
    });

    pool.forEach(function(L){
      var b = el("button", {
        type:"button",
        class:"card",
        style:"justify-content:center; padding:18px; text-align:center; min-height:76px; font-size:1.8rem; font-weight:980;"
      }, [L]);

      b.addEventListener("click", function(){
        shimmer(b);
        setFeedback("üîä " + L, true);
        // Speak letter name. If you want sounds later, we can swap to phoneme audio files.
        setPrompt("Letter " + L);
        speak(L);
      });

      grid.appendChild(b);
    });

    // Quick controls row: speak all / random
    var controls = el("div", {style:"display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-start"}, [
      el("button", {class:"pill primary", type:"button", id:"tapRandom"}, ["Random letter"]),
      el("button", {class:"pill", type:"button", id:"tapSaySet"}, ["Say set"])
    ]);

    body.appendChild(controls);
    body.appendChild(grid);
    body.appendChild(note);

    var rnd = document.getElementById("tapRandom");
    if(rnd){
      rnd.addEventListener("click", function(){
        var r = pool[Math.floor(Math.random()*pool.length)];
        setFeedback("üîä " + r, true);
        setPrompt("Letter " + r);
        speak(r);
      });
    }
    var saySet = document.getElementById("tapSaySet");
    if(saySet){
      saySet.addEventListener("click", function(){
        // say letters slowly
        if(voicePref !== "on"){
          setFeedback("Turn Voice on to hear the set.", false);
          return;
        }
        try{
          window.speechSynthesis.cancel();
        }catch(e){}
        var i = 0;
        function sayNext(){
          if(i >= pool.length) return;
          speak(pool[i]);
          i++;
          setTimeout(sayNext, 650);
        }
        sayNext();
      });
    }
  }

function restartActivity(){
    if(currentActivity === "find") startFind();
    else if(currentActivity === "match") startMatch();
    else if(currentActivity === "sound") startSoundMatch();
    else if(currentActivity === "tap") startSoundTap();
  }

  // Launch buttons
  var launchFind = document.getElementById("launchFind");
  var launchMatch = document.getElementById("launchMatch");
  var launchSoundMatch = document.getElementById("launchSoundMatch");
  var launchSoundTap = document.getElementById("launchSoundTap");
  // Reset button: reset session + restart current activity
  if(resetBtn){
    resetBtn.addEventListener("click", function(){
      resetSession();
      setStreak(0);
      setFeedback("", true);
      if(window.speechSynthesis) try{ window.speechSynthesis.cancel(); }catch(e){}
      if(currentActivity) restartActivity();
      else {
        clearBody();
        setHeader("Select an activity", "Pick a game above to start.");
        setPrompt("");
        body.appendChild(el("div", {style:"padding:12px;border-radius:18px;border:1px dashed rgba(31,120,255,.28);color:var(--muted);font-weight:750;"}, [
          "Tip: Turn Voice on, then tap Play above. Use Say again any time."
        ]));
      }
    });
  }
})();
</script>


    <div class="footer">¬© 2025 Primary Steps</div>
  </div>

<script>
(function(){
  var el = document.getElementById("starsCount");
  if(!el) return;
  el.textContent = String(Number(localStorage.getItem("ps_stars") || "0"));

  // ---------- Premium finish modal ----------
  var psModal = document.getElementById("psModal");
  var psModalTitle = document.getElementById("psModalTitle");
  var psModalMsg = document.getElementById("psModalMsg");
  var psModalClose = document.getElementById("psModalClose");
  var psModalAgain = document.getElementById("psModalAgain");
  var psModalNext = document.getElementById("psModalNext");
  var psConfetti = document.getElementById("psConfetti");

  function burstConfetti(){
    if(!psConfetti) return;
    psConfetti.innerHTML = "";
    var pieces = 18;
    for(var i=0;i<pieces;i++){
      var p = document.createElement("i");
      var left = Math.random()*100;
      var delay = Math.random()*120;
      var w = 8 + Math.random()*8;
      var h = 12 + Math.random()*14;
      p.style.left = left + "%";
      p.style.top = (-10 - Math.random()*40) + "px";
      p.style.width = w + "px";
      p.style.height = h + "px";
      p.style.animationDelay = (delay/1000) + "s";
      // alternate subtle tones
      p.style.background = (i%3===0) ? "rgba(31,120,255,.60)" : (i%3===1 ? "rgba(88,173,255,.55)" : "rgba(255,255,255,.75)");
      psConfetti.appendChild(p);
    }
  }

  function openModal(title, msg){
    if(!psModal) return;
    psModalTitle.textContent = title || "Great job!";
    psModalMsg.textContent = msg || "You finished the level.";
    psModal.classList.add("show");
    burstConfetti();
  }
  function closeModal(){
    if(!psModal) return;
    psModal.classList.remove("show");
  }

  if(psModalClose) psModalClose.addEventListener("click", closeModal);
  if(psModal) psModal.addEventListener("click", function(e){
    if(e.target === psModal) closeModal();
  });

  // Buttons (wired by current activity finish)
  var lastFinishedActivity = null;
  if(psModalAgain){
    psModalAgain.addEventListener("click", function(){
      closeModal();
      if(lastFinishedActivity === "find") startFind();
      else if(lastFinishedActivity === "match") startMatch();
      else if(lastFinishedActivity === "sound") startSoundMatch();
      else if(lastFinishedActivity === "tap") startSoundTap();
    });
  }
  if(psModalNext){
    psModalNext.addEventListener("click", function(){
      closeModal();
      // Soft nudge back to launcher area
      var area = document.getElementById("lettersPage");
      if(area) area.scrollIntoView({behavior:"smooth", block:"start"});
      setFeedback("Pick another game above.", true);
      speak("Pick another game.");
    });
  }


  // ---------- Hub (launcher) polish ----------
  var quickStartBtn = document.getElementById("quickStart");
  var viewBadgesBtn = document.getElementById("viewBadges");
  var hubMiniText = document.getElementById("hubMiniText");

  function setRecommended(which){
    ["recoFind","recoMatch","recoSound","recoTap"].forEach(function(id){
      var t = document.getElementById(id);
      if(t) t.style.display = "none";
    });
    var map = {find:"recoFind", match:"recoMatch", sound:"recoSound", tap:"recoTap"};
    var id = map[which];
    var tag = id ? document.getElementById(id) : null;
    if(tag) tag.style.display = "inline-flex";
  }

  function recommendedForLevel(){
    var lvl = levelSelect ? Number(levelSelect.value || "0") : 0;
    if(lvl === 1) return "tap";
    if(lvl === 2) return "find";
    if(lvl === 3) return "sound";
    return "find";
  }

  function goActivity(key){
    try{ localStorage.setItem("ps_letters_last_activity", key); }catch(e){}
    if(key === "find") startFind();
    else if(key === "match") startMatch();
    else if(key === "sound") startSoundMatch();
    else if(key === "tap") startSoundTap();
    var pa = document.getElementById("playArea");
    if(pa) pa.scrollIntoView({behavior:"smooth", block:"start"});
  }

  function refreshHub(){
    var rec = recommendedForLevel();
    setRecommended(rec);
    if(hubMiniText){
      var lvl = levelSelect ? Number(levelSelect.value || "0") : 0;
      var t = "Tip: Start with Level 1 for confidence, then move up.";
      if(lvl === 1) t = "Level 1 tip: Warm up with Letter Sound Tap, then try Find the Letter.";
      if(lvl === 2) t = "Level 2 tip: Use Find the Letter, then Upper & Lower Match.";
      if(lvl === 3) t = "Level 3 tip: Try Beginning Sound Match for a phonics-style challenge.";
      hubMiniText.textContent = t;
    }
  }

  // Wire hub buttons
  if(launchFind) launchFind.addEventListener("click", function(){ goActivity("find"); });
  if(launchMatch) launchMatch.addEventListener("click", function(){ goActivity("match"); });
  if(launchSoundMatch) launchSoundMatch.addEventListener("click", function(){ goActivity("sound"); });
  if(launchSoundTap) launchSoundTap.addEventListener("click", function(){ goActivity("tap"); });

  if(quickStartBtn){
    quickStartBtn.addEventListener("click", function(){
      var last = "";
      try{ last = localStorage.getItem("ps_letters_last_activity") || ""; }catch(e){}
      goActivity(last || recommendedForLevel());
    });
  }

  if(viewBadgesBtn){
    viewBadgesBtn.addEventListener("click", function(){
      var b = document.getElementById("badgesGrid");
      if(b) b.scrollIntoView({behavior:"smooth", block:"start"});
    });
  }

  if(levelSelect){
    levelSelect.addEventListener("change", function(){ refreshHub(); });
  }
  refreshHub();


  // ---------- Today's Goal (2 games) ----------
  var GOAL_N = 2;
  var goalFill = document.getElementById("goalFill");
  var goalCount = document.getElementById("goalCount");
  var goalSub = document.getElementById("goalSub");
  var continueBtn = document.getElementById("continueBtn");
  var resetTodayBtn = document.getElementById("resetTodayBtn");

  function todayKey(){
    var d = new Date();
    // local day key YYYY-MM-DD
    var yyyy = d.getFullYear();
    var mm = String(d.getMonth()+1).padStart(2,"0");
    var dd = String(d.getDate()).padStart(2,"0");
    return yyyy + "-" + mm + "-" + dd;
  }
  function getTodayProgress(){
    try{
      var raw = localStorage.getItem("ps_letters_goal_v1");
      var obj = raw ? JSON.parse(raw) : null;
      if(!obj || obj.day !== todayKey()) return {day: todayKey(), done: 0};
      return obj;
    }catch(e){
      return {day: todayKey(), done: 0};
    }
  }
  function setTodayProgress(done){
    try{
      localStorage.setItem("ps_letters_goal_v1", JSON.stringify({day: todayKey(), done: done}));
    }catch(e){}
  }
  function renderGoal(){
    var p = getTodayProgress();
    var done = Math.max(0, Math.min(GOAL_N, p.done||0));
    if(goalFill) goalFill.style.width = Math.round((done/GOAL_N)*100) + "%";
    if(goalCount) goalCount.textContent = done + " / " + GOAL_N;
    if(goalSub){
      goalSub.textContent = (done >= GOAL_N)
        ? "Goal complete! Bonus badge unlocked."
        : "Complete " + (GOAL_N - done) + " more game" + ((GOAL_N-done)===1 ? "" : "s") + " to earn a bonus badge.";
    }
    // unlock badge
    if(done >= GOAL_N && typeof awardBadge === "function"){
      awardBadge("daily2");
    }
  }
  function bumpGoal(){
    var p = getTodayProgress();
    var done = (p.done||0) + 1;
    setTodayProgress(done);
    renderGoal();
    // little pop
    if(goalCount){ goalCount.classList.remove("pop"); void goalCount.offsetWidth; goalCount.classList.add("pop"); }
  }

  if(resetTodayBtn){
    resetTodayBtn.addEventListener("click", function(){
      setTodayProgress(0);
      renderGoal();
      setFeedback("Today‚Äôs goal reset.", false);
      speak("Goal reset.");
    });
  }

  if(continueBtn){
    continueBtn.addEventListener("click", function(){
      // continue = last activity, otherwise recommended
      var last = "";
      try{ last = localStorage.getItem("ps_letters_last_activity") || ""; }catch(e){}
      var pick = last || (typeof recommendedForLevel === "function" ? recommendedForLevel() : "find");
      if(typeof goActivity === "function") goActivity(pick);
      else{
        // fallback
        if(pick === "find") startFind();
        else if(pick === "match") startMatch();
        else if(pick === "sound") startSoundMatch();
        else startSoundTap();
      }
    });
  }

  renderGoal();

})();
</script>
</body>
</html>
