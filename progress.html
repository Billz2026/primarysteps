<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Progress ‚Äì Primary Steps</title>

  <style>
    :root{
      --bg:#0b0d12;
      --panel:#121621;
      --panel2:#0f1320;
      --text:#eef2ff;
      --muted:#a9b2c7;
      --brand:#7dd3fc;
      --accent2:#a78bfa;
      --good:#34d399;
      --bad:#fb7185;
      --border:rgba(255,255,255,.1);
      --radius:18px;
      --shadow:0 12px 40px rgba(0,0,0,.35);
      --ring:rgba(125,211,252,.30);
    }

    *{box-sizing:border-box}
    html,body{margin:0;height:100%}

    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 500px at 20% 0%, rgba(125,211,252,.18), transparent 60%),
        radial-gradient(900px 500px at 85% 20%, rgba(167,139,250,.18), transparent 60%),
        var(--bg);
      color:var(--text);
    }

    /* Header */
    header{
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter: blur(12px);
      background: rgba(18,22,33,.75);
      border-bottom:1px solid var(--border);
    }
    .topbar{
      max-width:1150px;
      margin:auto;
      padding:12px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:var(--text);
      min-width: 200px;
    }
    .brand img{
      height:52px;
      width:auto;
      filter:drop-shadow(0 10px 25px rgba(125,211,252,.25));
    }
    .brand span{
      font-weight:750;
      font-size:14px;
      letter-spacing:.04em;
    }

    .nav{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      text-decoration:none;
      color:var(--text);
      padding:9px 14px;
      border-radius:999px;
      background:rgba(15,19,32,.7);
      border:1px solid var(--border);
      font-size:13px;
      font-weight:600;
      transition:.2s ease;
      display:inline-flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }
    .pill:hover{
      transform:translateY(-1px);
      border-color:rgba(125,211,252,.35);
    }
    .pill strong{font-weight:800}

    /* Layout */
    .container{
      max-width:1150px;
      margin:auto;
      padding:28px 18px 60px;
    }
    .hero{margin-bottom:18px}
    .hero h1{
      margin:0 0 6px;
      font-size:clamp(22px,3vw,30px);
      letter-spacing:.2px;
    }
    .hero p{
      margin:0;
      color:var(--muted);
      font-size:14px;
      line-height:1.45;
    }

    .panel{
      background:linear-gradient(180deg, rgba(18,22,33,.95), rgba(11,13,18,.85));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }

    .grid{display:grid; gap:14px}
    .grid2{display:grid; gap:14px; grid-template-columns: repeat(3, minmax(0,1fr));}
    @media (max-width:900px){ .grid2{grid-template-columns:1fr} }

    .stat{
      padding:16px;
      border-radius:16px;
      background:rgba(15,19,32,.75);
      border:1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
    }
    .stat .k{color:var(--muted); font-size:12px; font-weight:850; letter-spacing:.04em}
    .stat .v{font-size:22px; font-weight:950; letter-spacing:.2px}
    .chip{
      font-size:12px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.12);
      color:var(--muted);
      white-space:nowrap;
    }
    .chip.good{border-color:rgba(52,211,153,.35); background:rgba(52,211,153,.10); color:rgba(238,242,255,.92)}
    .chip.brand{border-color:rgba(125,211,252,.35); background:rgba(125,211,252,.10); color:rgba(238,242,255,.92)}
    .chip.bad{border-color:rgba(251,113,133,.35); background:rgba(251,113,133,.10); color:rgba(238,242,255,.92)}

    .sectionTitle{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      margin-top:6px;
    }
    .sectionTitle h2{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .sectionTitle p{
      margin:0;
      color:var(--muted);
      font-size:12px;
    }

    .cards{display:grid; gap:12px; margin-top:12px; grid-template-columns: repeat(2, minmax(0,1fr));}
    @media (max-width:900px){ .cards{grid-template-columns:1fr} }

    .card{
      padding:16px;
      border-radius:16px;
      background:rgba(15,19,32,.75);
      border:1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      min-height:96px;
    }
    .left{display:flex; gap:12px; align-items:flex-start; min-width:0}
    .ico{
      width:44px;
      height:44px;
      border-radius:14px;
      display:grid;
      place-items:center;
      background:rgba(125,211,252,.14);
      border:1px solid rgba(125,211,252,.25);
      flex:0 0 auto;
      font-size:18px;
    }
    .meta{min-width:0}
    .name{
      margin:0 0 6px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .right{display:flex; flex-direction:column; gap:8px; align-items:flex-end; flex:0 0 auto}

    .stars{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .star{
      width:22px; height:22px;
      border-radius:8px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.05);
      cursor:pointer;
      user-select:none;
      transition:.15s ease;
      font-weight:950;
    }
    .star.on{
      border-color:rgba(253,224,71,.45);
      background:rgba(253,224,71,.15);
    }
    .star:hover{ transform:translateY(-1px); border-color:rgba(125,211,252,.35); }

    .minirow{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .mini{font-size:12px; color:rgba(238,242,255,.78); font-weight:850}
    .muted{color:var(--muted)}

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top:12px;
    }
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 14px;
      border-radius:999px;
      font-weight:850;
      font-size:13px;
      cursor:pointer;
      transition:.2s ease;
    }
    .btn:hover{
      transform:translateY(-1px);
      border-color:rgba(125,211,252,.35);
      background:rgba(125,211,252,.10);
    }
    .btn.danger:hover{
      border-color:rgba(251,113,133,.45);
      background:rgba(251,113,133,.10);
    }

    .goal{
      margin-top:12px;
      padding:14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
    }
    .bar{
      height:10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.12);
      overflow:hidden;
      margin-top:8px;
    }
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(125,211,252,.75), rgba(167,139,250,.65));
    }

    .badges{
      display:grid;
      grid-template-columns: repeat(5, minmax(0,1fr));
      gap:10px;
      margin-top:12px;
    }
    @media (max-width:1100px){ .badges{grid-template-columns:repeat(3,minmax(0,1fr));} }
    @media (max-width:650px){ .badges{grid-template-columns:repeat(2,minmax(0,1fr));} }

    .badge{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(15,19,32,.65);
      padding:12px;
      display:flex;
      gap:10px;
      align-items:center;
      min-height:72px;
      opacity:.65;
    }
    .badge.on{
      opacity:1;
      border-color:rgba(125,211,252,.35);
      background:rgba(125,211,252,.08);
    }
    .badge .bico{
      width:38px; height:38px;
      border-radius:14px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.12);
      flex:0 0 auto;
      font-size:18px;
    }
    .badge .bt{font-weight:950; font-size:13px; margin:0}
    .badge .bd{margin:2px 0 0; font-size:12px; color:var(--muted); line-height:1.25}

    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background:rgba(18,22,33,.92);
      border:1px solid rgba(255,255,255,.14);
      border-radius:999px;
      padding:10px 14px;
      color:var(--text);
      font-size:13px;
      font-weight:850;
      box-shadow:var(--shadow);
      opacity:0;
      pointer-events:none;
      transition:.2s ease;
      white-space:nowrap;
      max-width:92vw;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-2px);}

    .footer{
      margin-top:18px;
      color:rgba(238,242,255,.55);
      font-size:12px;
      text-align:center;
    }

    @media (max-width:520px){
      .brand span{display:none}
      .brand{min-width:unset}
      .nav{gap:8px}
      .pill{padding:8px 12px}
      .right{align-items:flex-start}
      .minirow{justify-content:flex-start}
    }
  </style>
</head>

<body>

<header>
  <div class="topbar">
    <a href="index.html" class="brand">
      <img src="assets/primary-steps-logo.png" alt="Primary Steps">
      <span>Primary Steps</span>
    </a>

    <nav class="nav">
      <a class="pill" href="index.html">Home</a>
      <a class="pill" href="letters.html">Letters</a>
      <a class="pill" href="numbers.html">Numbers</a>
      <a class="pill" href="games.html">Games</a>
      <a class="pill" href="puzzles.html">Puzzles</a>
      <a class="pill" href="settings.html">Settings</a>
      <a class="pill" href="progress.html" aria-current="page">‚≠ê <strong id="starsCount">0</strong></a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <h1>‚≠ê Progress</h1>
    <p>A simple star system (0‚Äì3 stars per activity), plus streaks and badges. Saved on this device.</p>
  </section>

  <section class="panel">
    <div class="grid2" style="margin-bottom:14px;">
      <div class="stat">
        <div>
          <div class="k">TOTAL STARS</div>
          <div class="v" id="totalStars">0</div>
        </div>
        <span class="chip brand" id="starsLabel">0 / 0</span>
      </div>

      <div class="stat">
        <div>
          <div class="k">MASTERED</div>
          <div class="v" id="masteredCount">0</div>
        </div>
        <span class="chip good" id="masteredLabel">‚≠ê‚≠ê‚≠ê</span>
      </div>

      <div class="stat">
        <div>
          <div class="k">STREAK</div>
          <div class="v" id="streakDays">0</div>
        </div>
        <span class="chip" id="streakLabel">No streak yet</span>
      </div>
    </div>

    <div class="goal">
      <div class="sectionTitle" style="margin:0">
        <div>
          <h2>Weekly goal</h2>
          <p class="muted">Aim for 5 activities this week</p>
        </div>
        <span class="chip" id="weeklyChip">0 / 5</span>
      </div>
      <div class="bar" aria-label="Weekly goal progress">
        <i id="weeklyBar"></i>
      </div>
    </div>

    <div class="sectionTitle" style="margin-top:16px;">
      <div>
        <h2>Activities</h2>
        <p class="muted">Tap stars to update (0‚Äì3). We‚Äôll auto-unlock badges.</p>
      </div>
      <div class="actions">
        <button class="btn" id="todayBtn" type="button">Mark practice today</button>
        <button class="btn" id="exportBtn" type="button">Export</button>
        <button class="btn danger" id="resetBtn" type="button">Reset</button>
      </div>
    </div>

    <div class="cards" id="cards"></div>

    <div class="sectionTitle" style="margin-top:18px;">
      <div>
        <h2>Badges</h2>
        <p class="muted">Earn badges by practising and mastering activities.</p>
      </div>
      <span class="chip" id="badgeChip">0 earned</span>
    </div>

    <div class="badges" id="badges"></div>

    <div class="footer">¬© 2025 Primary Steps</div>
  </section>
</main>

<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
(function(){
  const KEY = "ps_progress_v2";
  const LEGACY_STARS_KEY = "ps_stars"; // from your old page
  const WEEKLY_GOAL = 5;

  const sections = [
    {id:"letters", label:"Letters", icon:"üî§", href:"letters.html"},
    {id:"numbers", label:"Numbers", icon:"üî¢", href:"numbers.html"},
    {id:"games", label:"Games", icon:"üéÆ", href:"games.html"},
    {id:"puzzles", label:"Puzzles", icon:"üß©", href:"puzzles.html"},
    {id:"handwriting", label:"Handwriting", icon:"‚úçÔ∏è", href:"handwriting.html"},
    {id:"clock", label:"Clock", icon:"üïí", href:"clock.html"},
    {id:"memory", label:"Memory", icon:"üß†", href:"memory.html"},
    {id:"maths", label:"Maths", icon:"‚ûï", href:"maths.html"}
  ];

  const badgeDefs = [
    {id:"first_steps", icon:"üåü", title:"First Steps", desc:"Earn 3 stars in total", test:(s)=>s.totalStars>=3},
    {id:"starter_week", icon:"üìÖ", title:"Starter Week", desc:"Do 5 practices in a week", test:(s)=>s.weekly.count>=5},
    {id:"streak_3", icon:"üî•", title:"Daily Hero", desc:"Reach a 3‚Äëday streak", test:(s)=>s.streak>=3},
    {id:"streak_7", icon:"üî•", title:"Streak Star", desc:"Reach a 7‚Äëday streak", test:(s)=>s.streak>=7},
    {id:"master_3", icon:"üèÜ", title:"Mastery Badge", desc:"Get 3 activities to ‚≠ê‚≠ê‚≠ê", test:(s)=>s.masteredCount>=3},
    {id:"master_6", icon:"üëë", title:"Master of Skills", desc:"Get 6 activities to ‚≠ê‚≠ê‚≠ê", test:(s)=>s.masteredCount>=6},
    {id:"letters_3", icon:"üî§", title:"Letter Legend", desc:"Letters at ‚≠ê‚≠ê‚≠ê", test:(s)=>s.activities.letters.stars===3},
    {id:"numbers_3", icon:"üî¢", title:"Number Ninja", desc:"Numbers at ‚≠ê‚≠ê‚≠ê", test:(s)=>s.activities.numbers.stars===3},
    {id:"puzzles_3", icon:"üß©", title:"Puzzle Pro", desc:"Puzzles at ‚≠ê‚≠ê‚≠ê", test:(s)=>s.activities.puzzles.stars===3},
    {id:"games_3", icon:"üéÆ", title:"Game Champ", desc:"Games at ‚≠ê‚≠ê‚≠ê", test:(s)=>s.activities.games.stars===3}
  ];

  const $ = (id)=>document.getElementById(id);
  const toast = $("toast");
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1400);
  }

  function todayISO(d=new Date()){
    const dt = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    return dt.toISOString().slice(0,10);
  }
  function weekKey(d=new Date()){
    // Monday-start week key: YYYY-Www (simple stable key)
    const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    const dayNum = date.getUTCDay() || 7; // 1..7
    date.setUTCDate(date.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
    const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1)/7);
    return date.getUTCFullYear() + "-W" + String(weekNo).padStart(2,"0");
  }

  function freshState(){
    const activities = {};
    sections.forEach(s=>{
      activities[s.id] = {stars:0, attempts:0, best:0, lastPlayed:""};
    });
    return {
      v:2,
      activities,
      streak:0,
      lastPractice:"",
      weekly:{key:weekKey(), count:0},
      badges:{},
      migrated:false
    };
  }

  function load(){
    let s;
    try{ s = JSON.parse(localStorage.getItem(KEY) || "null"); }catch(e){ s=null; }
    if(!s || s.v!==2) s = freshState();

    // ensure all activities exist (in case you add new ones later)
    sections.forEach(sec=>{
      if(!s.activities[sec.id]) s.activities[sec.id] = {stars:0, attempts:0, best:0, lastPlayed:""};
    });

    // weekly rollover
    const wk = weekKey();
    if(!s.weekly || s.weekly.key !== wk){
      s.weekly = {key:wk, count:0};
    }

    // one-time migration from old ps_stars (simple total)
    if(!s.migrated){
      const legacy = Number(localStorage.getItem(LEGACY_STARS_KEY) || "0");
      if(legacy > 0){
        // Put legacy stars into "letters" as a soft conversion (or distribute)
        s.activities.letters.stars = Math.min(3, Math.max(s.activities.letters.stars, legacy >= 3 ? 3 : legacy));
      }
      s.migrated = true;
    }

    return s;
  }

  function save(s){
    localStorage.setItem(KEY, JSON.stringify(s));
  }

  function totals(s){
    let totalStars = 0;
    let totalMax = 0;
    let mastered = 0;
    let any = 0;
    sections.forEach(sec=>{
      const a = s.activities[sec.id];
      const st = Math.max(0, Math.min(3, Number(a.stars)||0));
      totalStars += st;
      totalMax += 3;
      if(st>0) any++;
      if(st===3) mastered++;
      a.stars = st;
    });
    return {totalStars, totalMax, mastered, any};
  }

  function updateBadges(s, computed){
    const summary = {
      totalStars: computed.totalStars,
      masteredCount: computed.mastered,
      streak: s.streak,
      weekly: s.weekly,
      activities: s.activities
    };
    badgeDefs.forEach(b=>{
      const earned = !!b.test(summary);
      s.badges[b.id] = earned ? true : (s.badges[b.id] || false);
    });
  }

  function render(){
    const s = load();

    // derive streak label (doesn't auto-increment unless user marks practice)
    const t = todayISO();
    if(s.lastPractice){
      const last = s.lastPractice;
      // if last practice was yesterday and streak already set, keep; if gap >1, keep but label as paused until next mark.
      // We calculate only on "mark practice today".
    }

    const computed = totals(s);
    updateBadges(s, computed);
    save(s);

    // header star count (show total stars)
    $("starsCount").textContent = String(computed.totalStars);
    $("totalStars").textContent = String(computed.totalStars);
    $("starsLabel").textContent = computed.totalStars + " / " + computed.totalMax;

    $("masteredCount").textContent = String(computed.mastered);
    $("streakDays").textContent = String(s.streak);

    const streakLabel = s.streak === 0 ? "No streak yet" : (s.lastPractice ? ("Last: " + s.lastPractice) : "Keep going");
    $("streakLabel").textContent = streakLabel;

    // weekly
    $("weeklyChip").textContent = s.weekly.count + " / " + WEEKLY_GOAL;
    const pct = Math.max(0, Math.min(100, (s.weekly.count / WEEKLY_GOAL) * 100));
    $("weeklyBar").style.width = pct + "%";

    // activity cards
    const cards = $("cards");
    cards.innerHTML = "";
    sections.forEach(sec=>{
      const a = s.activities[sec.id];
      const card = document.createElement("div");
      card.className = "card";

      const last = a.lastPlayed ? ("Last played: " + a.lastPlayed) : "Not played yet";
      const best = (a.best && a.best>0) ? ("Best: " + a.best + "%") : "Best: ‚Äì";
      const attempts = "Attempts: " + (a.attempts||0);

      card.innerHTML = `
        <div class="left">
          <div class="ico" aria-hidden="true">${sec.icon}</div>
          <div class="meta">
            <p class="name">${sec.label}</p>
            <p class="sub">${last} ‚Ä¢ ${attempts} ‚Ä¢ ${best}</p>
          </div>
        </div>
        <div class="right">
          <div class="stars" role="group" aria-label="${sec.label} stars">
            <div class="star" data-sec="${sec.id}" data-v="1" title="1 star">‚òÖ</div>
            <div class="star" data-sec="${sec.id}" data-v="2" title="2 stars">‚òÖ</div>
            <div class="star" data-sec="${sec.id}" data-v="3" title="3 stars">‚òÖ</div>
          </div>
          <div class="minirow">
            <a class="chip" href="${sec.href}">Open</a>
            <button class="chip" data-practice="${sec.id}" type="button">+ Practice</button>
          </div>
        </div>
      `;

      cards.appendChild(card);

      // set star state
      const st = Number(a.stars||0);
      const starEls = card.querySelectorAll(".star");
      starEls.forEach(el=>{
        const v = Number(el.dataset.v);
        if(v<=st) el.classList.add("on");
      });

      // click stars sets exact value, clicking same value toggles down by 1
      starEls.forEach(el=>{
        el.addEventListener("click", ()=>{
          const secId = el.dataset.sec;
          const v = Number(el.dataset.v);
          const cur = Number(s.activities[secId].stars||0);
          s.activities[secId].stars = (cur===v) ? (v-1) : v;
          s.activities[secId].lastPlayed = todayISO();
          save(s);
          showToast(sec.label + " set to " + s.activities[secId].stars + " star(s)");
          render();
        });
      });

      // practice button increments attempts + weekly, and updates streak if needed
      const pbtn = card.querySelector("[data-practice]");
      pbtn.addEventListener("click", ()=>{
        markPractice(s, sec.id, {score:0});
        save(s);
        showToast("Practice saved");
        render();
      });
    });

    // badges
    const badgesWrap = $("badges");
    badgesWrap.innerHTML = "";
    let earnedCount = 0;
    badgeDefs.forEach(b=>{
      const on = !!s.badges[b.id];
      if(on) earnedCount++;
      const el = document.createElement("div");
      el.className = "badge" + (on ? " on" : "");
      el.innerHTML = `
        <div class="bico" aria-hidden="true">${b.icon}</div>
        <div>
          <p class="bt">${b.title}</p>
          <p class="bd">${b.desc}</p>
        </div>
      `;
      badgesWrap.appendChild(el);
    });
    $("badgeChip").textContent = earnedCount + " earned";
  }

  function markPractice(s, activityId, opts){
    const t = todayISO();
    const y = new Date();
    y.setDate(y.getDate()-1);
    const yISO = todayISO(y);

    // attempts/best/last
    const a = s.activities[activityId] || (s.activities[activityId]={stars:0, attempts:0, best:0, lastPlayed:""});
    a.attempts = Number(a.attempts||0) + 1;
    a.lastPlayed = t;
    if(opts && typeof opts.score === "number" && opts.score > (a.best||0)){
      a.best = Math.max(0, Math.min(100, Math.round(opts.score)));
    }

    // weekly counter (only count once per day)
    if(!s._weekDays) s._weekDays = {};
    if(s.weekly.key !== weekKey()){
      s.weekly = {key:weekKey(), count:0};
      s._weekDays = {};
    }
    if(!s._weekDays[t]){
      s._weekDays[t] = true;
      s.weekly.count = Number(s.weekly.count||0) + 1;
    }

    // streak update (only once per day)
    if(s.lastPractice === t){
      // already marked today
      return;
    }
    if(!s.lastPractice){
      s.streak = 1;
    } else if(s.lastPractice === yISO){
      s.streak = Number(s.streak||0) + 1;
    } else {
      s.streak = 1;
    }
    s.lastPractice = t;
  }

  // global controls
  $("todayBtn").addEventListener("click", ()=>{
    const s = load();
    // mark practice without a specific activity
    // we count it towards weekly + streak, and to "attempts" in progress as a general practice event by incrementing memory
    // choose last opened section fallback:
    markPractice(s, "letters", {score:0});
    save(s);
    showToast("Marked practice today");
    render();
  });

  $("resetBtn").addEventListener("click", ()=>{
    const ok = confirm("Reset all stars, streaks, and badges on this device?");
    if(!ok) return;
    localStorage.removeItem(KEY);
    localStorage.removeItem(LEGACY_STARS_KEY);
    showToast("Progress reset");
    render();
  });

  $("exportBtn").addEventListener("click", ()=>{
    const s = load();
    const computed = totals(s);
    const payload = {
      exportedAt: new Date().toISOString(),
      totalStars: computed.totalStars,
      mastered: computed.mastered,
      streak: s.streak,
      weekly: s.weekly,
      activities: s.activities,
      badges: s.badges
    };
    const txt = JSON.stringify(payload, null, 2);
    navigator.clipboard?.writeText(txt).then(()=>{
      showToast("Export copied to clipboard");
    }).catch(()=>{
      // fallback: prompt
      window.prompt("Copy your progress JSON:", txt);
    });
  });

  // initial
  render();
})();
</script>

</body>
</html>
