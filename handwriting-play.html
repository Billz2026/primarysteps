<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Handwriting • Primary Steps</title>
<link rel="icon" href="assets/primary-steps-icon-512.png" />
<style>
:root{
  --bg0:#0b0d12; --bg1:#0f1320;
  --text:#eef2ff; --muted:rgba(238,242,255,.72);
  --line:rgba(255,255,255,.12);
  --accent:#7dd3fc; --accent2:#a78bfa; --good:#34d399; --bad:#fb7185;
  --ring:rgba(125,211,252,.30);
  --shadow:0 18px 40px rgba(0,0,0,.35);
  --r:18px;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  background:
    radial-gradient(1200px 700px at 20% 10%, rgba(125,211,252,.18), transparent 55%),
    radial-gradient(900px 600px at 80% 0%, rgba(167,139,250,.16), transparent 55%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
  min-height:100vh;
}
header{
  position:sticky; top:0; z-index:10;
  backdrop-filter: blur(10px);
  background: rgba(18,22,33,.72);
  border-bottom:1px solid var(--line);
}
.wrap{max-width:1100px;margin:0 auto;padding:14px 16px;}
.top{display:flex; align-items:center; justify-content:space-between; gap:12px;}
.brand{display:flex; align-items:center; gap:10px; min-width:0; text-decoration:none; color:var(--text);}
.brand img{height:52px;width:auto;display:block; filter: drop-shadow(0 16px 30px rgba(125,211,252,.10));}
.brand .title{font-weight:850; letter-spacing:.2px; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.brand .sub{display:block; font-size:12px; color:var(--muted); margin-top:2px}
nav{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
nav a{
  color:var(--text); text-decoration:none; font-weight:700; font-size:13px;
  padding:8px 10px; border-radius:12px;
  border:1px solid transparent; opacity:.92;
}
nav a:hover{border-color:var(--line); background:rgba(255,255,255,.04); opacity:1;}
nav a.active{border-color:rgba(125,211,252,.35); background:rgba(125,211,252,.10); opacity:1;}

.hero{padding:22px 16px 10px;}
.hwrap{max-width:1100px;margin:0 auto;}
h1{margin:0 0 6px; font-size:28px; letter-spacing:-.4px;}
p.lead{margin:0; color:var(--muted); max-width:85ch; font-size:14px; line-height:1.45;}

.grid{
  max-width:1100px; margin:14px auto 28px; padding:0 16px;
  display:grid; grid-template-columns: 1fr; gap:14px;
}

.card{
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border:1px solid var(--line);
  border-radius:var(--r);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.card .head{
  padding:14px 14px 10px;
  border-bottom:1px solid var(--line);
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  flex-wrap:wrap;
}
.pill{
  font-size:12px; font-weight:850;
  padding:6px 10px; border-radius:999px;
  background: rgba(125,211,252,.14);
  border:1px solid rgba(125,211,252,.25);
  color: var(--text);
  white-space:nowrap;
}
.body{padding:14px;}
.row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
.btn{
  appearance:none; border:1px solid var(--line);
  background: rgba(255,255,255,.05);
  color:var(--text); font-weight:850;
  padding:10px 12px; border-radius:14px;
  cursor:pointer;
  text-decoration:none;
  display:inline-flex; align-items:center; gap:8px;
}
.btn:hover{background: rgba(255,255,255,.08);}
.btn.primary{
  border-color: rgba(125,211,252,.35);
  background: linear-gradient(180deg, rgba(125,211,252,.18), rgba(125,211,252,.07));
}
.btn.good{
  border-color: rgba(52,211,153,.35);
  background: linear-gradient(180deg, rgba(52,211,153,.18), rgba(52,211,153,.06));
}
.btn.danger{
  border-color: rgba(251,113,133,.35);
  background: linear-gradient(180deg, rgba(251,113,133,.12), rgba(251,113,133,.05));
}
.field{display:flex; flex-direction:column; gap:6px; min-width:220px;}
label{font-size:12px; color:var(--muted); font-weight:800; letter-spacing:.02em;}
select, input[type="range"], input[type="color"]{
  width:100%;
  border:1px solid var(--line);
  background: rgba(255,255,255,.05);
  color:var(--text);
  padding:10px 12px;
  border-radius:14px;
  font-weight:800;
  outline:none;
}
select{cursor:pointer}
select:focus, input[type="range"]:focus, input[type="color"]:focus{box-shadow: 0 0 0 6px var(--ring);}

.msg{
  padding:10px 12px; border-radius:14px;
  border:1px solid var(--line);
  background: rgba(255,255,255,.04);
  color: var(--muted);
  margin-top:10px;
}
.msg.good{border-color:rgba(52,211,153,.35); background: rgba(52,211,153,.10); color: rgba(238,242,255,.92);}
.msg.bad{border-color:rgba(251,113,133,.35); background: rgba(251,113,133,.10); color: rgba(238,242,255,.92);}

.stage{
  border:1px solid var(--line);
  border-radius:16px;
  padding:12px;
  background:
    radial-gradient(900px 500px at 10% 0%, rgba(125,211,252,.10), transparent 60%),
    linear-gradient(180deg, rgba(13,28,54,.65), rgba(13,28,54,.35));
}

.canvasWrap{
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.12);
  border-radius:16px;
  overflow:hidden;
  position:relative;
}
canvas{
  display:block;
  width:100%;
  height:360px;
  touch-action:none; /* IMPORTANT for mobile drawing */
}
@media (max-width:650px){ canvas{height:320px;} }
@media (max-width:420px){ canvas{height:280px;} }

.hintWord{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  font-weight:950;
  letter-spacing:.06em;
  opacity:.18;
  pointer-events:none;
  font-size:64px;
  white-space:nowrap;
}
@media (max-width:650px){ .hintWord{font-size:54px;} }
@media (max-width:420px){ .hintWord{font-size:44px;} }

.lines{
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:.25;
}
.lines svg{width:100%;height:100%;display:block}
.small{font-size:13px; color:var(--muted); line-height:1.35}
.kbd{
  display:inline-block; padding:3px 8px; border-radius:10px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.12);
  font-weight:900; font-size:12px; color:rgba(238,242,255,.88);
}
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="top">
      <a class="brand" href="index.html" aria-label="Primary Steps home">
        <img src="assets/primary-steps-logo.png" alt="Primary Steps logo" onerror="this.style.display='none'">
        <div>
          <div class="title">Primary Steps</div>
          <span class="sub">Simple, calm learning activities</span>
        </div>
      </a>
      <nav aria-label="Primary">
        <a href="handwriting.html" class="active">Back to Handwriting</a>
        <a href="letters.html">Letters</a>
        <a href="phonics.html">Phonics</a>
        <a href="progress.html">Progress</a>
      </nav>
    </div>
  </div>
</header>

<section class="hero">
  <div class="hwrap">
    <h1 id="pageTitle">Handwriting</h1>
    <p class="lead" id="pageLead">Press New to start.</p>
  </div>
</section>

<section class="grid">
  <div class="card" aria-label="Handwriting activity">
    <div class="head">
      <div class="pill" id="actPill">Loading…</div>
      <div class="row">
        <div class="field" id="difficultyField">
          <label for="difficulty">Difficulty</label>
          <select id="difficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>
        <div class="field" id="penField" style="min-width:160px;">
          <label for="penSize">Pen size</label>
          <input id="penSize" type="range" min="3" max="18" value="8" />
        </div>
        <div class="field" id="colorField" style="min-width:140px;">
          <label for="penColor">Colour</label>
          <input id="penColor" type="color" value="#ffffff" />
        </div>
        <button class="btn primary" id="newBtn" type="button">New</button>
        <button class="btn" id="clearBtn" type="button">Clear</button>
        <button class="btn good" id="doneBtn" type="button">Done</button>
      </div>
    </div>
    <div class="body">
      <div class="stage">
        <div class="canvasWrap" id="canvasWrap">
          <div class="lines" id="lines"></div>
          <div class="hintWord" id="hintWord" aria-hidden="true"></div>
          <canvas id="cv"></canvas>
        </div>
        <div class="small" style="margin-top:10px">
          Tip: On phones/tablets, draw with your finger. Use <span class="kbd">Clear</span> if you want to start again.
        </div>
      </div>
      <div class="msg" id="message">Press <strong>New</strong> to start.</div>
    </div>
  </div>
</section>

<script>
(() => {
  const $ = (id)=>document.getElementById(id);
  const ui = {
    pill:$('actPill'),
    pageTitle:$('pageTitle'),
    pageLead:$('pageLead'),
    difficulty:$('difficulty'),
    newBtn:$('newBtn'),
    clearBtn:$('clearBtn'),
    doneBtn:$('doneBtn'),
    msg:$('message'),
    hintWord:$('hintWord'),
    lines:$('lines'),
    cv:$('cv'),
    wrap:$('canvasWrap'),
    penSize:$('penSize'),
    penColor:$('penColor'),
    difficultyField:$('difficultyField'),
  };

  function setMsg(type, html){
    ui.msg.className = 'msg' + (type ? ' ' + type : '');
    ui.msg.innerHTML = html;
  }
  function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  // WORD BANK (lots, mixed difficulty)
  const WORDS = {
    easy: [
      "cat","dog","sun","hat","pen","cup","fox","map","pig","bus","run","jump","milk","book","fish","tree","star","moon","rain","snow",
      "frog","duck","ship","ring","ball","sock","hand","foot","cake","bike"
    ],
    medium: [
      "apple","banana","orange","school","teacher","pencil","garden","window","little","happy","family","friend","winter","summer","spring","autumn",
      "picture","animals","cooking","reading","writing","number","letters","phonics","playing","outside","inside","morning","evening","different"
    ],
    hard: [
      "beautiful","adventure","important","remember","challenge","unexpected","excellent","confident","imagination","celebration","information","experience",
      "responsible","comfortable","interesting","communication","mathematics","extraordinary","concentration","determination"
    ]
  };

  const ACTIVITIES = [
    {
      key:'words',
      name:'Word Trace',
      lead:'Trace the word on the canvas. Press Done when finished.',
      setup: ()=>{
        ui.difficultyField.style.display = '';
        ui.hintWord.style.display = '';
      },
      newRound: (st, diff)=>{
        const bank = WORDS[diff] || WORDS.medium;
        st.word = bank[randInt(0, bank.length-1)];
        st.strokes = 0;
        st.ink = 0;
        ui.hintWord.textContent = st.word.toUpperCase();
        setMsg('', `Trace <strong>${st.word.toUpperCase()}</strong>, then press <strong>Done</strong>.`);
        drawGuides(true);
        clearCanvas();
      },
      done: (st)=>{
        // Simple completion rule: must draw "enough" ink for the word length
        const minInk = Math.max(1200, st.word.length * 600);
        if(st.ink >= minInk){
          setMsg('good', `✅ Nice work! You traced <strong>${st.word.toUpperCase()}</strong>. Press <strong>New</strong> for the next word.`);
        } else {
          setMsg('bad', `Keep going — try tracing the whole word, then press <strong>Done</strong> again.`);
        }
      }
    },
    {
      key:'free',
      name:'Free Write',
      lead:'Practice writing freely. Use Clear whenever you want.',
      setup: ()=>{
        ui.difficultyField.style.display = 'none';
        ui.hintWord.style.display = 'none';
      },
      newRound: (st)=>{
        st.strokes = 0;
        st.ink = 0;
        drawGuides(false);
        clearCanvas();
        setMsg('', `Write anything you like. Press <strong>Clear</strong> to start fresh.`);
      },
      done: (st)=>{
        if(st.ink > 800){
          setMsg('good', `✅ Great practice! Press <strong>New</strong> to clear and start again.`);
        } else {
          setMsg('', `Keep practising — draw a bit more, then press <strong>Done</strong>.`);
        }
      }
    }
  ];

  const params = new URLSearchParams(location.search);
  const requested = (params.get('activity') || 'words').toLowerCase();
  let active = ACTIVITIES.find(a=>a.key===requested) || ACTIVITIES[0];
  let state = { word:'', strokes:0, ink:0 };

  // Canvas drawing (pointer events = works on mobile + desktop)
  const ctx = ui.cv.getContext('2d', { alpha: true });
  let drawing = false;
  let last = null;

  function resizeCanvas(){
    const rect = ui.wrap.getBoundingClientRect();
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    ui.cv.width = Math.floor(rect.width * dpr);
    ui.cv.height = Math.floor((parseFloat(getComputedStyle(ui.cv).height) || 360) * dpr);
    ui.cv.style.width = rect.width + "px";
    ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
    // redraw doesn't preserve strokes (we keep it simple); user can press clear if resize happens
  }

  function clearCanvas(){
    const rect = ui.wrap.getBoundingClientRect();
    ctx.clearRect(0,0, rect.width, parseFloat(getComputedStyle(ui.cv).height));
    state.strokes = 0;
    state.ink = 0;
  }

  function drawGuides(isTrace){
    // lined paper SVG background
    const h = parseFloat(getComputedStyle(ui.cv).height) || 360;
    const lines = [];
    const topPad = 30;
    const spacing = 44;
    for(let y=topPad; y<h; y+=spacing){
      lines.push(`<line x1="0" y1="${y}" x2="100%" y2="${y}" stroke="rgba(238,242,255,.22)" stroke-width="1" />`);
      lines.push(`<line x1="0" y1="${y+spacing/2}" x2="100%" y2="${y+spacing/2}" stroke="rgba(125,211,252,.18)" stroke-width="1" stroke-dasharray="6 8" />`);
    }
    ui.lines.innerHTML = `
      <svg viewBox="0 0 100 ${h}" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
        ${lines.join('')}
      </svg>
    `;
    ui.hintWord.style.opacity = isTrace ? ".18" : "0";
  }

  function startDraw(p){
    drawing = true;
    last = p;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    ctx.strokeStyle = ui.penColor.value;
    ctx.lineWidth = Number(ui.penSize.value);
    ctx.beginPath();
    ctx.moveTo(p.x, p.y);
  }
  function moveDraw(p){
    if(!drawing || !last) return;
    ctx.lineTo(p.x, p.y);
    ctx.stroke();
    // ink measure (distance)
    const dx = p.x - last.x;
    const dy = p.y - last.y;
    state.ink += Math.sqrt(dx*dx + dy*dy);
    last = p;
  }
  function endDraw(){
    if(!drawing) return;
    drawing = false;
    last = null;
    state.strokes++;
  }
  function getPoint(e){
    const rect = ui.cv.getBoundingClientRect();
    return { x: e.clientX - rect.left, y: e.clientY - rect.top };
  }

  ui.cv.addEventListener('pointerdown', (e)=>{
    e.preventDefault();
    ui.cv.setPointerCapture(e.pointerId);
    startDraw(getPoint(e));
  });
  ui.cv.addEventListener('pointermove', (e)=>{
    if(!drawing) return;
    e.preventDefault();
    moveDraw(getPoint(e));
  });
  ui.cv.addEventListener('pointerup', (e)=>{ e.preventDefault(); endDraw(); });
  ui.cv.addEventListener('pointercancel', (e)=>{ e.preventDefault(); endDraw(); });

  // Controls
  function applyMeta(){
    ui.pill.textContent = active.name;
    ui.pageTitle.textContent = active.name;
    ui.pageLead.textContent = active.lead;
    active.setup && active.setup();
  }

  function newRound(){
    resizeCanvas();
    active.newRound(state, ui.difficulty.value);
  }

  ui.newBtn.addEventListener('click', newRound);
  ui.clearBtn.addEventListener('click', ()=>{ clearCanvas(); setMsg('', 'Cleared. Keep going!'); });
  ui.doneBtn.addEventListener('click', ()=> active.done && active.done(state));
  ui.difficulty.addEventListener('change', ()=> newRound());
  window.addEventListener('resize', ()=> resizeCanvas(), {passive:true});

  // init
  applyMeta();
  resizeCanvas();
  drawGuides(true);
  setMsg('', `Press <strong>New</strong> to start ${active.name}.`);
})();
</script>
</body>
</html>
